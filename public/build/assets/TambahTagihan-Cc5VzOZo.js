import{r as i,j as a}from"./app-DqyZ9fpM.js";import{M as A}from"./Modal-9Ca8uyRb.js";import{c as B}from"./utils-CXz1v5ar.js";import{b as E,E as C,H as F}from"./index-CFHXSCg8.js";/* empty css            */import"./x-Bm3CplTw.js";import"./clsx-B-dksMZM.js";const c=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],Y=({open:h,onClose:x,nouid:p,setTambahTagihan:y})=>{const[o,v]=i.useState({}),[N,f]=i.useState(!1),[l,g]=i.useState(""),[r,j]=i.useState(""),[d,S]=i.useState([]),[D,I]=i.useState(!1),b=i.useCallback(async()=>{f(!0);try{const e=route("api.tagihan.add",{nouid:p}),t=await fetch(e),n=await t.json();if(!t.ok)throw new Error(n.message);const s=n.data||{};v(s),Object.keys(s).length>0&&!l&&g(Object.keys(s)[0])}catch(e){console.error("Gagal ambil tagihan:",e)}finally{f(!1)}},[p,l]);i.useEffect(()=>{h&&b()},[h,b]);const k=l?[{value:"",label:"Semua Bulan"},...Object.keys(o[l]||{}).sort((e,t)=>c.indexOf(e)-c.indexOf(t)).map(e=>({value:e,label:e}))]:[],w=e=>{S(t=>t.some(s=>s.id===e.id)?t.filter(s=>s.id!==e.id):[...t,e])},O=()=>{const e=[],t=[],n=[];d.forEach(s=>{const m=c[s.bulid-1]||"Undefined";s.jen===0?(e.push(s.id),n.push({tah:s.tah,bulan:m,ket:s.ket,jumlah:s.jumlah})):t.push(s.id)}),console.log("SUBMIT DATA",n),n.length>0&&(y({spr:e,jen1:t,data:n}),x(!1))},M=()=>{var e;return l?r?(((e=o[l])==null?void 0:e[r])||[]).filter(t=>t.jen===0).map(t=>({...t,monthName:r,bulid:c.indexOf(r)+1||t.bulid})):Object.entries(o[l]).flatMap(([t,n])=>n.filter(s=>s.jen===0).map(s=>({...s,monthName:t,bulid:c.indexOf(t)+1||s.bulid}))):[]};return a.jsx(A,{title:"Pilih Tagihan",isOpen:h,onClose:()=>x(!1),children:a.jsx("div",{className:"max-h-[75vh] space-y-6 overflow-y-auto px-1",children:N?a.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[a.jsx(E,{className:"mb-2 animate-spin text-2xl"}),a.jsx("span",{children:"Memuat data tagihan..."})]}):Object.keys(o).length===0?a.jsx("p",{className:"py-4 text-center text-gray-600",children:"Tidak ada data tagihan tersedia"}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-row gap-2",children:[a.jsx("select",{value:l,onChange:e=>{g(e.target.value),j("")},className:"w-full bg-gray-100 px-4 py-3 font-semibold text-gray-800",children:Object.keys(o).sort((e,t)=>parseInt(t)-parseInt(e)).map(e=>a.jsxs("option",{value:e,children:["Tahun ",e]},e))}),a.jsx("select",{value:r,onChange:e=>j(e.target.value),className:"w-full bg-gray-100 px-4 py-3 font-semibold text-gray-800 capitalize",disabled:!l,children:k.map(({value:e,label:t})=>a.jsx("option",{value:e,children:t},e||"all"))})]}),l&&a.jsx("div",{className:"space-y-4",children:M().map(({id:e,ket:t,jumlah:n,monthName:s,bulid:m})=>{const u=d.some(T=>T.id===e);return a.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 p-3 transition-shadow hover:shadow-md",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-gray-800",children:t}),a.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[a.jsxs("span",{children:["Rp ",n.toLocaleString("id-ID")]}),!r&&a.jsx("span",{className:"text-xs text-gray-400",children:s})]})]}),a.jsx("button",{onClick:()=>w({id:e,ket:t,jumlah:n,tah:l,bulid:m,jen:0,sta:0}),className:B("rounded-full p-2 text-blue-600 transition hover:bg-blue-50",u&&"text-red-500 hover:bg-red-50"),title:u?"Hapus tagihan":"Tambahkan tagihan",children:u?a.jsx(C,{}):a.jsx(F,{})})]},e)})}),d.length>0&&a.jsx("div",{className:"flex justify-end pt-4",children:a.jsxs("button",{onClick:O,className:"rounded-md bg-blue-600 px-5 py-2 text-white transition hover:bg-blue-700",children:["Tambahkan ",d.length," Tagihan"]})})]})})})};export{Y as default};
