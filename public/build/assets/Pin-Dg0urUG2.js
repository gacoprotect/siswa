import{R as _,j as e,r as v,K as M,m as R,a as W,L as H,S as J}from"./app-BCQLJZXK.js";import{A as Q}from"./arrow-left-BCcD-hxn.js";import{C as X}from"./circle-alert-C9pSu8Fp.js";import{M as Y}from"./Modal-o33I06dg.js";import{j as B}from"./index-BU9zNRk0.js";const A=_.forwardRef(({value:r,onChange:u,onKeyDown:y,onPaste:x,type:j="text",error:h=!1,autoFocus:f=!1},i)=>e.jsx("input",{ref:i,type:j,inputMode:"numeric",pattern:"[0-9]*",maxLength:1,required:!0,autoComplete:"off",className:`h-12 w-12 rounded-md border text-center text-2xl focus:ring-1 focus:outline-none ${h?"border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"}`,value:r,onChange:u,onKeyDown:y,onPaste:x,autoFocus:f,onFocus:P=>P.target.select()}));A.displayName="DigitInput";const Z=({otp:r,phone:u,errors:y,processing:x,countdown:j,onOtpChange:h,onKeyDown:f,onBack:i,onResendOtp:P,onSubmit:N,inputRefs:m})=>{const k=(b,l)=>{var p;const c=b.target.value.replace(/\D/g,"");h(c,l),c&&l<5&&m.current[l+1]&&((p=m.current[l+1])==null||p.focus())};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:i,className:"flex items-center text-sm text-gray-600 hover:text-gray-800",type:"button",children:[e.jsx(Q,{className:"mr-1 h-4 w-4"}),"Kembali"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Verifikasi OTP"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Masukkan 6 digit kode OTP yang dikirim ke ",u??"Whatsapp Anda"]})]}),y.otp&&e.jsx("div",{className:"text-center text-sm text-red-500",children:y.otp}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((b,l)=>e.jsx(A,{ref:c=>{m.current[l]=c},value:r[l]||"",onChange:c=>k(c,l),onKeyDown:c=>f(c,l),error:!!y.otp,autoFocus:l===0},l))}),e.jsx("div",{className:"text-center",children:j>0?e.jsxs("p",{className:"text-sm text-gray-500",children:["Kirim ulang OTP dalam ",j," detik"]}):e.jsx("button",{type:"button",onClick:P,className:"text-sm text-blue-600 hover:text-blue-800",children:"Kirim Ulang OTP"})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:x||r.length!==6,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${r.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:x?"Memverifikasi...":"Verifikasi"})})]})]})},ee=({pin:r,errors:u,inputType:y,processing:x,onPinChange:j,onKeyDown:h,onPaste:f,onToggleInputType:i,onSubmit:P,inputRefs:N})=>{const[m,k]=v.useState(Object.keys(u).length>0),b=(l,c)=>{var D;k(!1);const p=l.target.value.replace(/\D/g,"");j(l,c),p&&c<5&&N.current[c+1]&&((D=N.current[c+1])==null||D.focus())};return v.useEffect(()=>{u&&k(Object.keys(u).length>0)},[u]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:P,children:[e.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((l,c)=>e.jsx(A,{ref:p=>{N.current[c]=p},type:y,value:r[c]||"",onChange:p=>b(p,c),onKeyDown:p=>h(p,c),onPaste:f,autoFocus:c===0,error:m},c))}),m&&(u.pin||u.message?e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:u.pin??u.message}),parseInt(u.remaining)<3&&e.jsx("span",{children:u.remaining?`sisa percobaan ${u.remaining}`:""})]}):e.jsx("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:e.jsxs("span",{children:[e.jsx(X,{className:"text-red-500 w-5 h-5"})," Terjadi Kesalahan"]})})),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:i,children:y==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:x||r.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${r.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:x?"Memverifikasi...":"Masuk"})})]})]})})},te=({errors:r,inputType:u,onToggleInputType:y,onSukses:x})=>{const{data:j}=M().props,[h,f]=v.useState(Object.keys(r).length>0),{data:i,setData:P,post:N,processing:m,reset:k}=R({pin:"",pin_confirmation:""}),b=_.useRef(Array(6).fill(null)),l=_.useRef(Array(6).fill(null)),c=d=>{d.preventDefault(),N(route("siswa.process-setup-pin",j.nouid),{onSuccess:()=>{x==null||x(),k()}})},p=(d,t,s)=>{var w;const o=i[s].split("");o[t]=d.charAt(d.length-1)||"",P(s,o.join("")),d&&t<5&&((w=(s==="pin"?b:l).current[t+1])==null||w.focus())},D=(d,t,s)=>{var o;d.key==="Backspace"&&!i[s][t]&&t>0&&((o=(s==="pin"?b:l).current[t-1])==null||o.focus())},S=(d,t)=>{var o;d.preventDefault();const s=d.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(s.length>0){P(t,s);const w=Math.min(s.length-1,5);(o=(t==="pin"?b:l).current[w])==null||o.focus()}};return v.useEffect(()=>{f(Object.keys(r).length>0)},[r]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Buat PIN 6 Digit Baru"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Untuk keamanan akun Anda"})]}),(r.pin||r.pin_confirmation)&&e.jsx("div",{className:"text-center text-sm text-red-500",children:r.pin||r.pin_confirmation}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:c,children:[e.jsxs("div",{className:"flex flex-col gap-2 justify-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Masukkan PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((d,t)=>e.jsx(A,{ref:s=>{b.current[t]=s},type:u,value:i.pin[t]||"",onChange:s=>{const o=s.target.value.replace(/\D/g,"");p(o,t,"pin")},onKeyDown:s=>D(s,t,"pin"),onPaste:s=>S(s,"pin"),autoFocus:t===0&&i.pin.length===0,error:h},`pin-${t}`))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin_confirmation",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Konfirmasi PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((d,t)=>e.jsx(A,{ref:s=>{l.current[t]=s},type:u,value:i.pin_confirmation[t]||"",onChange:s=>{const o=s.target.value.replace(/\D/g,"");p(o,t,"pin_confirmation")},onKeyDown:s=>D(s,t,"pin_confirmation"),onPaste:s=>S(s,"pin_confirmation"),autoFocus:t===0&&i.pin.length===6&&i.pin_confirmation.length===0,error:h},`pin-confirm-${t}`))})]})]}),h&&(r.pin||r.message)&&e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:r.pin??r.message}),r.remaining&&parseInt(r.remaining)<3&&e.jsx("span",{children:`Sisa percobaan ${r.remaining}`})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:y,children:u==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:m||i.pin.length!==6||i.pin_confirmation.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${i.pin.length===6&&i.pin_confirmation.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:m?"Memproses...":"Simpan PIN"})})]})]})})},se=({setOpenSetupPin:r,handle:u,setPage:y,hasPin:x,open:j,onClose:h})=>{var K,T;const{errors:f,data:i}=M().props,{error:P,log:N}=W(),{data:m,setData:k,post:b,processing:l,reset:c}=R({pin:"",nouid:i.nouid??"",otp:""}),[p,D]=v.useState("password"),[S,d]=v.useState(0),[t,s]=v.useState("pin"),o=v.useRef(Array(6).fill(null)),w=v.useRef(Array(6).fill(null));v.useEffect(()=>{if(S<=0)return;const n=setTimeout(()=>d(S-1),1e3);return()=>clearTimeout(n)},[S]),v.useEffect(()=>{var n,a;j&&o.current[0]&&((n=o.current[0])==null||n.focus()),j&&w.current[0]&&((a=w.current[0])==null||a.focus())},[j]);const O=n=>{n.preventDefault(),/^\d{6}$/.test(m.pin)&&b(route("siswa.verify-pin",{nouid:i.nouid,p:u??"auth"}),{preserveState:!0,onSuccess:()=>{y("index"),c(),h(!1)},onError:()=>{var a;k("pin",""),o.current[0]&&((a=o.current[0])==null||a.focus()),P(f)},onFinish:()=>{}})},F=(n,a)=>{const g=m.pin.split("");g[a]=n.charAt(n.length-1)||"",k("pin",g.join(""))},$=()=>{J.get(route("register",m.nouid))},L=(n,a)=>{var g;n.key==="Backspace"&&!m.pin[a]&&a>0&&o.current[a-1]&&((g=o.current[a-1])==null||g.focus())},U=(n,a)=>{var I;n.preventDefault();const g=n.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(g.length>0){k(a,g);const E=Math.min(g.length-1,5),C=o;C!=null&&C.current[E]&&((I=C.current[E])==null||I.focus())}},V=n=>{n.preventDefault(),b(route("otp.verif",i.nouid),{onSuccess:()=>{N("OTP SUKSES"),s("setup")},onError:()=>{N("OTP GAGAL")}})},G=()=>{b(route("otp.send",i.nouid),{onSuccess:()=>{d(60)}})},q=(n,a,g)=>{const I=m[a].split("");I[g]=n.charAt(n.length-1)||"",k(a,I.join(""))},z=(n,a)=>{var g;n.key==="Backspace"&&!m.otp[a]&&a>0&&w.current[a-1]&&((g=w.current[a-1])==null||g.focus())};return v.useEffect(()=>{N("STEP : ",t),f.pin&&parseInt(f.remaining)===0&&s("otp")},[f.pin]),e.jsx(Y,{title:x?"":"Anda Belum Terverifikasi",isOpen:j,onClose:()=>{h(!1),c()},header:!1,children:x?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(H,{title:"Masukkan PIN"}),e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t==="pin"&&e.jsx(ee,{pin:m.pin,errors:f,inputType:p,processing:l,onPinChange:(n,a)=>F(n.target.value,a),onKeyDown:L,onPaste:n=>U(n,"pin"),onToggleInputType:()=>D(p==="password"?"text":"password"),onSubmit:O,setInputRef:(n,a)=>{o.current[a]=n},inputRefs:o}),t==="otp"&&e.jsx(Z,{otp:m.otp,errors:f,processing:l,countdown:S,onOtpChange:(n,a)=>q(n,"otp",a),onKeyDown:z,onBack:()=>h(!1),onResendOtp:G,onSubmit:V,inputRefs:w}),t==="setup"&&e.jsx(te,{errors:f,inputType:p,onToggleInputType:()=>D(p==="password"?"text":"password"),onSukses:()=>h(!1)})]})]}):((K=i.summary)==null?void 0:K.reg)===1&&((T=i.summary)==null?void 0:T.pin)===!1?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"max-w-md text-sm",children:"Untuk melanjutkan silahkan buat PIN Anda terlebih dahulu"}),e.jsxs("button",{onClick:r,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[e.jsx(B,{className:"text-lg"}),e.jsx("span",{children:"Buat Sekarang"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"max-w-md text-sm",children:"Untuk melanjutkan silahkan verifikasi identitas diri Anda terlebih dahulu"}),e.jsxs("button",{onClick:$,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[e.jsx(B,{className:"text-lg"}),e.jsx("span",{children:"Verifikasi Sekarang"})]})]})})},le=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{Z as O,ee as P,se as a,le as b};
