import{K as I,m as M,r as c,j as t,L as S}from"./app-BGcLKc-6.js";import{M as A}from"./Modal-5ywoKA0y.js";import{v as C}from"./index-BOwtk-i8.js";import"./x-CPuglKmT.js";const R=({handle:p,setPage:d,setOpenSetupPin:y,hasPin:f,open:l,onClose:m})=>{const{errors:x,nouid:h}=I().props,{data:a,setData:i,post:j,processing:b,reset:v}=M({pin:"",nouid:h??""}),[u,N]=c.useState("password"),n=c.useRef(Array(6).fill(null));c.useEffect(()=>{const e=window.location.pathname.split("/")[1];i("nouid",e)},[i]),c.useEffect(()=>{var r;l&&n.current[0]&&((r=n.current[0])==null||r.focus())},[l]);const w=r=>{r.preventDefault(),/^\d{6}$/.test(a.pin)&&j(route("siswa.verify-pin",{nouid:h,p}),{preserveState:!0,onSuccess:()=>{m(!0),v(),p==="riwayat"&&d("riwayat")},onError:()=>{var e;i("pin",""),d("index"),n.current[0]&&((e=n.current[0])==null||e.focus())}})},k=(r,e)=>{var g;const s=r.target.value.replace(/\D/g,""),o=a.pin.split("");o[e]=s.charAt(s.length-1)||"",i("pin",o.join("")),s&&e<5&&n.current[e+1]&&((g=n.current[e+1])==null||g.focus())},P=(r,e)=>{var s;r.key==="Backspace"&&!a.pin[e]&&e>0&&n.current[e-1]&&((s=n.current[e-1])==null||s.focus())},D=r=>{var s;r.preventDefault();const e=r.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(e.length>0){i("pin",e);const o=Math.min(e.length-1,5);n.current[o]&&((s=n.current[o])==null||s.focus())}};return t.jsx(A,{title:f?"":"Anda Belum Membuat PIN",isOpen:l,onClose:()=>m(!1),children:f?t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(S,{title:"Masukkan PIN"}),t.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t.jsx("div",{children:t.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),x.pin&&t.jsx("div",{className:"mb-4 text-center text-sm text-red-500",children:x.pin}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:w,children:[t.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((r,e)=>t.jsx("input",{ref:s=>{n.current[e]=s},type:u,inputMode:"numeric",pattern:"[0-9]",maxLength:1,required:!0,autoComplete:"off",className:"h-12 w-12 rounded-md border border-gray-300 text-center text-2xl focus:border-blue-500 focus:ring-blue-500 focus:outline-none",value:a.pin[e]||"",onChange:s=>k(s,e),onKeyDown:s=>P(s,e),onPaste:D},e))}),t.jsx("div",{className:"flex justify-center",children:t.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:()=>N(u==="password"?"text":"password"),children:u==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsx("button",{type:"submit",disabled:b||a.pin.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${a.pin.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:b?"Memverifikasi...":"Masuk"})})]})]})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[t.jsx("p",{className:"max-w-md text-sm",children:"Silakan verifikasi nomor WhatsApp Anda dan buat PIN terlebih dahulu sebelum melanjutkan."}),t.jsxs("button",{onClick:y,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[t.jsx(C,{className:"text-lg"}),t.jsx("span",{children:"Buat PIN"})]})]})})};export{R as default};
