import{K as te,a as ae,u as re,r,S as O,m as ne,j as s}from"./app--SEvYMZI.js";import{C as le}from"./ConfirmDialog -vnzqd3_k.js";import{I as _}from"./InputGroup-DY_2VtTs.js";import{O as ie}from"./OtpStep-a3LxS41L.js";import{M as z}from"./Modal-Bg9QXoiH.js";import{c as oe}from"./utils-CXz1v5ar.js";import{b as C,E as de,G as ce,H as ue,I as me}from"./index-80Psauk_.js";import{y as xe}from"./index-B-aLMAM0.js";import{C as pe}from"./circle-alert-DWCaQk7G.js";/* empty css            */import"./index-eLQBKwut.js";import"./iconBase-CxjpI2wG.js";import"./arrow-left-RgR6rhbL.js";import"./createLucideIcon-Cz-Sh2GK.js";import"./x-ClU_SKd6.js";import"./clsx-B-dksMZM.js";const Ke=({nouid:x,onClose:F})=>{const{data:l,errors:f}=te().props,{log:k,error:u}=ae(),{APP_DEBUG:H}=re(),[J,D]=r.useState(!0),[N,I]=r.useState(0),b=r.useRef(Array(6).fill(null)),[T,P]=r.useState(null),[a,i]=r.useState({open:!1,step:null,action:null,exculId:null,title:""}),[p,W]=r.useState({sub:[],waiting:[],rejected:[],exited:[],excul:[]}),Y=e=>H?s.jsxs("div",{className:"border-2 border-red-500 px-4 py-2 rounded-lg space-y-2",children:[s.jsx("p",{className:"text-xs font-medium border-b-2",children:"Developer menu"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{O.get(route("simulasi.excul",{simulasi:"acc",excul:e,nouid:x}))},className:"p-1 bg-blue-500 rounded-md text-white cursor-pointer",children:"Terima"}),s.jsx("button",{onClick:()=>{O.get(route("simulasi.excul",{simulasi:"reject",excul:e,nouid:x}))},className:"p-1 bg-red-500 rounded-md text-white cursor-pointer",children:"Tolak"})]})]}):null,A=r.useCallback(async(e=!0)=>{try{await O.get(route("siswa.index",{nouid:x,page:"index",tab:"kegiatan"}),{},{only:["data.kegiatan","data.nouid"],preserveState:!0,onStart:()=>e&&D(!0),onError:F,onFinish:()=>e&&D(!1)})}catch(t){u(t instanceof Error?t.message:"Terjadi kesalahan jaringan"),D(!1)}},[x,F,u]);r.useEffect(()=>{l!=null&&l.kegiatan&&(W(l.kegiatan),k("Data siswa loaded:",l))},[l==null?void 0:l.kegiatan,k,l]),r.useEffect(()=>{A()},[]),r.useEffect(()=>{if(N<=0)return;const e=setTimeout(()=>I(N-1),1e3);return()=>clearTimeout(e)},[N]),r.useEffect(()=>{var e;a.step==="otp"&&b.current[0]&&((e=b.current[0])==null||e.focus())},[a.step]);const o=r.useMemo(()=>p.excul.map(e=>p.sub.includes(e.id)?{...e,status:"active",statusText:"Aktif"}:p.waiting.includes(e.id)?{...e,status:"waiting",statusText:"Menunggu"}:p.rejected.includes(e.id)?{...e,status:"rejected",statusText:"Ditolak"}:p.exited.includes(e.id)?{...e,status:"exited",statusText:"Keluar"}:{...e,status:"none",statusText:"Belum Terdaftar"}),[p]),K=r.useMemo(()=>o.filter(e=>e.status==="active"),[o]),M=r.useMemo(()=>o.filter(e=>e.status==="waiting"),[o]),Q=r.useMemo(()=>o.filter(e=>e.status==="rejected"),[o]),X=r.useMemo(()=>o.filter(e=>e.status==="exited"),[o]),{data:m,setData:g,processing:q,post:w,reset:y,clearErrors:v,errors:B,setError:$}=ne({otp:"",excul:0,tgl:"",ket:""}),R=r.useCallback((e=null)=>{const t={},n=e!==null,d=(E,S,j)=>{(!n||S===e)&&E&&(t[S]=j)};return d(!m.excul,"excul","Pilih Excul Anda"),d(!m.tgl,"tgl","Tanggal wajib diisi"),d(!m.ket,"ket","Masukkan alasan Anda"),t},[m]),G=r.useCallback(async(e,t)=>{try{g("excul",e),i({open:!0,step:t==="unsubscribe"?"confirm":"form",action:t,exculId:e,title:t==="subscribe"?"Form Pendaftaran":"Form Keluar Ekstrakurikuler"})}catch(n){u(`${t} failed:`,n)}},[u,g]),L=r.useCallback(async()=>{if(!a.action||a.exculId===null)return;const e=R();if($(e),Object.keys(e).length>0){u("Validation Error : ",e);const t=Object.keys(e)[0];if(t){const n=document.getElementById(t)||document.querySelector(`[name="${t}"], [data-name="${t}"]`);n==null||n.scrollIntoView({behavior:"smooth",block:"center"})}return}try{const t=a.action==="subscribe"?"subs.excul":"unsubs.excul";await w(route(t,x),{preserveScroll:!0,preserveState:!0,onStart:()=>P(a.exculId),onSuccess:()=>{A(!1),y()},onError:()=>{xe.error("Permintaan Gagal"),u(f)},onFinish:()=>{P(null),i(n=>({...n,open:!1}))}})}catch(t){u(`${a.action} failed:`,t)}},[a,x,w,A,y,u,f,$,R]),U=r.useCallback(()=>{i(e=>({...e,open:!1})),y(),v()},[y,v]);if(J)return s.jsxs("div",{className:"flex flex-row min-h-screen items-center justify-center space-x-3 py-4",children:[s.jsx(C,{className:"animate-spin text-3xl text-blue-600"}),s.jsx("span",{className:"text-lg font-bold text-blue-600",children:"Memuat data"})]});const Z=e=>{e.preventDefault(),w(route("otp.verif",l.nouid),{onSuccess:()=>{k("OTP SUKSES"),L(),i(t=>({...t,step:null}))},onError:()=>{k("OTP GAGAL")}})},V=()=>{w(route("otp.send",l.nouid),{onSuccess:()=>{I(60)}})},ee=(e,t,n)=>{const d=m[t].split("");d[n]=e.charAt(e.length-1)||"",g(t,d.join(""))},se=(e,t)=>{var n;e.key==="Backspace"&&!m.otp[t]&&t>0&&b.current[t-1]&&((n=b.current[t-1])==null||n.focus())},h=e=>{switch(e){case"active":return s.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-800",children:"Aktif"});case"waiting":return s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Menunggu"});case"rejected":return s.jsx("span",{className:"rounded bg-red-100 px-2 py-1 text-xs text-red-800",children:"Ditolak"});case"exited":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Anda telah Keluar"});case"registered":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Terdaftar"});default:return null}};return s.jsxs("div",{className:"space-y-6 p-4",children:[a.open&&a.step==="confirm"&&s.jsx(le,{open:a.step==="confirm",onOpenChange:e=>{i(t=>({...t,open:e}))},title:"Keluar Ekstrakulikuler",description:"Apakah anda yakin ingin keluar dari kegiatan ini?",confirmText:"Ya",cancelText:"Tidak",closeOnConfirm:!1,onConfirm:()=>{i(e=>({...e,open:!0,step:"form"}))}}),a.step==="form"&&s.jsx(z,{isOpen:a.open,onClose:U,onConfirm:()=>{a.action==="unsubscribe"?(V(),i(e=>({...e,step:"otp"}))):a.action==="subscribe"&&(L(),i(e=>({...e,step:null})))},confirmText:q?s.jsx(C,{className:"animate-spin"}):"Kirim",className:"w-100 mx-5",size:"xl",title:a.title,children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(_,{label:`Tanggal ${a.action==="subscribe"?"Mulai":"Berhenti"}`,name:"tgl",type:"date",onChange:e=>{g("tgl",e),v("tgl")},required:!0,error:B.tgl}),s.jsx(_,{label:`${a.action==="subscribe"?"Motivasi mendaftar":"Alasan Berhenti"}`,name:"ket",type:"textarea",onChange:e=>{g("ket",e),v("ket")},required:!0,rows:3,error:B.ket})]})}),a.step==="otp"&&s.jsx(z,{isOpen:a.open,onClose:U,className:"w-100 mx-5",size:"xl",children:s.jsx(ie,{otp:m.otp,errors:f,processing:q,countdown:N,onOtpChange:(e,t)=>ee(e,"otp",t),onKeyDown:se,onBack:()=>i(e=>({...e,step:"form"})),onResendOtp:V,onSubmit:Z,inputRefs:b})}),s.jsx("div",{className:"mb-6 flex items-center justify-between",children:s.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Ekstrakurikuler"})}),Object.keys(f).length>0&&s.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4 border-2 border-red-600",children:[s.jsx(pe,{className:"text-3xl text-red-600"}),s.jsx("span",{className:"text-md font-bold text-red-600",children:f.message??"Terjadi Kesalahan"})]}),K.length>0||M.length>0?s.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(de,{className:"text-green-500"}),"Ekstrakurikuler Aktif"]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[K.map(e=>s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-md",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",h(e.status)]})]}),s.jsx("button",{onClick:t=>{g("excul",e.id),t.preventDefault(),G(e.id,"unsubscribe")},disabled:T===e.id,className:"text-sm font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:T===e.id?s.jsx(C,{className:"animate-spin"}):"Keluar"})]}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),s.jsx("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800",children:"Lihat Jadwal"})]})]},e.id)),M.map(e=>s.jsxs("div",{className:"rounded-lg bg-yellow-50 border-2 border-yellow-500 p-4 transition-shadow hover:shadow-md",children:[s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",h(e.status)]})]})}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),Y(e.id)]})]},e.id))]})]}):s.jsxs("div",{className:"py-8 text-center text-gray-500",children:[s.jsx("p",{children:"Anda belum terdaftar dalam ekstrakurikuler apapun"}),s.jsx("a",{href:"#list_excul",className:"mt-4 font-medium text-indigo-600 hover:text-indigo-800",children:"Daftar Sekarang"})]}),s.jsxs("div",{id:"list_excul",className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(ce,{className:"text-indigo-500"}),"Daftar Ekstrakurikuler Tersedia"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:o.map(e=>{const t=e.registered===e.quota,n=M.some(c=>c.id===e.id),d=Q.some(c=>c.id===e.id),E=X.some(c=>c.id===e.id),S=K.some(c=>c.id===e.id),j=T===e.id;return s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-lg",children:[s.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),d&&h("rejected"),E&&h("exited")]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(ue,{className:"text-gray-400"}),e.day,", ",e.time]}),s.jsxs("p",{className:"text-gray-600",children:["Pelatih: ",e.coach]}),s.jsxs("div",{className:"flex items-center justify-between pt-2",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),t?s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Kuota Penuh"}):n?h("waiting"):s.jsx("div",{className:"flex items-center gap-4 justify-between pt-2",children:S?h("registered"):s.jsxs("button",{onClick:c=>{c.preventDefault(),G(e.id,"subscribe")},className:oe("flex items-center justify-center space-x-2 rounded bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700",j&&"bg-indigo-400 hover:bg-indigo-500"),disabled:j,children:[j&&s.jsx(C,{className:"animate-spin"}),s.jsx("span",{children:d||E?"Daftar Ulang":"Daftar"})]})})]})]})]},e.id)})})]}),s.jsx("div",{className:"rounded border-l-4 border-blue-400 bg-blue-50 p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(me,{className:"mt-1 flex-shrink-0 text-blue-500"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-blue-800",children:"Informasi Penting"}),s.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-sm text-blue-700",children:[s.jsx("li",{children:"Setiap siswa boleh mengikuti maksimal 2 ekstrakurikuler"}),s.jsx("li",{children:"Pendaftaran ditutup ketika kuota terpenuhi"}),s.jsx("li",{children:"Kehadiran minimal 80% untuk mendapatkan sertifikat"}),s.jsx("li",{children:"Status pendaftaran akan diperiksa oleh admin"})]})]})]})})]})};export{Ke as default};
