import{j as e,r as o}from"./app-IyQ2M4dK.js";import{e as y,b as B,d as E,A as C,B as I,C as L,D as M}from"./index-Bua4SX4u.js";import{X as F}from"./x-Dr58Fn8C.js";const $=({setparam:l,monthData:r,nouid:x})=>{var j;const d=({tagihan:a,spr:m,jen1:v})=>{l({spr:m,jen1:v,tagihan:a,nouid:x})},g=r.transactions.filter(a=>a.sta===0),h=g.length>0,N=g.reduce((a,m)=>a+m.jumlah,0),f=((j=r.transactions.find(a=>a.jen===0))==null?void 0:j.spr)??null,b=r.transactions.filter(a=>a.jen===1&&a.spr!==void 0&&a.spr!==null).map(a=>a.spr);return h?e.jsxs("button",{onClick:()=>d({tagihan:N,spr:f,jen1:b}),className:"flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700","aria-label":"Bayar tagihan sekarang",children:[e.jsx(y,{className:"text-lg"}),"Bayar Sekarang"]}):null},S=768;function R(){const[l,r]=o.useState();return o.useEffect(()=>{const x=window.matchMedia(`(max-width: ${S-1}px)`),d=()=>{r(window.innerWidth<S)};return x.addEventListener("change",d),r(window.innerWidth<S),()=>x.removeEventListener("change",d)},[]),!!l}const T=({title:l,value:r,icon:x,bgColor:d})=>e.jsx("div",{className:`${d} rounded-lg p-4 shadow-sm`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:l}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:r})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:x})]})}),W=({nouid:l,setTagihanParam:r})=>{const x=R(),[d,g]=o.useState(!0),[h,N]=o.useState({}),[f,b]=o.useState(null),[j,a]=o.useState({}),[m,v]=o.useState(null);o.useEffect(()=>{(async()=>{try{g(!0),b(null);const i=await fetch(route("tagihan.index",l));if(!i.ok)throw new Error("Gagal memuat data tagihan");const p=await i.json();if(p.status!=="success")throw new Error("Terjadi kesalahan server");N(p.data),v(p.summary);const t=Object.keys(p.data).reduce((s,w)=>(s[w]=!0,s),{});a(t)}catch(i){b(i instanceof Error?i.message:"Terjadi kesalahan jaringan")}finally{g(!1)}})()},[l]);const k=n=>{a(i=>({...i,[n]:!i[n]}))},u=n=>{switch(n){case 2:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(E,{className:"mr-1"})," Lunas"]});case 1:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[e.jsx(B,{className:"mr-1 animate-spin"})," Proses"]});default:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800",children:[e.jsx(C,{className:"mr-1"})," Belum Bayar"]})}};return d?e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(B,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg text-blue-600 font-bold",children:"Memuat data"})]}):f?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4 text-red-600",children:[e.jsx(F,{className:"animate-pulse"}),e.jsx("span",{children:f})]}):Object.keys(h).length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Tidak ada data tagihan"}):e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Tagihan"}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white transition-colors hover:bg-green-700",children:[e.jsx(y,{className:"text-lg"}),"Buat Tagihan"]})]}),m&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(T,{title:"Total Tagihan",value:`Rp ${m.total_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(y,{className:"text-blue-500"}),bgColor:"bg-blue-50"}),e.jsx(T,{title:"Total Pembayaran",value:`Rp ${m.total_pembayaran.toLocaleString("id-ID")}`,icon:e.jsx(E,{className:"text-green-500"}),bgColor:"bg-green-50"}),e.jsx(T,{title:"Sisa Tagihan",value:`Rp ${m.sisa_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(C,{className:"text-amber-500"}),bgColor:"bg-amber-50"})]}),Object.entries(h).map(([n,i])=>{const p=Object.values(i).filter(c=>c.transactions.some(t=>t.sta===0&&t.jen===0)).length;return e.jsxs("div",{className:"rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>k(n),className:"flex w-full items-center justify-between p-4 hover:bg-gray-50",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Tahun ",n]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[p>0&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[p," Belum Bayar"]}),j[n]?e.jsx(I,{className:"text-gray-500"}):e.jsx(L,{className:"text-gray-500"})]})]}),j[n]&&e.jsx("div",{className:"border-t border-gray-200",children:Object.entries(i).map(([c,t])=>e.jsxs("div",{className:"p-4",children:[x?e.jsxs("div",{className:"mb-3 flex-col items-center justify-between",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:c}),e.jsx("div",{className:"flex items-center space-x-2",children:t.transactions.some(s=>s.sta===1)?u(1):t.transactions.every(s=>s.sta===2||s.jen===1)?u(2):u(0)})]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsxs("div",{className:`mb-3 flex items-center ${t.transactions.some(s=>s.sta===0)?"justify-between":"justify-end"} `,children:[t.transactions.some(s=>s.sta===0)&&e.jsx($,{setparam:s=>r(s),monthData:t,nouid:l,month:c}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]})]}):e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:c}),t.transactions.some(s=>s.sta===1)?u(1):t.transactions.every(s=>s.sta===2||s.jen===1)?u(2):u(0)]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsx("div",{className:`mb-3 flex items-center ${t.transactions.some(s=>s.sta===0)?"justify-between":"justify-end"} `,children:t.transactions.some(s=>s.sta===0)&&e.jsx($,{setparam:s=>r(s),monthData:t,nouid:l,month:c})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:t.transactions.map((s,w)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===0?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[e.jsx(y,{className:"mr-1"}),"Tagihan"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(M,{className:"mr-1"}),"Bantuan"]})}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-500",children:s.ket}),e.jsxs("td",{className:`px-4 py-3 text-sm whitespace-nowrap ${s.jen===1?"text-green-600":"text-gray-700"}`,children:[s.jen===1?"+":"","Rp"," ",Math.abs(s.jumlah).toLocaleString("id-ID")]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===1?"-":u(s.sta)})]},`${n}-${c}-${w}`))})]})})]},c))})]},n)})]})};export{W as default};
