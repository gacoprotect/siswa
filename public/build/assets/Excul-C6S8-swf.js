import{K as X,a as Z,u as ee,r as a,m as se,y as te,j as s,S as G}from"./app-BY6ewAwp.js";import{C as re}from"./ConfirmDialog -BAWgDMr2.js";import{I as L}from"./InputGroup-C6O9Rqug.js";import{O as ae}from"./OtpStep-g-znrOWc.js";import{M as U}from"./Modal-BTpGdcEI.js";import{c as ne}from"./utils-CRBq6u4R.js";import{b as A,E as le,G as ie,H as de,I as oe}from"./index-DRe9yMeh.js";import{C as ce}from"./circle-alert-C3JH-0O7.js";/* empty css            */import"./index-DCwhtrBD.js";import"./iconBase-DIl_u5jI.js";import"./arrow-left-j2ndoAtW.js";import"./x-Uc6J0FES.js";const ve=({nouid:j})=>{const{data:l,errors:h}=X().props,{log:k,error:m}=Z(),{APP_DEBUG:V}=ee(),[N,K]=a.useState(0),f=a.useRef(Array(6).fill(null)),[C,O]=a.useState(null),[r,i]=a.useState({open:!1,step:null,action:null,exculId:null,title:""}),[x,_]=a.useState({sub:[],waiting:[],rejected:[],exited:[],excul:[]}),z=e=>V?s.jsxs("div",{className:"border-2 border-red-500 px-4 py-2 rounded-lg space-y-2",children:[s.jsx("p",{className:"text-xs font-medium border-b-2",children:"Developer menu"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{G.get(route("simulasi.excul",{simulasi:"acc",excul:e,nouid:j}))},className:"p-1 bg-blue-500 rounded-md text-white cursor-pointer",children:"Terima"}),s.jsx("button",{onClick:()=>{G.get(route("simulasi.excul",{simulasi:"reject",excul:e,nouid:j}))},className:"p-1 bg-red-500 rounded-md text-white cursor-pointer",children:"Tolak"})]})]}):null;a.useEffect(()=>{l!=null&&l.kegiatan&&(_(l.kegiatan),k("Data siswa loaded:",l))},[l==null?void 0:l.kegiatan,k,l]),a.useEffect(()=>{if(N<=0)return;const e=setTimeout(()=>K(N-1),1e3);return()=>clearTimeout(e)},[N]),a.useEffect(()=>{var e;r.step==="otp"&&f.current[0]&&((e=f.current[0])==null||e.focus())},[r.step]);const d=a.useMemo(()=>x.excul.map(e=>x.sub.includes(e.id)?{...e,status:"active",statusText:"Aktif"}:x.waiting.includes(e.id)?{...e,status:"waiting",statusText:"Menunggu"}:x.rejected.includes(e.id)?{...e,status:"rejected",statusText:"Ditolak"}:x.exited.includes(e.id)?{...e,status:"exited",statusText:"Keluar"}:{...e,status:"none",statusText:"Belum Terdaftar"}),[x]),D=a.useMemo(()=>d.filter(e=>e.status==="active"),[d]),T=a.useMemo(()=>d.filter(e=>e.status==="waiting"),[d]),H=a.useMemo(()=>d.filter(e=>e.status==="rejected"),[d]),J=a.useMemo(()=>d.filter(e=>e.status==="exited"),[d]),{data:u,setData:p,processing:M,post:w,reset:y,clearErrors:v,errors:F,setError:I}=se({otp:"",excul:0,tgl:"",ket:""}),P=a.useCallback((e=null)=>{const t={},n=e!==null,o=(E,S,b)=>{(!n||S===e)&&E&&(t[S]=b)};return o(!u.excul,"excul","Pilih Excul Anda"),o(!u.tgl,"tgl","Tanggal wajib diisi"),o(!u.ket,"ket","Masukkan alasan Anda"),t},[u]),q=a.useCallback(async(e,t)=>{try{p("excul",e),i({open:!0,step:t==="unsubscribe"?"confirm":"form",action:t,exculId:e,title:t==="subscribe"?"Form Pendaftaran":"Form Keluar Ekstrakurikuler"})}catch(n){m(`${t} failed:`,n)}},[m,p]),B=a.useCallback(async()=>{if(!r.action||r.exculId===null)return;const e=P();if(I(e),Object.keys(e).length>0){m("Validation Error : ",e);const t=Object.keys(e)[0];if(t){const n=document.getElementById(t)||document.querySelector(`[name="${t}"], [data-name="${t}"]`);n==null||n.scrollIntoView({behavior:"smooth",block:"center"})}return}try{const t=r.action==="subscribe"?"subs.excul":"unsubs.excul";await w(route(t,j),{preserveScroll:!0,preserveState:!0,onStart:()=>O(r.exculId),onSuccess:()=>{y()},onError:()=>{te.error("Permintaan Gagal"),m(h)},onFinish:()=>{O(null),i(n=>({...n,open:!1}))}})}catch(t){m(`${r.action} failed:`,t)}},[r,j,w,y,m,h,I,P]),$=a.useCallback(()=>{i(e=>({...e,open:!1})),y(),v()},[y,v]),W=e=>{e.preventDefault(),w(route("otp.verif",l.nouid),{onSuccess:()=>{k("OTP SUKSES"),B(),i(t=>({...t,step:null}))},onError:()=>{k("OTP GAGAL")}})},R=()=>{w(route("otp.send",l.nouid),{onSuccess:()=>{K(60)}})},Y=(e,t,n)=>{const o=u[t].split("");o[n]=e.charAt(e.length-1)||"",p(t,o.join(""))},Q=(e,t)=>{var n;e.key==="Backspace"&&!u.otp[t]&&t>0&&f.current[t-1]&&((n=f.current[t-1])==null||n.focus())},g=e=>{switch(e){case"active":return s.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-800",children:"Aktif"});case"waiting":return s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Menunggu"});case"rejected":return s.jsx("span",{className:"rounded bg-red-100 px-2 py-1 text-xs text-red-800",children:"Ditolak"});case"exited":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Anda telah Keluar"});case"registered":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Terdaftar"});default:return null}};return s.jsxs("div",{className:"space-y-6 p-4",children:[r.open&&r.step==="confirm"&&s.jsx(re,{open:r.step==="confirm",onOpenChange:e=>{i(t=>({...t,open:e}))},title:"Keluar Ekstrakulikuler",description:"Apakah anda yakin ingin keluar dari kegiatan ini?",confirmText:"Ya",cancelText:"Tidak",closeOnConfirm:!1,onConfirm:()=>{i(e=>({...e,open:!0,step:"form"}))}}),r.step==="form"&&s.jsx(U,{isOpen:r.open,onClose:$,onConfirm:()=>{r.action==="unsubscribe"?(R(),i(e=>({...e,step:"otp"}))):r.action==="subscribe"&&(B(),i(e=>({...e,step:null})))},confirmText:M?s.jsx(A,{className:"animate-spin"}):"Kirim",className:"w-100 mx-5",size:"xl",title:r.title,children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(L,{label:`Tanggal ${r.action==="subscribe"?"Mulai":"Berhenti"}`,name:"tgl",type:"date",onChange:e=>{p("tgl",e),v("tgl")},required:!0,error:F.tgl}),s.jsx(L,{label:`${r.action==="subscribe"?"Motivasi mendaftar":"Alasan Berhenti"}`,name:"ket",type:"textarea",onChange:e=>{p("ket",e),v("ket")},required:!0,rows:3,error:F.ket})]})}),r.step==="otp"&&s.jsx(U,{isOpen:r.open,onClose:$,className:"w-100 mx-5",size:"xl",children:s.jsx(ae,{otp:u.otp,errors:h,processing:M,countdown:N,onOtpChange:(e,t)=>Y(e,"otp",t),onKeyDown:Q,onBack:()=>i(e=>({...e,step:"form"})),onResendOtp:R,onSubmit:W,inputRefs:f})}),s.jsx("div",{className:"mb-6 flex items-center justify-between",children:s.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Ekstrakurikuler"})}),Object.keys(h).length>0&&s.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4 border-2 border-red-600",children:[s.jsx(ce,{className:"text-3xl text-red-600"}),s.jsx("span",{className:"text-md font-bold text-red-600",children:h.message??"Terjadi Kesalahan"})]}),D.length>0||T.length>0?s.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(le,{className:"text-green-500"}),"Ekstrakurikuler Aktif"]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[D.map(e=>s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-md",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",g(e.status)]})]}),s.jsx("button",{onClick:t=>{p("excul",e.id),t.preventDefault(),q(e.id,"unsubscribe")},disabled:C===e.id,className:"text-sm font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:C===e.id?s.jsx(A,{className:"animate-spin"}):"Keluar"})]}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),s.jsx("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800",children:"Lihat Jadwal"})]})]},e.id)),T.map(e=>s.jsxs("div",{className:"rounded-lg bg-yellow-50 border-2 border-yellow-500 p-4 transition-shadow hover:shadow-md",children:[s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",g(e.status)]})]})}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),z(e.id)]})]},e.id))]})]}):s.jsxs("div",{className:"py-8 text-center text-gray-500",children:[s.jsx("p",{children:"Anda belum terdaftar dalam ekstrakurikuler apapun"}),s.jsx("a",{href:"#list_excul",className:"mt-4 font-medium text-indigo-600 hover:text-indigo-800",children:"Daftar Sekarang"})]}),s.jsxs("div",{id:"list_excul",className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(ie,{className:"text-indigo-500"}),"Daftar Ekstrakurikuler Tersedia"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map(e=>{const t=e.registered===e.quota,n=T.some(c=>c.id===e.id),o=H.some(c=>c.id===e.id),E=J.some(c=>c.id===e.id),S=D.some(c=>c.id===e.id),b=C===e.id;return s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-lg",children:[s.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),o&&g("rejected"),E&&g("exited")]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(de,{className:"text-gray-400"}),e.day,", ",e.time]}),s.jsxs("p",{className:"text-gray-600",children:["Pelatih: ",e.coach]}),s.jsxs("div",{className:"flex items-center justify-between pt-2",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),t?s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Kuota Penuh"}):n?g("waiting"):s.jsx("div",{className:"flex items-center gap-4 justify-between pt-2",children:S?g("registered"):s.jsxs("button",{onClick:c=>{c.preventDefault(),q(e.id,"subscribe")},className:ne("flex items-center justify-center space-x-2 rounded bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700",b&&"bg-indigo-400 hover:bg-indigo-500"),disabled:b,children:[b&&s.jsx(A,{className:"animate-spin"}),s.jsx("span",{children:o||E?"Daftar Ulang":"Daftar"})]})})]})]})]},e.id)})})]}),s.jsx("div",{className:"rounded border-l-4 border-blue-400 bg-blue-50 p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(oe,{className:"mt-1 flex-shrink-0 text-blue-500"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-blue-800",children:"Informasi Penting"}),s.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-sm text-blue-700",children:[s.jsx("li",{children:"Setiap siswa boleh mengikuti maksimal 2 ekstrakurikuler"}),s.jsx("li",{children:"Pendaftaran ditutup ketika kuota terpenuhi"}),s.jsx("li",{children:"Kehadiran minimal 80% untuk mendapatkan sertifikat"}),s.jsx("li",{children:"Status pendaftaran akan diperiksa oleh admin"})]})]})]})})]})};export{ve as default};
