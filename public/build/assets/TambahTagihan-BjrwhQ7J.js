import{r as i,m as k,j as e}from"./app-C9ixu7w2.js";import{M as E}from"./Modal-CjER7MHQ.js";import{d as n}from"./dayjs.min-C5ebfhQ6.js";import"./utils-CXz1v5ar.js";import"./clsx-B-dksMZM.js";import"./x-Bx0CcPUh.js";const D=({open:d,onClose:o,nouid:r})=>{const[l,g]=i.useState(n().format("YYYY-MM")),[h,u]=i.useState(n().add(1,"month").format("YYYY-MM")),{data:Y,setData:p,post:y,processing:f,errors:b,reset:j}=k({nouid:r,months:[]}),x=i.useCallback(async()=>{var s;try{if(!r)throw new Error("Tagihan tidak ditemukan");const t=route("api.tagihan.last",{nouid:r}),c=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}}),a=await c.json();if(!c.ok)throw new Error(a.message||"Gagal mengambil data tagihan");if((s=a==null?void 0:a.data)!=null&&s.month){const m=n(a.data.month);g(m.format("YYYY-MM")),u(m.add(1,"month").format("YYYY-MM"))}}catch(t){console.error("Gagal ambil tagihan terakhir:",t),o&&setTimeout(()=>o(!1),1e3)}},[r,o]);i.useEffect(()=>{d&&x()},[d,x]);const M=i.useCallback((s,t)=>{const c=[];let a=n(s);const m=n(t);for(;a.isBefore(m)||a.isSame(m,"month");)c.push(a.valueOf()),a=a.add(1,"month");return c},[]);i.useEffect(()=>{const s=M(l,h);p({nouid:r,months:s})},[l,h,M,r,p]);const w=()=>{console.log(Y),y(route("api.tagihan.new",r),{onSuccess:()=>{j(),o(!1)},preserveScroll:!0})},v=s=>{const t=s.target.value;g(t),n(t).isAfter(n(h))&&u(n(t).add(1,"month").format("YYYY-MM"))},S=s=>{const t=s.target.value;n(t).isBefore(n(l))||u(t)};return e.jsx(E,{title:"Buat Tagihan SPP",isOpen:d,onClose:()=>o(!1),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Mulai"}),e.jsx("input",{type:"month",className:"input w-full rounded-md border border-gray-300 p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",value:l,onChange:v,min:n().format("YYYY-MM")}),b.months&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:b.months})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Sampai"}),e.jsx("input",{type:"month",className:"input w-full rounded-md border border-gray-300 p-2 focus:ring-2 focus:ring-blue-500 focus:outline-none",value:h,onChange:S,min:l})]}),e.jsxs("div",{className:"flex justify-end pt-4",children:[e.jsx("button",{onClick:()=>o(!1),className:"mr-2 rounded-md border border-gray-300 bg-white px-4 py-2 text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{onClick:w,disabled:f,className:`rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none ${f?"cursor-not-allowed opacity-75":""}`,children:f?"Menyimpan...":"Simpan Tagihan"})]})]})})};export{D as default};
