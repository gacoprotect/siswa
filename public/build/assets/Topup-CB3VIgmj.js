import{j as e,K as E,r as n,S as T}from"./app-BqSlKtqm.js";import{c as V}from"./utils-BtkEA63l.js";import{G as P,L as R,b as A}from"./index-whjiDzDc.js";import{A as F}from"./AppLayout-QqZgYuYf.js";import{c as G,X as K}from"./x-ByeUJ4eK.js";import{C as z}from"./copy-DD63JbbL.js";function D(l){return P({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"},child:[]}]})(l)}const _=({label:l,name:t,type:d="text",value:u,onChange:s,checked:w=!1,error:i,placeholder:b,className:g="",required:f=!1,disabled:j=!1,prefix:x="",subfix:v="",rows:S=4,tsize:p,min:o})=>{const N=`
    [type='number']::-webkit-outer-spin-button,
  [type='number']::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  [type='number'] {
    -moz-appearance: textfield;
  }
    mt-1 block w-full outline-none
    ${d==="toggle"?"rounded-full":"rounded-md"} 
    border ${i?"border-red-500":"border-gray-300"} 
    bg-muted/20 px-3 py-2 shadow-sm transition-all duration-200 text-md
    ${j?"cursor-not-allowed bg-gray-100":""} 
    ${x?"pl-12":"pr-10"}`,m=r=>{const y=r.target.value;s(y)},$=r=>{s(r)},L=()=>{if(d==="textarea")return e.jsx("textarea",{id:t,name:t,rows:S,value:u,onChange:m,placeholder:b||`Enter ${String(l).toLowerCase()}`,className:N,required:f,disabled:j,"aria-invalid":!!i,"aria-describedby":i?`${t}-error`:void 0});if(d==="rating")return e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(r=>e.jsx("button",{type:"button",onClick:()=>$(r),className:"text-2xl focus:outline-none","aria-label":`Rate ${r} star`,children:e.jsx(D,{className:r<=Number(u)?"text-yellow-400":"text-secondary-foreground"})},r)),e.jsx("input",{type:"hidden",name:t,value:u,onChange:m})]});if(d==="checkbox")return e.jsx("input",{type:"checkbox",id:t,name:t,checked:w,onChange:r=>s==null?void 0:s(r.target.checked),className:""});if(d==="toggle"){const r={xs:"text-xs",sm:"text-sm",md:"text-md",lg:"text-lg",xl:"text-xl"},h={xs:"h-4 w-12",sm:"h-5 w-14",md:"h-5 w-16",lg:"h-6 w-18",xl:"h-7 w-20"}[p??"md"],k=r[p??"md"];return e.jsxs("label",{className:`relative inline-flex items-center ${h}`,children:[e.jsx("input",{type:"checkbox",className:"peer sr-only",checked:w,onChange:I=>s==null?void 0:s(I.target.checked),name:t}),e.jsx("div",{className:"h-full w-full rounded-full bg-gray-300 transition-colors duration-300 peer-checked:bg-green-500"}),e.jsx("div",{className:"absolute top-0.5 left-0.5 aspect-square h-[calc(100%-4px)] rounded-full bg-white shadow transition-transform duration-300 peer-checked:right-0.5 peer-checked:left-auto"}),e.jsx("span",{className:`absolute right-2 ${k} font-medium text-gray-600 peer-checked:hidden`,children:"No"}),e.jsx("span",{className:`absolute left-2 hidden ${k} font-medium text-white peer-checked:inline`,children:"Yes"})]})}return e.jsx("input",{id:t,name:t,type:d==="currency"?"number":d,value:u,onChange:m,placeholder:b||(l?`Ketik ${l==null?void 0:l.toLowerCase()}`:`Ketik ${t==null?void 0:t.toLowerCase()}`),className:V(N,"appearance-none [&::-webkit-inner-spin-button]:appearance-none [&::-webkit-outer-spin-button]:appearance-none"),required:f,disabled:j,"aria-invalid":!!i,"aria-describedby":i?`${t}-error`:void 0,step:d==="currency"?"0.01":void 0,min:o})};return e.jsxs("div",{className:g,children:[l&&e.jsxs("label",{htmlFor:t,className:"block text-sm font-medium text-secondary-foreground",children:[l,f&&e.jsx("span",{className:"text-red-500",children:" *"})]}),e.jsxs("div",{className:"relative mt-1",children:[x&&e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center bg-muted px-3",children:e.jsx("span",{className:"text-sm font-bold text-muted-foreground",children:x})}),L(),v&&e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3",children:e.jsx("span",{className:"text-sm font-bold text-muted-foreground",children:v})})]}),i&&e.jsx("p",{id:`${t}-error`,className:"mt-1 text-sm text-red-600",children:i})]})};/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],O=G("Check",B),C=1e4,M=[{id:1,amount:5e4},{id:2,amount:1e5},{id:3,amount:2e5},{id:4,amount:3e5},{id:5,amount:5e5},{id:6,amount:1e6}],Q=({siswa:l,nouid:t,onClose:d})=>{const{errors:u}=E().props,[s,w]=n.useState(null),[i,b]=n.useState(null),[g,f]=n.useState(""),[j,x]=n.useState(!1),[v,S]=n.useState(!1),[p,o]=n.useState(null),[N,m]=n.useState(null),[$,L]=n.useState(!1),r=n.useCallback(async()=>{if(!s){m("Nomor VA belum tersedia");return}try{await navigator.clipboard.writeText(s),L(!0),m(null),setTimeout(()=>L(!1),2e3)}catch(a){m("Gagal menyalin nomor VA. Silakan salin manual."),console.error("Gagal menyalin:",a)}},[s]),y=n.useCallback(async()=>{try{S(!0),o(null),m(null);const a=await fetch(route("api.reqVA",t));if(!a.ok)throw new Error("Gagal memuat data pembayaran");const c=await a.json();if(c.success!==!0)throw new Error(c.message||"Terjadi kesalahan pada server");w(c.va_number)}catch(a){o(a instanceof Error?a.message:"Terjadi kesalahan jaringan")}finally{S(!1)}},[t]);n.useEffect(()=>{y()},[y]);const h=n.useMemo(()=>{var a;return g?parseInt(g):i&&((a=M.find(c=>c.id===i))==null?void 0:a.amount)||null},[g,i]),k=n.useCallback(()=>h?h<C?(o(`Minimal topup adalah Rp ${C.toLocaleString("id-ID")}`),!1):s?!0:(o("Nomor Virtual Account tidak valid"),!1):(o("Harap pilih nominal topup!"),!1),[h,s]),I=n.useCallback(async a=>{if(a.preventDefault(),x(!0),o(null),!k()){x(!1);return}try{await T.post(route("topup.charge",t),{va_number:s,amount:h,nouid:t},{onError:c=>{o((c==null?void 0:c.message)||"Gagal memproses pembayaran")}})}catch(c){o("Terjadi kesalahan saat memproses pembayaran"),console.error(c)}finally{x(!1)}},[h,t,k,s]);return e.jsx(F,{title:"Top Up",children:e.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:[e.jsxs("button",{onClick:d,className:"flex items-center space-x-2 transition-opacity hover:opacity-80","aria-label":"Kembali",children:[e.jsx(R,{className:"text-primary-foreground"}),e.jsx("span",{children:"Kembali"})]}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Topup Saldo"})]}),v?e.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center space-y-3",children:[e.jsx(A,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg text-gray-700",children:"Memuat data pembayaran..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Informasi Siswa"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nama"}),e.jsx("p",{className:"font-medium",children:l.namlen})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"NISN"}),e.jsx("p",{className:"font-medium",children:l.nis})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Kelas"}),e.jsx("p",{className:"font-medium",children:l.kel})]})]})]}),p&&e.jsxs("div",{className:"mb-4 flex items-start space-x-2 rounded-lg bg-red-100 p-3 text-red-700",children:[e.jsx(K,{className:"mt-0.5 h-5 w-5 flex-shrink-0"}),e.jsx("span",{children:p})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Bank"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("span",{className:"text-gray-600",children:"Nomor Virtual Account:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg font-bold",children:s||"Loading..."}),s&&e.jsx("button",{onClick:r,className:"text-gray-500 hover:text-black","aria-label":"Salin nomor VA",type:"button",children:$?e.jsx(O,{className:"h-4 w-4 text-green-500"}):e.jsx(z,{className:"h-4 w-4"})})]}),N&&e.jsx("p",{className:"text-sm text-red-500",children:N}),e.jsx("p",{className:"text-sm text-gray-500",children:"Salin nomor VA untuk melakukan pembayaran melalui ATM/Mobile Banking"})]})]}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold text-primary",children:"Pilih Nominal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[M.map(a=>e.jsx("button",{type:"button",className:`${p&&"border-2 border-red-600"} rounded-lg border p-3 transition-all ${i===a.id?"border-primary bg-primary text-primary-foreground shadow-sm":"border-primary bg-primary-foreground hover:bg-primary-foreground/40"}`,onClick:()=>{b(a.id),f(""),o(null)},"aria-label":`Pilih Rp ${a.amount.toLocaleString("id-ID")}`,children:e.jsxs("div",{className:"font-medium",children:["Rp ",a.amount.toLocaleString("id-ID")]})},a.id)),e.jsx(_,{onChange:a=>{f(a?String(a):""),b(null),o(null)},name:"nominal",placeholder:"Masukkan nominal custom",value:g,prefix:"Rp",className:`col-span-2 ${p&&"border-2 border-red-600"}`,type:"number",min:C}),u.nominal&&e.jsx("p",{className:"text-sm text-red-500",children:u.nominal})]})]}),e.jsx("button",{type:"submit",className:"w-full rounded-lg bg-blue-600 px-4 py-3 text-white transition duration-200 hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-blue-400",disabled:j,"aria-label":"Lanjutkan pembayaran",children:j?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(A,{className:"animate-spin"}),"Memproses..."]}):"Lanjutkan Pembayaran"})]})]}),e.jsxs("div",{className:"mx-auto mt-6 max-w-md rounded-lg bg-white p-6 shadow-md",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Panduan Topup"}),e.jsxs("ul",{className:"list-disc space-y-2 pl-5 text-sm text-gray-700",children:[e.jsx("li",{children:"Proses topup membutuhkan waktu 1-5 menit"}),e.jsx("li",{children:"Pastikan nominal yang ditransfer sesuai dengan yang dipilih"}),e.jsxs("li",{children:["Minimal topup Rp ",C.toLocaleString("id-ID")]}),e.jsx("li",{children:"Jika mengalami kendala, hubungi customer service"})]})]})]})]})})};export{Q as default};
