import{R as C,j as e,r as k,K as T,m as E,a as U,L as G,S as q}from"./app-CUK3jhPj.js";import{A as z}from"./arrow-left-D1tF6RVz.js";import{M as W}from"./Modal-CgjoREFZ.js";import{j as H}from"./index-N2WP3azp.js";const O=C.forwardRef(({value:c,onChange:o,onKeyDown:j,onPaste:m,type:y="text",error:p=!1,autoFocus:b=!1},l)=>e.jsx("input",{ref:l,type:y,inputMode:"numeric",pattern:"[0-9]*",maxLength:1,required:!0,autoComplete:"off",className:`h-12 w-12 rounded-md border text-center text-2xl focus:ring-1 focus:outline-none ${p?"border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"}`,value:c,onChange:o,onKeyDown:j,onPaste:m,autoFocus:b,onFocus:v=>v.target.select()}));O.displayName="DigitInput";const J=({otp:c,phone:o,errors:j,processing:m,countdown:y,onOtpChange:p,onKeyDown:b,onBack:l,onResendOtp:v,onSubmit:d,inputRefs:h})=>{const w=(N,i)=>{var x;const a=N.target.value.replace(/\D/g,"");p(a,i),a&&i<5&&h.current[i+1]&&((x=h.current[i+1])==null||x.focus())};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:l,className:"flex items-center text-sm text-gray-600 hover:text-gray-800",type:"button",children:[e.jsx(z,{className:"mr-1 h-4 w-4"}),"Kembali"]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Verifikasi OTP"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Masukkan 6 digit kode OTP yang dikirim ke ",o??"Whatsapp Anda"]})]}),j.otp&&e.jsx("div",{className:"text-center text-sm text-red-500",children:j.otp}),e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((N,i)=>e.jsx(O,{ref:a=>{h.current[i]=a},value:c[i]||"",onChange:a=>w(a,i),onKeyDown:a=>b(a,i),error:!!j.otp,autoFocus:i===0},i))}),e.jsx("div",{className:"text-center",children:y>0?e.jsxs("p",{className:"text-sm text-gray-500",children:["Kirim ulang OTP dalam ",y," detik"]}):e.jsx("button",{type:"button",onClick:v,className:"text-sm text-blue-600 hover:text-blue-800",children:"Kirim Ulang OTP"})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:m||c.length!==6,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${c.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:m?"Memverifikasi...":"Verifikasi"})})]})]})},Q=({pin:c,errors:o,inputType:j,processing:m,onPinChange:y,onKeyDown:p,onPaste:b,onToggleInputType:l,onSubmit:v,inputRefs:d})=>{const[h,w]=k.useState(Object.keys(o).length>0),N=(i,a)=>{var D;w(!1);const x=i.target.value.replace(/\D/g,"");y(i,a),x&&a<5&&d.current[a+1]&&((D=d.current[a+1])==null||D.focus())};return k.useEffect(()=>{o&&w(Object.keys(o).length>0)},[o]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:v,children:[e.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((i,a)=>e.jsx(O,{ref:x=>{d.current[a]=x},type:j,value:c[a]||"",onChange:x=>N(x,a),onKeyDown:x=>p(x,a),onPaste:b,autoFocus:a===0,error:h},a))}),h&&(o.pin||o.message)&&e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:o.pin??o.message}),parseInt(o.remaining)<3&&e.jsx("span",{children:o.remaining?`sisa percobaan ${o.remaining}`:""})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:l,children:j==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:m||c.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${c.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:m?"Memverifikasi...":"Masuk"})})]})]})})},X=({errors:c,inputType:o,onToggleInputType:j,onSukses:m})=>{const{data:y}=T().props,[p,b]=k.useState(Object.keys(c).length>0),{data:l,setData:v,post:d,processing:h,reset:w}=E({pin:"",pin_confirmation:""}),N=C.useRef(Array(6).fill(null)),i=C.useRef(Array(6).fill(null)),a=f=>{f.preventDefault(),d(route("siswa.process-setup-pin",y.nouid),{onSuccess:()=>{m==null||m(),w()}})},x=(f,r,t)=>{var P;const u=l[t].split("");u[r]=f.charAt(f.length-1)||"",v(t,u.join("")),f&&r<5&&((P=(t==="pin"?N:i).current[r+1])==null||P.focus())},D=(f,r,t)=>{var u;f.key==="Backspace"&&!l[t][r]&&r>0&&((u=(t==="pin"?N:i).current[r-1])==null||u.focus())},S=(f,r)=>{var u;f.preventDefault();const t=f.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(t.length>0){v(r,t);const P=Math.min(t.length-1,5);(u=(r==="pin"?N:i).current[P])==null||u.focus()}};return k.useEffect(()=>{b(Object.keys(c).length>0)},[c]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Buat PIN 6 Digit Baru"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Untuk keamanan akun Anda"})]}),(c.pin||c.pin_confirmation)&&e.jsx("div",{className:"text-center text-sm text-red-500",children:c.pin||c.pin_confirmation}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:a,children:[e.jsxs("div",{className:"flex flex-col gap-2 justify-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Masukkan PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((f,r)=>e.jsx(O,{ref:t=>{N.current[r]=t},type:o,value:l.pin[r]||"",onChange:t=>{const u=t.target.value.replace(/\D/g,"");x(u,r,"pin")},onKeyDown:t=>D(t,r,"pin"),onPaste:t=>S(t,"pin"),autoFocus:r===0&&l.pin.length===0,error:p},`pin-${r}`))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin_confirmation",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Konfirmasi PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((f,r)=>e.jsx(O,{ref:t=>{i.current[r]=t},type:o,value:l.pin_confirmation[r]||"",onChange:t=>{const u=t.target.value.replace(/\D/g,"");x(u,r,"pin_confirmation")},onKeyDown:t=>D(t,r,"pin_confirmation"),onPaste:t=>S(t,"pin_confirmation"),autoFocus:r===0&&l.pin.length===6&&l.pin_confirmation.length===0,error:p},`pin-confirm-${r}`))})]})]}),p&&(c.pin||c.message)&&e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:c.pin??c.message}),c.remaining&&parseInt(c.remaining)<3&&e.jsx("span",{children:`Sisa percobaan ${c.remaining}`})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:j,children:o==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:h||l.pin.length!==6||l.pin_confirmation.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${l.pin.length===6&&l.pin_confirmation.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:h?"Memproses...":"Simpan PIN"})})]})]})})},Y=({handle:c,setPage:o,hasPin:j,open:m,onClose:y})=>{const{errors:p,data:b}=T().props,{error:l,log:v}=U(),{data:d,setData:h,post:w,processing:N,reset:i}=E({pin:"",nouid:b.nouid??"",otp:""}),[a,x]=k.useState("password"),[D,S]=k.useState(0),[f,r]=k.useState("pin"),t=k.useRef(Array(6).fill(null)),u=k.useRef(Array(6).fill(null));k.useEffect(()=>{if(D<=0)return;const n=setTimeout(()=>S(D-1),1e3);return()=>clearTimeout(n)},[D]),k.useEffect(()=>{var n,s;m&&t.current[0]&&((n=t.current[0])==null||n.focus()),m&&u.current[0]&&((s=u.current[0])==null||s.focus())},[m]);const P=n=>{n.preventDefault(),/^\d{6}$/.test(d.pin)&&w(route("siswa.verify-pin",{nouid:b.nouid,p:c??"auth"}),{preserveState:!0,onSuccess:()=>{o("index"),i(),y(!1)},onError:()=>{var s;h("pin",""),t.current[0]&&((s=t.current[0])==null||s.focus()),l(p)},onFinish:()=>{}})},_=(n,s)=>{const g=d.pin.split("");g[s]=n.charAt(n.length-1)||"",h("pin",g.join(""))},M=()=>{q.get(route("register",d.nouid))},B=(n,s)=>{var g;n.key==="Backspace"&&!d.pin[s]&&s>0&&t.current[s-1]&&((g=t.current[s-1])==null||g.focus())},R=(n,s)=>{var I;n.preventDefault();const g=n.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(g.length>0){h(s,g);const K=Math.min(g.length-1,5),A=t;A!=null&&A.current[K]&&((I=A.current[K])==null||I.focus())}},F=n=>{n.preventDefault(),w(route("otp.verif",b.nouid),{onSuccess:()=>{v("OTP SUKSES"),r("setup")},onError:()=>{v("OTP GAGAL")}})},$=()=>{w(route("otp.send",b.nouid),{onSuccess:()=>{S(60)}})},L=(n,s,g)=>{const I=d[s].split("");I[g]=n.charAt(n.length-1)||"",h(s,I.join(""))},V=(n,s)=>{var g;n.key==="Backspace"&&!d.otp[s]&&s>0&&u.current[s-1]&&((g=u.current[s-1])==null||g.focus())};return k.useEffect(()=>{v("STEP : ",f),p.pin&&parseInt(p.remaining)===0&&r("otp")},[p.pin]),e.jsx(W,{title:j?"":"Anda Belum Terverifikasi",isOpen:m,onClose:()=>y(!1),header:!1,children:j?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(G,{title:"Masukkan PIN"}),e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[f==="pin"&&e.jsx(Q,{pin:d.pin,errors:p,inputType:a,processing:N,onPinChange:(n,s)=>_(n.target.value,s),onKeyDown:B,onPaste:n=>R(n,"pin"),onToggleInputType:()=>x(a==="password"?"text":"password"),onSubmit:P,setInputRef:(n,s)=>{t.current[s]=n},inputRefs:t}),f==="otp"&&e.jsx(J,{otp:d.otp,errors:p,processing:N,countdown:D,onOtpChange:(n,s)=>L(n,"otp",s),onKeyDown:V,onBack:()=>y(!1),onResendOtp:$,onSubmit:F,inputRefs:u}),f==="setup"&&e.jsx(X,{errors:p,inputType:a,onToggleInputType:()=>x(a==="password"?"text":"password"),onSukses:()=>y(!1)})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"max-w-md text-sm",children:"Untuk melanjutkan silahkan verifikasi identitas diri Anda terlebih dahulu"}),e.jsxs("button",{onClick:M,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[e.jsx(H,{className:"text-lg"}),e.jsx("span",{children:"Verifikasi Sekarang"})]})]})})},se=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"}));export{J as O,Q as P,Y as a,se as b};
