import{K as T,r as s,S as V,j as e}from"./app-eSOozAuS.js";import{I as P}from"./InputGroup-CufayXuF.js";import{A as R}from"./AppLayout-tgsqiujE.js";import{e as D,b as S}from"./index-CnSDO34b.js";import{X as F}from"./x-Dd4G8X-v.js";import{C as G}from"./check-Caew6H7u.js";import{C as $}from"./copy-BgSRWZrt.js";/* empty css            */import"./utils-CXz1v5ar.js";import"./clsx-B-dksMZM.js";import"./iconBase-DkwQ6Xed.js";import"./index-DKfz7pY-.js";const u=1e4,w=[{id:1,amount:5e4},{id:2,amount:1e5},{id:3,amount:2e5},{id:4,amount:3e5},{id:5,amount:5e5},{id:6,amount:1e6}],Y=({siswa:p,nouid:n,onClose:C})=>{const{errors:h}=T().props,[l,A]=s.useState(null),[o,b]=s.useState(null),[m,g]=s.useState(""),[f,x]=s.useState(!1),[I,j]=s.useState(!1),[c,r]=s.useState(null),[N,d]=s.useState(null),[L,y]=s.useState(!1),E=s.useCallback(async()=>{if(!l){d("Nomor VA belum tersedia");return}try{await navigator.clipboard.writeText(l),y(!0),d(null),setTimeout(()=>y(!1),2e3)}catch(a){d("Gagal menyalin nomor VA. Silakan salin manual."),console.error("Gagal menyalin:",a)}},[l]),k=s.useCallback(async()=>{try{j(!0),r(null),d(null);const a=await fetch(route("api.reqVA",n));if(!a.ok)throw new Error("Gagal memuat data pembayaran");const t=await a.json();if(t.success!==!0)throw new Error(t.message||"Terjadi kesalahan pada server");A(t.va_number)}catch(a){r(a instanceof Error?a.message:"Terjadi kesalahan jaringan")}finally{j(!1)}},[n]);s.useEffect(()=>{k()},[k]);const i=s.useMemo(()=>{var a;return m?parseInt(m):o&&((a=w.find(t=>t.id===o))==null?void 0:a.amount)||null},[m,o]),v=s.useCallback(()=>i?i<u?(r(`Minimal topup adalah Rp ${u.toLocaleString("id-ID")}`),!1):l?!0:(r("Nomor Virtual Account tidak valid"),!1):(r("Harap pilih nominal topup!"),!1),[i,l]),M=s.useCallback(async a=>{if(a.preventDefault(),x(!0),r(null),!v()){x(!1);return}try{await V.post(route("topup.charge",n),{va_number:l,amount:i,nouid:n},{onError:t=>{r((t==null?void 0:t.message)||"Gagal memproses pembayaran")}})}catch(t){r("Terjadi kesalahan saat memproses pembayaran"),console.error(t)}finally{x(!1)}},[i,n,v,l]);return e.jsx(R,{title:"Top Up",children:e.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:[e.jsxs("button",{onClick:C,className:"flex items-center space-x-2 transition-opacity hover:opacity-80","aria-label":"Kembali",children:[e.jsx(D,{className:"text-primary-foreground"}),e.jsx("span",{children:"Kembali"})]}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Topup Saldo"})]}),I?e.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center space-y-3",children:[e.jsx(S,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg text-gray-700",children:"Memuat data pembayaran..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 rounded-lg bg-gray-50 p-4",children:[e.jsx("h2",{className:"mb-2 text-lg font-semibold",children:"Informasi Siswa"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nama"}),e.jsx("p",{className:"font-medium",children:p.namlen})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"NISN"}),e.jsx("p",{className:"font-medium",children:p.nis})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Kelas"}),e.jsx("p",{className:"font-medium",children:p.kel})]})]})]}),c&&e.jsxs("div",{className:"mb-4 flex items-start space-x-2 rounded-lg bg-red-100 p-3 text-red-700",children:[e.jsx(F,{className:"mt-0.5 h-5 w-5 flex-shrink-0"}),e.jsx("span",{children:c})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Bank"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx("span",{className:"text-gray-600",children:"Nomor Virtual Account:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg font-bold",children:l||"Loading..."}),l&&e.jsx("button",{onClick:E,className:"text-gray-500 hover:text-black","aria-label":"Salin nomor VA",type:"button",children:L?e.jsx(G,{className:"h-4 w-4 text-green-500"}):e.jsx($,{className:"h-4 w-4"})})]}),N&&e.jsx("p",{className:"text-sm text-red-500",children:N}),e.jsx("p",{className:"text-sm text-gray-500",children:"Salin nomor VA untuk melakukan pembayaran melalui ATM/Mobile Banking"})]})]}),e.jsxs("form",{onSubmit:M,children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold text-primary",children:"Pilih Nominal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[w.map(a=>e.jsx("button",{type:"button",className:`${c&&"border-2 border-red-600"} rounded-lg border p-3 transition-all ${o===a.id?"border-primary bg-primary text-primary-foreground shadow-sm":"border-primary bg-primary-foreground hover:bg-primary-foreground/40"}`,onClick:()=>{b(a.id),g(""),r(null)},"aria-label":`Pilih Rp ${a.amount.toLocaleString("id-ID")}`,children:e.jsxs("div",{className:"font-medium",children:["Rp ",a.amount.toLocaleString("id-ID")]})},a.id)),e.jsx(P,{onChange:a=>{g(a?String(a):""),b(null),r(null)},name:"nominal",placeholder:"Masukkan nominal custom",value:m,prefix:"Rp",className:`col-span-2 ${c&&"border-2 border-red-600"}`,type:"number",min:u}),h.nominal&&e.jsx("p",{className:"text-sm text-red-500",children:h.nominal})]})]}),e.jsx("button",{type:"submit",className:"w-full rounded-lg bg-blue-600 px-4 py-3 text-white transition duration-200 hover:bg-blue-700 disabled:cursor-not-allowed disabled:bg-blue-400",disabled:f,"aria-label":"Lanjutkan pembayaran",children:f?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(S,{className:"animate-spin"}),"Memproses..."]}):"Lanjutkan Pembayaran"})]})]}),e.jsxs("div",{className:"mx-auto mt-6 max-w-md rounded-lg bg-white p-6 shadow-md",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Panduan Topup"}),e.jsxs("ul",{className:"list-disc space-y-2 pl-5 text-sm text-gray-700",children:[e.jsx("li",{children:"Proses topup membutuhkan waktu 1-5 menit"}),e.jsx("li",{children:"Pastikan nominal yang ditransfer sesuai dengan yang dipilih"}),e.jsxs("li",{children:["Minimal topup Rp ",u.toLocaleString("id-ID")]}),e.jsx("li",{children:"Jika mengalami kendala, hubungi customer service"})]})]})]})]})})};export{Y as default};
