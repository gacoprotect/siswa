import{j as e,r as i}from"./app-DEqabZ7I.js";import{e as _,b as D,A as M,B,p as F}from"./index-BLUXveWf.js";import R from"./TambahTagihan-DoVuruq6.js";import{X as K}from"./x-Dz1pX70a.js";import"./Modal-ClQm1M1s.js";import"./utils-CQjs5a-7.js";import"./clsx-B-dksMZM.js";const O=({setparam:l,summary:r})=>{const c=({tagihan:o,spr:g,jen1:j})=>{l({spr:g,jen1:j,tagihan:o})};return e.jsxs("button",{onClick:()=>c({tagihan:r.total_tagihan,spr:r.spr,jen1:r.jen1}),className:"flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700","aria-label":"Bayar tagihan sekarang",children:[e.jsx(_,{className:"text-sm"}),"Bayar Sekarang"]})},w=768;function A(){const[l,r]=i.useState();return i.useEffect(()=>{const c=window.matchMedia(`(max-width: ${w-1}px)`),o=()=>{r(window.innerWidth<w)};return c.addEventListener("change",o),r(window.innerWidth<w),()=>c.removeEventListener("change",o)},[]),!!l}const C=({title:l,value:r,icon:c,bgColor:o})=>e.jsx("div",{className:`${o} rounded-lg p-4 shadow-sm`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:l}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:r})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:c})]})}),X=({nouid:l,setTagihanParam:r})=>{const c=A(),[o,g]=i.useState(!0),[j,N]=i.useState(!1),[p,v]=i.useState([]),[k,T]=i.useState(null),[x,$]=i.useState({total_tagihan:0,sisa_tagihan:0,total_disc:0,spr:[],jen1:[]});i.useEffect(()=>{(async()=>{try{T(null);const d=await fetch(route("tagihan.index",l));if(!d.ok)throw new Error("Gagal memuat data tagihan");const a=await d.json();if(a.success)throw new Error("Terjadi kesalahan server");v(a.data),$(a.summary)}catch(d){T(d instanceof Error?d.message:"Terjadi kesalahan jaringan")}finally{g(!1)}})()},[l]);const I=i.useCallback(t=>{var d;(d=t==null?void 0:t.data)!=null&&d.length&&(v(a=>{const f=new Set(a.map(s=>`${s.tah}-${s.bulan.toLowerCase()}-${s.ket}`)),y=t.data.filter(s=>{const m=s.bulan.toLowerCase(),h=`${s.tah}-${m}-${s.ket}`;return!f.has(h)});return[...a,...y].sort((s,m)=>{const h=parseInt(m.tah)-parseInt(s.tah);if(h!==0)return h;const n=["januari","februari","maret","april","mei","juni","juli","agustus","september","oktober","november","desember"];return n.indexOf(s.bulan.toLowerCase())-n.indexOf(m.bulan.toLowerCase())})}),$(a=>{const f=new Set(a.spr),y=new Set(a.jen1),S=new Set(p.map(n=>`${n.tah}-${n.bulan.toLowerCase()}-${n.ket}`));let s=0;const m=[],h=[];return t.data.forEach((n,u)=>{const E=n.bulan.toLowerCase(),L=`${n.tah}-${E}-${n.ket}`;S.has(L)||(f.has(t.spr[u])||m.push(t.spr[u]),t.jen1[u]&&!y.has(t.jen1[u])&&h.push(t.jen1[u]),s+=n.jumlah)}),{...a,spr:[...a.spr,...m],jen1:[...a.jen1,...h],total_tagihan:a.total_tagihan+s,sisa_tagihan:a.total_tagihan+s-(a.total_pembayaran||0)-(a.total_disc||0)}}))},[p]),b=t=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(t);return o?e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(D,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:"Memuat data"})]}):k?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4 text-red-600",children:[e.jsx(K,{className:"animate-pulse"}),e.jsx("span",{children:k})]}):e.jsxs("div",{className:"space-y-6 p-2",children:[x&&e.jsxs("div",{className:`grid gap-4 ${c?"grid-cols-1":"grid-cols-2"}`,children:[e.jsx(C,{title:"Total Tagihan",value:`Rp ${x.total_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(_,{className:"text-green-500"}),bgColor:"bg-green-50"}),e.jsx(C,{title:"Sisa Tagihan",value:`Rp ${x.sisa_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(M,{className:"text-amber-500"}),bgColor:"bg-amber-50"})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(B,{className:"text-sm"}),"Buat Tagihan"]}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700",children:[e.jsx(F,{className:"text-sm"}),"Riwayat"]})]}),p.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Tidak ada data tagihan"}):e.jsx("div",{className:"mb-6 flex items-center justify-center",children:e.jsxs("div",{className:"w-full border-b p-2",children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold sm:mb-4 sm:text-xl",children:"Rincian Tagihan"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Tahun"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Keterangan"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:t.tah}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:t.bulan}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:b(t.jumlah)}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:t.ket})]},`${t.tah}-${t.bulan}-${t.ket}`))})]})}),x.total_disc!==0&&e.jsxs("div",{className:"mt-4 flex items-center justify-between sm:mt-6",children:[e.jsx("span",{className:"text-base font-semibold sm:text-lg",children:"Pengurangan:"}),e.jsx("span",{className:"text-xl font-bold text-blue-600 sm:text-2xl",children:b(x.total_disc??0)})]}),e.jsxs("div",{className:"flex items-center justify-between sm:mt-6",children:[e.jsx("span",{className:"text-base font-semibold sm:text-lg",children:"Tagihan:"}),e.jsx("span",{className:"text-xl font-bold text-blue-600 sm:text-2xl",children:b(x.total_tagihan-(x.total_disc??0))})]}),e.jsx("div",{className:"mt-6 flex items-center justify-end",children:e.jsx(O,{setparam:t=>r(t),summary:x})})]})}),e.jsx(R,{setTambahTagihan:I,open:j,onClose:()=>N(!1),nouid:l})]})};export{X as default};
