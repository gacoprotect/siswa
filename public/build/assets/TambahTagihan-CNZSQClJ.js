import{r,j as e}from"./app-8clPXT22.js";import{M as E}from"./Modal-CjT1iwV8.js";import{b as T}from"./index-DW2bR4uz.js";import"./utils-CXz1v5ar.js";import"./clsx-B-dksMZM.js";import"./x-D7Mut8Zw.js";const y=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],I=({open:c,onClose:d,nouid:i,setTambahTagihan:u})=>{const[h,w]=r.useState({}),[v,p]=r.useState(!1),[s,g]=r.useState(""),[n,x]=r.useState(""),[b,o]=r.useState(""),j=new Date,N=j.getFullYear(),k=y[j.getMonth()],f=r.useCallback(async()=>{p(!0);try{const a=route("api.tagihan.exists",{nouid:i}),t=await fetch(a),l=await t.json();if(!t.ok)throw new Error(l.message);const m=l.data||{};w(m)}catch(a){console.error("Gagal ambil tagihan:",a)}finally{p(!1)}},[i]);r.useEffect(()=>{c&&(g(""),x(""),o(""),f())},[c,f]);const S=s?(h[s]||[]).sort((a,t)=>a-t).map(a=>({value:a,label:y[a-1]})):[],M=r.useCallback(async()=>{if(!s||!n){o("Harap pilih tahun dan bulan terlebih dahulu.");return}o("");try{const a=route("api.tagihan.add",{nouid:i})+`?t=${s}&b=${n}`,t=await fetch(a),l=await t.json();if(!t.ok||!l.success)throw new Error(l.message);const m=l.data||{};u(m),d(!1)}catch(a){console.error("Gagal ambil tagihan:",a),o("Gagal mengambil data tagihan. Coba lagi.")}},[i,s,n,d,u]);return e.jsx(E,{title:"Pilih Tagihan",isOpen:c,onClose:()=>d(!1),children:e.jsx("div",{className:"max-h-[75vh] space-y-6 overflow-y-auto px-1",children:v?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(T,{className:"mb-2 animate-spin text-2xl"}),e.jsx("span",{children:"Memuat data tagihan..."})]}):Object.keys(h).length===0?e.jsx("p",{className:"py-4 text-center text-gray-600",children:"Tidak ada data tagihan tersedia"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-gray-700",children:"Dari:"}),e.jsxs("div",{className:"flex flex-row gap-3",children:[e.jsx("select",{disabled:!0,className:"w-full rounded-md border bg-gray-100 px-4 py-2 text-gray-800",children:e.jsx("option",{children:k})}),e.jsx("select",{disabled:!0,className:"w-full rounded-md border bg-gray-100 px-4 py-2 text-gray-800",children:e.jsx("option",{children:N})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-semibold text-gray-700",children:"Sampai:"}),e.jsxs("div",{className:"flex flex-row gap-3",children:[e.jsxs("select",{value:s,onChange:a=>{g(a.target.value),x("")},className:"w-full rounded-md border bg-white px-4 py-2 text-gray-800",children:[e.jsx("option",{value:"",children:"-- Pilih Tahun --"}),Object.keys(h).sort((a,t)=>parseInt(t)-parseInt(a)).map(a=>e.jsxs("option",{value:a,children:["Tahun ",a]},a))]}),e.jsxs("select",{value:n,onChange:a=>x(parseInt(a.target.value)),className:"w-full rounded-md border bg-white px-4 py-2 text-gray-800 capitalize",disabled:!s,children:[e.jsx("option",{value:"",children:"-- Pilih Bulan --"}),S.map(({value:a,label:t})=>e.jsx("option",{value:a,children:t},a))]})]})]})]}),b&&e.jsx("p",{className:"pt-2 text-sm text-red-600",children:b}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{disabled:!s||!n,onClick:M,className:"rounded-md bg-blue-600 px-5 py-2 text-white transition hover:bg-blue-700",children:"Tambahkan Tagihan"})})]})})})};export{I as default};
