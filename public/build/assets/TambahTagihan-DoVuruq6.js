import{r as o,j as t}from"./app-DEqabZ7I.js";import{M as I}from"./Modal-ClQm1M1s.js";import{a as J}from"./utils-CQjs5a-7.js";import{b as P,C as R,D as Y}from"./index-BLUXveWf.js";import"./x-Dz1pX70a.js";import"./clsx-B-dksMZM.js";const E=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],H=({open:h,onClose:p,nouid:f,setTambahTagihan:M})=>{const[m,C]=o.useState({}),[b,j]=o.useState({}),[g,N]=o.useState({}),[k,w]=o.useState(!1),v=o.useCallback(async()=>{w(!0);try{const e=route("api.tagihan.add",{nouid:f}),a=await fetch(e),s=await a.json();if(!a.ok)throw new Error(s.message);const i=s.data||{};C(i);const l={},n={};Object.keys(i).forEach(r=>{l[r]=!1,n[r]={},Object.keys(i[r]).forEach(u=>{n[r][u]=!1})}),j(l),N(n)}catch(e){console.error("Gagal ambil tagihan:",e)}finally{w(!1)}},[f]);o.useEffect(()=>{h&&v()},[h,v]);const T=e=>{j(a=>({...a,[e]:!a[e]}))},D=(e,a)=>{N(s=>({...s,[e]:{...s[e],[a]:!s[e][a]}}))},F=()=>{const e=[],a=[],s=[];Object.entries(g).forEach(([l,n])=>{Object.entries(n).forEach(([r,u])=>{var S;if(!u)return;const y=((S=m[l])==null?void 0:S[r])??[],d=y.find(c=>c.jen===0),O=y.filter(c=>c.jen===1);if(d){e.push(d.id),a.push(...O.map(x=>x.id));const c=O.reduce((x,$)=>x+$.jumlah,0);s.push({tah:l,bulan:J(r),ket:d.ket,jumlah:d.jumlah-c})}})});const i={spr:e,jen1:a,data:s};s.length>0&&(M(i),p(!1))};return t.jsx(I,{title:"Pilih Tagihan SPP",isOpen:h,onClose:()=>p(!1),children:t.jsxs("div",{className:"max-h-[75vh] space-y-6 overflow-y-auto px-1",children:[k?t.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[t.jsx(P,{className:"mb-2 animate-spin text-2xl"}),t.jsx("span",{children:"Memuat data tagihan..."})]}):Object.keys(m).length===0?t.jsx("p",{className:"py-4 text-center text-gray-600",children:"Tidak ada data tagihan tersedia"}):Object.entries(m).sort(([e],[a])=>parseInt(a)-parseInt(e)).map(([e,a])=>t.jsxs("div",{className:"overflow-hidden rounded-lg border shadow-sm",children:[t.jsxs("button",{className:"flex w-full items-center justify-between bg-gray-100 px-4 py-3 transition-colors hover:bg-gray-200",onClick:()=>T(e),children:[t.jsxs("span",{className:"font-semibold text-gray-800",children:["Tahun ",e]}),b[e]?t.jsx(R,{}):t.jsx(Y,{})]}),b[e]&&t.jsx("div",{className:"space-y-3 bg-white px-4 py-3 transition-all",children:Object.keys(a).sort((s,i)=>E.indexOf(s)-E.indexOf(i)).map(s=>{var l;const i=a[s].filter(n=>n.jen===0);return i.length===0?null:t.jsxs("div",{className:"flex items-start rounded-lg border border-gray-200 p-3 shadow-sm transition-shadow hover:shadow-md",children:[t.jsx("input",{type:"checkbox",id:`${e}-${s}`,checked:((l=g[e])==null?void 0:l[s])||!1,onChange:()=>D(e,s),className:"mt-1 mr-3 accent-blue-600"}),t.jsxs("label",{htmlFor:`${e}-${s}`,className:"flex-1 cursor-pointer",children:[t.jsx("div",{className:"font-medium text-gray-800 capitalize",children:s}),i.map(n=>t.jsxs("div",{className:"ml-2 text-sm text-gray-600",children:[n.ket," â€” Rp ",n.jumlah.toLocaleString("id-ID")]},n.id))]})]},s)})})]},e)),t.jsx("div",{className:"flex justify-end pt-4",children:t.jsx("button",{onClick:F,disabled:k,className:"rounded-md bg-blue-600 px-5 py-2 text-white transition hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Tambahkan Tagihan"})})]})})};export{H as default};
