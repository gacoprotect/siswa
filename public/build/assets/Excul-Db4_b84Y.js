import{K as O,a as U,u as z,r as t,S,m as H,j as e}from"./app-eSOozAuS.js";import{I}from"./InputGroup-CufayXuF.js";import{M as J}from"./Modal-Bhge-kc4.js";import{c as W}from"./utils-CXz1v5ar.js";import{b as E,E as Q,G as V,H as X,I as Y}from"./index-CnSDO34b.js";import{y as K}from"./index-DKfz7pY-.js";import{C as Z}from"./circle-alert-hs5VovEv.js";/* empty css            */import"./iconBase-DkwQ6Xed.js";import"./x-Dd4G8X-v.js";import"./clsx-B-dksMZM.js";const ue=({nouid:n,onClose:C})=>{const{data:d,errors:o}=O().props,{log:D,error:c}=U(),{APP_DEBUG:P}=z(),[A,j]=t.useState(!0),[b,g]=t.useState(null),[r,N]=t.useState({open:!1,action:null,exculId:null,title:""}),[u,q]=t.useState({sub:[],waiting:[],rejected:[],exited:[],excul:[]}),$=s=>P?e.jsxs("div",{className:"border-2 border-red-500 px-4 py-2 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-xs font-medium border-b-2",children:"Developer menu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{S.get(route("simulasi.excul",{simulasi:"acc",excul:s,nouid:n}))},className:"p-1 bg-blue-500 rounded-md text-white cursor-pointer",children:"Terima"}),e.jsx("button",{onClick:()=>{S.get(route("simulasi.excul",{simulasi:"reject",excul:s,nouid:n}))},className:"p-1 bg-red-500 rounded-md text-white cursor-pointer",children:"Tolak"})]})]}):null,m=t.useCallback(async(s=!0)=>{try{await S.get(route("siswa.index",{nouid:n,page:"index",tab:"kegiatan"}),{},{only:["data.kegiatan"],preserveState:!0,onStart:()=>s&&j(!0),onError:C,onFinish:()=>s&&j(!1)})}catch(a){c(a instanceof Error?a.message:"Terjadi kesalahan jaringan"),j(!1)}},[n,C,c]);t.useEffect(()=>{d!=null&&d.kegiatan&&(q(d.kegiatan),D("Data siswa loaded:",d))},[d==null?void 0:d.kegiatan,D]),t.useEffect(()=>{m()},[]);const{setData:h,post:p,reset:f}=H({excul:0,tgl:"",ket:""}),l=t.useMemo(()=>u.excul.map(s=>u.sub.includes(s.id)?{...s,status:"active",statusText:"Aktif"}:u.waiting.includes(s.id)?{...s,status:"waiting",statusText:"Menunggu"}:u.rejected.includes(s.id)?{...s,status:"rejected",statusText:"Ditolak"}:u.exited.includes(s.id)?{...s,status:"exited",statusText:"Keluar"}:{...s,status:"none",statusText:"Belum Terdaftar"}),[u]),k=t.useMemo(()=>l.filter(s=>s.status==="active"),[l]),w=t.useMemo(()=>l.filter(s=>s.status==="waiting"),[l]),B=t.useMemo(()=>l.filter(s=>s.status==="rejected"),[l]),G=t.useMemo(()=>l.filter(s=>s.status==="exited"),[l]),M=t.useCallback(async(s,a)=>{try{if(h("excul",s),a==="cancel"){await p(route("cancel.excul",n),{preserveScroll:!0,preserveState:!0,onStart:()=>g(s),onSuccess:()=>m(!1),onError:()=>{K.error("Permintaan Gagal"),c(o)},onFinish:()=>g(null)});return}N({open:!0,action:a,exculId:s,title:a==="subscribe"?"Form Pendaftaran":"Form Keluar Ekstrakurikuler"})}catch(y){c(`${a} failed:`,y)}},[m,n,o,c,h,p]),L=t.useCallback(async()=>{if(!(!r.action||r.exculId===null))try{const s=r.action==="subscribe"?"subs.excul":"unsubs.excul";await p(route(s,n),{preserveScroll:!0,preserveState:!0,onStart:()=>g(r.exculId),onSuccess:()=>{m(!1),f()},onError:()=>{K.error("Permintaan Gagal"),c(o)},onFinish:()=>{g(null),N(a=>({...a,open:!1}))}})}catch(s){c(`${r.action} failed:`,s)}},[r,n,p,m,f,c,o]),R=t.useCallback(()=>{N(s=>({...s,open:!1})),f()},[f]);if(A)return e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(E,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:"Memuat data"})]});const x=s=>{switch(s){case"active":return e.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-800",children:"Aktif"});case"waiting":return e.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Menunggu"});case"rejected":return e.jsx("span",{className:"rounded bg-red-100 px-2 py-1 text-xs text-red-800",children:"Ditolak"});case"exited":return e.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Anda telah Keluar"});case"registered":return e.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Terdaftar"});default:return null}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsx(J,{isOpen:r.open,onClose:R,onConfirm:L,className:"w-100 mx-5",size:"xl",title:r.title,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(I,{label:`Tanggal ${r.action==="subscribe"?"Mulai":"Berhenti"}`,name:"tgl",type:"date",onChange:s=>h("tgl",s),required:!0}),e.jsx(I,{label:`${r.action==="subscribe"?"Motivasi mendaftar":"Alasan Berhenti"}`,name:"ket",type:"textarea",onChange:s=>h("ket",s),required:!0,rows:3})]})}),e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Ekstrakurikuler"})}),Object.keys(o).length>0&&e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(Z,{className:"text-3xl text-red-600"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:o.message??"Terjadi Kesalahan"})]}),k.length>0||w.length>0?e.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[e.jsx(Q,{className:"text-green-500"}),"Ekstrakurikuler Aktif"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[k.map(s=>e.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),e.jsxs("p",{className:"text-gray-600",children:["Status: ",x(s.status)]})]}),e.jsx("button",{onClick:a=>{a.preventDefault(),M(s.id,"unsubscribe")},disabled:b===s.id,className:"text-sm font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:b===s.id?e.jsx(E,{className:"animate-spin"}):"Keluar"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),e.jsxs("span",{className:"text-gray-500",children:[s.day,", ",s.time]}),e.jsx("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800",children:"Lihat Jadwal"})]})]},s.id)),w.map(s=>e.jsxs("div",{className:"rounded-lg bg-yellow-50 border-2 border-yellow-500 p-4 transition-shadow hover:shadow-md",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),e.jsxs("p",{className:"text-gray-600",children:["Status: ",x(s.status)]})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),e.jsxs("span",{className:"text-gray-500",children:[s.day,", ",s.time]}),$(s.id)]})]},s.id))]})]}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx("p",{children:"Anda belum terdaftar dalam ekstrakurikuler apapun"}),e.jsx("a",{href:"#list_excul",className:"mt-4 font-medium text-indigo-600 hover:text-indigo-800",children:"Daftar Sekarang"})]}),e.jsxs("div",{id:"list_excul",className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[e.jsx(V,{className:"text-indigo-500"}),"Daftar Ekstrakurikuler Tersedia"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:l.map(s=>{const a=s.registered===s.quota,y=w.some(i=>i.id===s.id),T=B.some(i=>i.id===s.id),F=G.some(i=>i.id===s.id),_=k.some(i=>i.id===s.id),v=b===s.id;return e.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),T&&x("rejected"),F&&x("exited")]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(X,{className:"text-gray-400"}),s.day,", ",s.time]}),e.jsxs("p",{className:"text-gray-600",children:["Pelatih: ",s.coach]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),a?e.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Kuota Penuh"}):y?x("waiting"):e.jsx("div",{className:"flex items-center gap-4 justify-between pt-2",children:_?x("registered"):e.jsxs("button",{onClick:i=>{i.preventDefault(),M(s.id,"subscribe")},className:W("flex items-center justify-center space-x-2 rounded bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700",v&&"bg-indigo-400 hover:bg-indigo-500"),disabled:v,children:[v&&e.jsx(E,{className:"animate-spin"}),e.jsx("span",{children:T||F?"Daftar Ulang":"Daftar"})]})})]})]})]},s.id)})})]}),e.jsx("div",{className:"rounded border-l-4 border-blue-400 bg-blue-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"mt-1 flex-shrink-0 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800",children:"Informasi Penting"}),e.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-sm text-blue-700",children:[e.jsx("li",{children:"Setiap siswa boleh mengikuti maksimal 2 ekstrakurikuler"}),e.jsx("li",{children:"Pendaftaran ditutup ketika kuota terpenuhi"}),e.jsx("li",{children:"Kehadiran minimal 80% untuk mendapatkan sertifikat"}),e.jsx("li",{children:"Status pendaftaran akan diperiksa oleh admin"})]})]})]})})]})};export{ue as default};
