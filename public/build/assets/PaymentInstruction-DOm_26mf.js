import{g as ue,K as se,r as B,S as te,j as r}from"./app-IyQ2M4dK.js";import{u as oe}from"./use-toast-CFB6WNPn.js";import{A as ce}from"./AppLayout-CI14UbL-.js";import{F as le,a as de,b as ne,c as re,d as he}from"./index-Bua4SX4u.js";import"./clsx-B-dksMZM.js";var X={exports:{}},fe=X.exports,ie;function me(){return ie||(ie=1,function(q,m){(function(_,$){q.exports=$()})(fe,function(){var _=1e3,$=6e4,E=36e5,P="millisecond",Y="second",D="minute",F="hour",k="day",C="week",j="month",I="quarter",M="year",N="date",W="Invalid Date",U=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,A=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,z={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var n=["th","st","nd","rd"],e=i%100;return"["+i+(n[(e-20)%10]||n[e]||n[0])+"]"}},H=function(i,n,e){var a=String(i);return!a||a.length>=n?i:""+Array(n+1-a.length).join(e)+i},y={s:H,z:function(i){var n=-i.utcOffset(),e=Math.abs(n),a=Math.floor(e/60),t=e%60;return(n<=0?"+":"-")+H(a,2,"0")+":"+H(t,2,"0")},m:function i(n,e){if(n.date()<e.date())return-i(e,n);var a=12*(e.year()-n.year())+(e.month()-n.month()),t=n.clone().add(a,j),c=e-t<0,l=n.clone().add(a+(c?-1:1),j);return+(-(a+(e-t)/(c?t-l:l-t))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:j,y:M,w:C,d:k,D:N,h:F,m:D,s:Y,ms:P,Q:I}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},g="en",d={};d[g]=z;var u="$isDayjsObject",s=function(i){return i instanceof b||!(!i||!i[u])},f=function i(n,e,a){var t;if(!n)return g;if(typeof n=="string"){var c=n.toLowerCase();d[c]&&(t=c),e&&(d[c]=e,t=c);var l=n.split("-");if(!t&&l.length>1)return i(l[0])}else{var x=n.name;d[x]=n,t=x}return!a&&t&&(g=t),t||!a&&g},h=function(i,n){if(s(i))return i.clone();var e=typeof n=="object"?n:{};return e.date=i,e.args=arguments,new b(e)},o=y;o.l=f,o.i=s,o.w=function(i,n){return h(i,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var b=function(){function i(e){this.$L=f(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[u]=!0}var n=i.prototype;return n.parse=function(e){this.$d=function(a){var t=a.date,c=a.utc;if(t===null)return new Date(NaN);if(o.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var l=t.match(U);if(l){var x=l[2]-1||0,p=(l[7]||"0").substring(0,3);return c?new Date(Date.UTC(l[1],x,l[3]||1,l[4]||0,l[5]||0,l[6]||0,p)):new Date(l[1],x,l[3]||1,l[4]||0,l[5]||0,l[6]||0,p)}}return new Date(t)}(e),this.init()},n.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},n.$utils=function(){return o},n.isValid=function(){return this.$d.toString()!==W},n.isSame=function(e,a){var t=h(e);return this.startOf(a)<=t&&t<=this.endOf(a)},n.isAfter=function(e,a){return h(e)<this.startOf(a)},n.isBefore=function(e,a){return this.endOf(a)<h(e)},n.$g=function(e,a,t){return o.u(e)?this[a]:this.set(t,e)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(e,a){var t=this,c=!!o.u(a)||a,l=o.p(e),x=function(J,O){var L=o.w(t.$u?Date.UTC(t.$y,O,J):new Date(t.$y,O,J),t);return c?L:L.endOf(k)},p=function(J,O){return o.w(t.toDate()[J].apply(t.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(O)),t)},v=this.$W,S=this.$M,T=this.$D,Z="set"+(this.$u?"UTC":"");switch(l){case M:return c?x(1,0):x(31,11);case j:return c?x(1,S):x(0,S+1);case C:var V=this.$locale().weekStart||0,R=(v<V?v+7:v)-V;return x(c?T-R:T+(6-R),S);case k:case N:return p(Z+"Hours",0);case F:return p(Z+"Minutes",1);case D:return p(Z+"Seconds",2);case Y:return p(Z+"Milliseconds",3);default:return this.clone()}},n.endOf=function(e){return this.startOf(e,!1)},n.$set=function(e,a){var t,c=o.p(e),l="set"+(this.$u?"UTC":""),x=(t={},t[k]=l+"Date",t[N]=l+"Date",t[j]=l+"Month",t[M]=l+"FullYear",t[F]=l+"Hours",t[D]=l+"Minutes",t[Y]=l+"Seconds",t[P]=l+"Milliseconds",t)[c],p=c===k?this.$D+(a-this.$W):a;if(c===j||c===M){var v=this.clone().set(N,1);v.$d[x](p),v.init(),this.$d=v.set(N,Math.min(this.$D,v.daysInMonth())).$d}else x&&this.$d[x](p);return this.init(),this},n.set=function(e,a){return this.clone().$set(e,a)},n.get=function(e){return this[o.p(e)]()},n.add=function(e,a){var t,c=this;e=Number(e);var l=o.p(a),x=function(S){var T=h(c);return o.w(T.date(T.date()+Math.round(S*e)),c)};if(l===j)return this.set(j,this.$M+e);if(l===M)return this.set(M,this.$y+e);if(l===k)return x(1);if(l===C)return x(7);var p=(t={},t[D]=$,t[F]=E,t[Y]=_,t)[l]||1,v=this.$d.getTime()+e*p;return o.w(v,this)},n.subtract=function(e,a){return this.add(-1*e,a)},n.format=function(e){var a=this,t=this.$locale();if(!this.isValid())return t.invalidDate||W;var c=e||"YYYY-MM-DDTHH:mm:ssZ",l=o.z(this),x=this.$H,p=this.$m,v=this.$M,S=t.weekdays,T=t.months,Z=t.meridiem,V=function(O,L,G,Q){return O&&(O[L]||O(a,c))||G[L].slice(0,Q)},R=function(O){return o.s(x%12||12,O,"0")},J=Z||function(O,L,G){var Q=O<12?"AM":"PM";return G?Q.toLowerCase():Q};return c.replace(A,function(O,L){return L||function(G){switch(G){case"YY":return String(a.$y).slice(-2);case"YYYY":return o.s(a.$y,4,"0");case"M":return v+1;case"MM":return o.s(v+1,2,"0");case"MMM":return V(t.monthsShort,v,T,3);case"MMMM":return V(T,v);case"D":return a.$D;case"DD":return o.s(a.$D,2,"0");case"d":return String(a.$W);case"dd":return V(t.weekdaysMin,a.$W,S,2);case"ddd":return V(t.weekdaysShort,a.$W,S,3);case"dddd":return S[a.$W];case"H":return String(x);case"HH":return o.s(x,2,"0");case"h":return R(1);case"hh":return R(2);case"a":return J(x,p,!0);case"A":return J(x,p,!1);case"m":return String(p);case"mm":return o.s(p,2,"0");case"s":return String(a.$s);case"ss":return o.s(a.$s,2,"0");case"SSS":return o.s(a.$ms,3,"0");case"Z":return l}return null}(O)||l.replace(":","")})},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(e,a,t){var c,l=this,x=o.p(a),p=h(e),v=(p.utcOffset()-this.utcOffset())*$,S=this-p,T=function(){return o.m(l,p)};switch(x){case M:c=T()/12;break;case j:c=T();break;case I:c=T()/3;break;case C:c=(S-v)/6048e5;break;case k:c=(S-v)/864e5;break;case F:c=S/E;break;case D:c=S/$;break;case Y:c=S/_;break;default:c=S}return t?c:o.a(c)},n.daysInMonth=function(){return this.endOf(j).$D},n.$locale=function(){return d[this.$L]},n.locale=function(e,a){if(!e)return this.$L;var t=this.clone(),c=f(e,a,!0);return c&&(t.$L=c),t},n.clone=function(){return o.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},i}(),w=b.prototype;return h.prototype=w,[["$ms",P],["$s",Y],["$m",D],["$H",F],["$W",k],["$M",j],["$y",M],["$D",N]].forEach(function(i){w[i[1]]=function(n){return this.$g(n,i[0],i[1])}}),h.extend=function(i,n){return i.$i||(i(n,b,h),i.$i=!0),h},h.locale=f,h.isDayjs=s,h.unix=function(i){return h(1e3*i)},h.en=d[g],h.Ls=d,h.p={},h})}(X)),X.exports}var xe=me();const K=ue(xe);var ee={exports:{}},$e=ee.exports,ae;function pe(){return ae||(ae=1,function(q,m){(function(_,$){q.exports=$()})($e,function(){var _,$,E=1e3,P=6e4,Y=36e5,D=864e5,F=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k=31536e6,C=2628e6,j=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,I={years:k,months:C,days:D,hours:Y,minutes:P,seconds:E,milliseconds:1,weeks:6048e5},M=function(d){return d instanceof y},N=function(d,u,s){return new y(d,s,u.$l)},W=function(d){return $.p(d)+"s"},U=function(d){return d<0},A=function(d){return U(d)?Math.ceil(d):Math.floor(d)},z=function(d){return Math.abs(d)},H=function(d,u){return d?U(d)?{negative:!0,format:""+z(d)+u}:{negative:!1,format:""+d+u}:{negative:!1,format:""}},y=function(){function d(s,f,h){var o=this;if(this.$d={},this.$l=h,s===void 0&&(this.$ms=0,this.parseFromMilliseconds()),f)return N(s*I[W(f)],this);if(typeof s=="number")return this.$ms=s,this.parseFromMilliseconds(),this;if(typeof s=="object")return Object.keys(s).forEach(function(i){o.$d[W(i)]=s[i]}),this.calMilliseconds(),this;if(typeof s=="string"){var b=s.match(j);if(b){var w=b.slice(2).map(function(i){return i!=null?Number(i):0});return this.$d.years=w[0],this.$d.months=w[1],this.$d.weeks=w[2],this.$d.days=w[3],this.$d.hours=w[4],this.$d.minutes=w[5],this.$d.seconds=w[6],this.calMilliseconds(),this}}return this}var u=d.prototype;return u.calMilliseconds=function(){var s=this;this.$ms=Object.keys(this.$d).reduce(function(f,h){return f+(s.$d[h]||0)*I[h]},0)},u.parseFromMilliseconds=function(){var s=this.$ms;this.$d.years=A(s/k),s%=k,this.$d.months=A(s/C),s%=C,this.$d.days=A(s/D),s%=D,this.$d.hours=A(s/Y),s%=Y,this.$d.minutes=A(s/P),s%=P,this.$d.seconds=A(s/E),s%=E,this.$d.milliseconds=s},u.toISOString=function(){var s=H(this.$d.years,"Y"),f=H(this.$d.months,"M"),h=+this.$d.days||0;this.$d.weeks&&(h+=7*this.$d.weeks);var o=H(h,"D"),b=H(this.$d.hours,"H"),w=H(this.$d.minutes,"M"),i=this.$d.seconds||0;this.$d.milliseconds&&(i+=this.$d.milliseconds/1e3,i=Math.round(1e3*i)/1e3);var n=H(i,"S"),e=s.negative||f.negative||o.negative||b.negative||w.negative||n.negative,a=b.format||w.format||n.format?"T":"",t=(e?"-":"")+"P"+s.format+f.format+o.format+a+b.format+w.format+n.format;return t==="P"||t==="-P"?"P0D":t},u.toJSON=function(){return this.toISOString()},u.format=function(s){var f=s||"YYYY-MM-DDTHH:mm:ss",h={Y:this.$d.years,YY:$.s(this.$d.years,2,"0"),YYYY:$.s(this.$d.years,4,"0"),M:this.$d.months,MM:$.s(this.$d.months,2,"0"),D:this.$d.days,DD:$.s(this.$d.days,2,"0"),H:this.$d.hours,HH:$.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:$.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:$.s(this.$d.seconds,2,"0"),SSS:$.s(this.$d.milliseconds,3,"0")};return f.replace(F,function(o,b){return b||String(h[o])})},u.as=function(s){return this.$ms/I[W(s)]},u.get=function(s){var f=this.$ms,h=W(s);return h==="milliseconds"?f%=1e3:f=h==="weeks"?A(f/I[h]):this.$d[h],f||0},u.add=function(s,f,h){var o;return o=f?s*I[W(f)]:M(s)?s.$ms:N(s,this).$ms,N(this.$ms+o*(h?-1:1),this)},u.subtract=function(s,f){return this.add(s,f,!0)},u.locale=function(s){var f=this.clone();return f.$l=s,f},u.clone=function(){return N(this.$ms,this)},u.humanize=function(s){return _().add(this.$ms,"ms").locale(this.$l).fromNow(!s)},u.valueOf=function(){return this.asMilliseconds()},u.milliseconds=function(){return this.get("milliseconds")},u.asMilliseconds=function(){return this.as("milliseconds")},u.seconds=function(){return this.get("seconds")},u.asSeconds=function(){return this.as("seconds")},u.minutes=function(){return this.get("minutes")},u.asMinutes=function(){return this.as("minutes")},u.hours=function(){return this.get("hours")},u.asHours=function(){return this.as("hours")},u.days=function(){return this.get("days")},u.asDays=function(){return this.as("days")},u.weeks=function(){return this.get("weeks")},u.asWeeks=function(){return this.as("weeks")},u.months=function(){return this.get("months")},u.asMonths=function(){return this.as("months")},u.years=function(){return this.get("years")},u.asYears=function(){return this.as("years")},d}(),g=function(d,u,s){return d.add(u.years()*s,"y").add(u.months()*s,"M").add(u.days()*s,"d").add(u.hours()*s,"h").add(u.minutes()*s,"m").add(u.seconds()*s,"s").add(u.milliseconds()*s,"ms")};return function(d,u,s){_=s,$=s().$utils(),s.duration=function(o,b){var w=s.locale();return N(o,{$l:w},b)},s.isDuration=M;var f=u.prototype.add,h=u.prototype.subtract;u.prototype.add=function(o,b){return M(o)?g(this,o,1):f.bind(this)(o,b)},u.prototype.subtract=function(o,b){return M(o)?g(this,o,-1):h.bind(this)(o,b)}}})}(ee)),ee.exports}var ye=pe();const ge=ue(ye);K.extend(ge);const Se=({order_id:q,transaction:m})=>{const{nouid:_,errors:$}=se().props,[E,P]=B.useState(""),[Y,D]=B.useState(!1),[F,k]=B.useState(!0),[C,j]=B.useState(null),[I,M]=B.useState(null),N=K(m.expiry_time);oe(se().props),B.useEffect(()=>{if(!q||m.status==="success"){te.visit(route("siswa.index",_));return}const y=()=>{const d=K(),u=N.diff(d);if(u<=0)return P("Waktu pembayaran telah habis"),!1;{const s=K.duration(u);return P(`${s.hours()}j ${s.minutes()}m ${s.seconds()}d`),!0}};if(y()){const d=setInterval(y,1e3);return()=>clearInterval(d)}},[q,m,N,_]);const W=B.useCallback(()=>{const g={success:{bg:"bg-green-100",text:"text-green-700",icon:r.jsx(he,{}),label:"Berhasil"},pending:{bg:"bg-yellow-100",text:"text-yellow-700",icon:r.jsx(ne,{className:"animate-spin"}),label:"Menunggu Pembayaran"},failed:{bg:"bg-red-100",text:"text-red-700",icon:r.jsx(re,{}),label:"Gagal"},canceled:{bg:"bg-red-100",text:"text-red-700",icon:r.jsx(re,{}),label:"Transaksi Dibatalkan"}}[m.status];return g?r.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full ${g.bg} px-3 py-1 text-sm ${g.text}`,children:[g.icon," ",g.label]}):null},[m.status]);B.useEffect(()=>{(()=>{["success","failed","canceled"].includes(m.status)?k(!1):k(!0)})()},[m.status]);const U=async y=>{y.preventDefault();try{j(null),await te.post(route("transactions.cancel",{nouid:_,orderId:m.order_id}),{nouid:_,order_id:m.order_id})}catch(g){j("Terjadi kesalahan saat memproses pembayaran"),console.error(g)}},A=async(y,g)=>{y.preventDefault();try{D(!0),M(null),await te.post(route("payment.simulate",{nouid:_,orderId:m.order_id}),{nouid:_,order_id:m.order_id,va_number:g,amount:m.amount,type:m.type,tah:m.tah,month:m.month,spr:m.spr},{onBefore:()=>{D(!0)}})}catch(d){M("Simulasi pembayaran gagal"),console.error("Simulasi pembayaran gagal:",d)}finally{D(!1)}},z=y=>`Rp ${parseInt(y).toLocaleString("id-ID")}`,H=y=>K(y).format("DD MMM YYYY HH:mm");return r.jsx(ce,{title:"Instruksi Pembayaran",children:r.jsxs("div",{className:"mx-auto max-w-2xl overflow-hidden rounded-lg bg-white shadow-md",children:[r.jsx("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:r.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center space-x-2 transition-opacity hover:opacity-80",children:[r.jsx(le,{}),r.jsx("span",{children:"Dashboard"})]})}),r.jsxs("div",{className:"p-6",children:[r.jsx("h1",{className:"mb-3 text-center text-2xl font-bold",children:"Instruksi Pembayaran"}),r.jsx("div",{className:"mb-4 flex justify-center",children:W()}),m.status==="pending"&&r.jsxs("div",{className:"mb-6 flex flex-col gap-2 rounded-lg bg-blue-50 p-4 text-blue-800 lg:flex-row lg:items-center lg:justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(de,{}),r.jsx("span",{children:"Batas Waktu Pembayaran"})]}),r.jsxs("div",{className:"text-sm lg:text-right",children:[r.jsx("div",{className:"font-bold",children:H(m.expiry_time)}),r.jsxs("div",{className:"text-xs text-blue-700",children:["Sisa waktu: ",E]})]})]}),$.message&&r.jsx("p",{className:"text-center text-sm text-red-500",children:$.message}),$.va_number&&r.jsx("p",{className:"text-center text-sm text-red-500",children:$.va_number}),C&&r.jsx("p",{className:"mb-4 text-center text-sm text-red-500",children:C}),r.jsxs("div",{className:"mb-6 rounded-lg border border-gray-200 p-4",children:[r.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Detail Transaksi"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Order ID"}),r.jsx("span",{className:"font-medium",children:m.order_id})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Jumlah"}),r.jsx("span",{className:"font-medium",children:z(m.amount)})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Metode Pembayaran"}),r.jsx("span",{className:"font-medium",children:"Virtual Account (VA)"})]}),r.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[r.jsx("span",{className:"text-gray-600",children:"Nomor Virtual Account"}),r.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[r.jsx("span",{className:"font-medium",children:m.va_number}),m.status==="pending"&&r.jsx("button",{disabled:Y,onClick:y=>{D(!0),A(y,m.va_number)},className:`flex items-center space-x-2 rounded-lg px-4 py-2 font-bold text-white ${Y?"bg-cyan-700":"bg-cyan-900 hover:bg-cyan-800"} transition-colors disabled:opacity-70`,children:Y?r.jsxs(r.Fragment,{children:[r.jsx(ne,{className:"animate-spin"}),r.jsx("span",{children:"Memproses pembayaran"})]}):"Simulasi Pembayaran"})]}),I&&r.jsx("p",{className:"text-center text-sm text-red-500",children:I})]})]})]}),r.jsxs("div",{className:"mb-6 rounded-lg border border-gray-200 p-4",children:[r.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Instruksi Pembayaran"}),r.jsxs("ol",{className:"list-decimal space-y-3 pl-5",children:[r.jsx("li",{children:"Buka aplikasi mobile banking / internet banking Anda"}),r.jsxs("li",{children:["Masukkan nomor VA: ",r.jsx("span",{className:"font-bold",children:m.va_number})]}),r.jsx("li",{children:"Masukkan jumlah pembayaran sesuai tagihan"}),r.jsx("li",{children:"Ikuti instruksi di aplikasi hingga selesai"}),r.jsx("li",{children:"Pembayaran akan dikonfirmasi otomatis dalam 1-5 menit"})]})]}),F&&r.jsxs("div",{className:"mb-6 flex flex-col items-center justify-center space-y-2",children:[C&&r.jsx("p",{className:"text-center text-sm text-red-500",children:C}),r.jsx("button",{disabled:m.status==="canceled",onClick:U,className:`rounded-lg px-4 py-2 font-bold text-white transition-colors ${m.status==="canceled"?"cursor-not-allowed bg-red-300":"bg-red-700 hover:bg-red-800"}`,children:"Batalkan Transaksi"})]}),r.jsxs("div",{className:"rounded-lg bg-yellow-50 p-4 text-yellow-800",children:[r.jsx("h3",{className:"mb-2 font-semibold",children:"Perhatian!"}),r.jsx("p",{children:"Hanya lakukan pembayaran ke nomor VA di atas. Simpan bukti transaksi untuk referensi."})]})]})]})})};export{Se as default};
