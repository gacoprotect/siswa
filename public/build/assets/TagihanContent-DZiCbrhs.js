import{j as e,S as $,r as o}from"./app-BqSlKtqm.js";import{B as b,b as S,d as E,E as T,H as L,I as M,J as k}from"./index-whjiDzDc.js";import{X as F}from"./x-ByeUJ4eK.js";const B=({monthData:a,nouid:l,month:d})=>{const c=({tagihan:n,spr:j,tah:p})=>{$.get(route("tagihan.show",{nouid:l,bul:d}),{tah:p,spr:j,tagihan:n,nouid:l})},h=a.transactions.filter(n=>n.sta===0).reduce((n,j)=>n+j.jumlah,0),m=a.transactions.find(n=>n.jen===0);return e.jsx(e.Fragment,{children:a.transactions.some(n=>n.sta===0)&&e.jsxs("button",{onClick:()=>c({tah:(m==null?void 0:m.tah)??"",tagihan:h,spr:(m==null?void 0:m.spr)??0}),className:"flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700",children:[e.jsx(b,{className:"text-lg"}),"Bayar Sekarang"]})})},y=768;function R(){const[a,l]=o.useState();return o.useEffect(()=>{const d=window.matchMedia(`(max-width: ${y-1}px)`),c=()=>{l(window.innerWidth<y)};return d.addEventListener("change",c),l(window.innerWidth<y),()=>d.removeEventListener("change",c)},[]),!!a}const v=({title:a,value:l,icon:d,bgColor:c})=>e.jsx("div",{className:`${c} rounded-lg p-4 shadow-sm`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:a}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:l})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:d})]})}),J=({nouid:a})=>{const l=R(),[d,c]=o.useState(!0),[h,m]=o.useState({}),[n,j]=o.useState(null),[p,w]=o.useState({}),[f,C]=o.useState(null);o.useEffect(()=>{(async()=>{try{c(!0),j(null);const i=await fetch(route("tagihan.index",a));if(!i.ok)throw new Error("Gagal memuat data tagihan");const g=await i.json();if(g.status!=="success")throw new Error("Terjadi kesalahan server");m(g.data),C(g.summary);const t=Object.keys(g.data).reduce((s,N)=>(s[N]=!0,s),{});w(t)}catch(i){j(i instanceof Error?i.message:"Terjadi kesalahan jaringan")}finally{c(!1)}})()},[a]);const I=r=>{w(i=>({...i,[r]:!i[r]}))},u=r=>{switch(r){case 2:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(E,{className:"mr-1"})," Lunas"]});case 1:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[e.jsx(S,{className:"mr-1 animate-spin"})," Proses"]});default:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800",children:[e.jsx(T,{className:"mr-1"})," Belum Bayar"]})}};return d?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4",children:[e.jsx(S,{className:"animate-spin"}),e.jsx("span",{children:"Memuat data..."})]}):n?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4 text-red-600",children:[e.jsx(F,{className:"animate-pulse"}),e.jsx("span",{children:n})]}):Object.keys(h).length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Tidak ada data tagihan"}):e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Tagihan"}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white transition-colors hover:bg-green-700",children:[e.jsx(b,{className:"text-lg"}),"Buat Tagihan"]})]}),f&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(v,{title:"Total Tagihan",value:`Rp ${f.total_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(b,{className:"text-blue-500"}),bgColor:"bg-blue-50"}),e.jsx(v,{title:"Total Pembayaran",value:`Rp ${f.total_pembayaran.toLocaleString("id-ID")}`,icon:e.jsx(E,{className:"text-green-500"}),bgColor:"bg-green-50"}),e.jsx(v,{title:"Sisa Tagihan",value:`Rp ${f.sisa_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(T,{className:"text-amber-500"}),bgColor:"bg-amber-50"})]}),Object.entries(h).map(([r,i])=>{const g=Object.values(i).filter(x=>x.transactions.some(t=>t.sta===0&&t.jen===0)).length;return e.jsxs("div",{className:"rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>I(r),className:"flex w-full items-center justify-between p-4 hover:bg-gray-50",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Tahun ",r]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[g>0&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[g," Belum Bayar"]}),p[r]?e.jsx(L,{className:"text-gray-500"}):e.jsx(M,{className:"text-gray-500"})]})]}),p[r]&&e.jsx("div",{className:"border-t border-gray-200",children:Object.entries(i).map(([x,t])=>e.jsxs("div",{className:"p-4",children:[l?e.jsxs("div",{className:"mb-3 flex-col items-center justify-between",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:x}),e.jsx("div",{className:"flex items-center space-x-2",children:t.transactions.some(s=>s.sta===1)?u(1):t.transactions.every(s=>s.sta===2||s.jen===1)?u(2):u(0)})]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsxs("div",{className:`mb-3 flex items-center ${t.transactions.some(s=>s.sta===0)?"justify-between":"justify-end"} `,children:[t.transactions.some(s=>s.sta===0)&&e.jsx(B,{monthData:t,nouid:a,month:x}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]})]}):e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:x}),t.transactions.some(s=>s.sta===1)?u(1):t.transactions.every(s=>s.sta===2||s.jen===1)?u(2):u(0)]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]}),t.transactions.some(s=>s.jen===0&&(s.sta===0||s.sta===1))&&e.jsx("div",{className:`mb-3 flex items-center ${t.transactions.some(s=>s.sta===0)?"justify-between":"justify-end"} `,children:t.transactions.some(s=>s.sta===0)&&e.jsx(B,{monthData:t,nouid:a,month:x})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:t.transactions.map((s,N)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===0?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[e.jsx(b,{className:"mr-1"}),"Tagihan"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(k,{className:"mr-1"}),"Bantuan"]})}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-500",children:s.ket}),e.jsxs("td",{className:`px-4 py-3 text-sm whitespace-nowrap ${s.jen===1?"text-green-600":"text-gray-700"}`,children:[s.jen===1?"+":"","Rp"," ",Math.abs(s.jumlah).toLocaleString("id-ID")]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===1?"-":u(s.sta)})]},`${r}-${x}-${N}`))})]})})]},x))})]},r)})]})};export{J as default};
