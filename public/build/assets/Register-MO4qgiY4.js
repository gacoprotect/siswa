import{R as O,a as L,u as U,r as p,m as W,S as R,y as f,j as s}from"./app-BWpdhQRk.js";import{A as M}from"./AppLayout-BJBepDhE.js";import{I as B,P as V,D as q,A as H,K as G}from"./info-badge-ICPvm3lb.js";import{M as J}from"./Modal-N4x66npJ.js";import _ from"./Show-BITXisXy.js";import{b as z}from"./index-yPNjdcxd.js";import{c as Q}from"./utils-iJrWbPl1.js";import{C as X}from"./ConfirmDialog -BrKhREWb.js";/* empty css            */import"./InputGroup-D6VgpfYc.js";import"./iconBase-BJIFRU9w.js";import"./circle-alert-BQ02chY-.js";import"./createLucideIcon-B0KvbV85.js";import"./SelectInput-BB8xjXbL.js";import"./Combination-Dmvasl7E.js";import"./index-CgvJKWco.js";import"./index-CnUDar4a.js";import"./check-xPlMQfgH.js";import"./circle-check-big-BzOfjmMH.js";import"./x-DTYk8YmA.js";import"./index-B_2ORSCl.js";const Y=({nouid:w,agreement:c})=>{const i=L().APP_ENV==="local",{log:h,error:g}=U(),[P,b]=p.useState({isDialogOpen:!1,isAgreement:!1}),[d,v]=p.useState(!1),{data:a,setData:S,reset:y,clearErrors:A,setError:x,errors:N}=W({nama:i?"TEST MODE":"",warneg:i?"ID":"",warnegName:i?"Indonesia":"",nik:i?"1234567890123456":"",kk:i?"1234567890123456":"",paspor:i?"1234567890":"",temtin:i?"0":"",alamat1:{prov:i?"33":"",kab:i?"33.06":"",kec:i?"33.06.07":"",desa:i?"33.06.07.2017":"",kabName:i?"Purworejo":"",addr:i?"TEST MODE":"",rt:i?"001":"",rw:i?"001":"",kodpos:i?"12345":""},alamat2:{prov:i?"33":"",kab:i?"33.06":"",kec:i?"33.06.07":"",desa:i?"33.06.07.2017":"",kabName:i?"Purworejo":"",addr:i?"TEST MODE":"",rt:i?"001":"",rw:i?"001":"",kodpos:i?"12345":""},hub:i?"0":"",tel:i?"081808856626":"",email:i?"gacoprotect@gmail.com":"",ktpFile:null,pasporFile:null,ktpPreview:null,pasporPreview:null}),K=p.useRef(null),u=p.useMemo(()=>a.warneg==="ID"?"WNI":a.warneg?"WNA":null,[a.warneg]);p.useEffect(()=>()=>{a.ktpPreview&&URL.revokeObjectURL(a.ktpPreview),a.pasporPreview&&URL.revokeObjectURL(a.pasporPreview)},[a.ktpPreview,a.pasporPreview]);const T=p.useCallback((e,t)=>{e==="ktpFile"&&a.ktpPreview&&URL.revokeObjectURL(a.ktpPreview),e==="pasporFile"&&a.pasporPreview&&URL.revokeObjectURL(a.pasporPreview);const o=t?URL.createObjectURL(t):null;S(r=>({...r,[e]:t,[`${e}Preview`]:o}))},[a.ktpPreview,a.pasporPreview,S]),D=p.useCallback(async()=>{var e;try{const t={nouid:w,warneg:a.warneg,nama:a.nama,kabName:((e=a.alamat1.kabName)==null?void 0:e.replace(/^KAB\.\s*/i,"").replace(/^KOTA\s*/i,"").trim().toLowerCase().replace(/\b\w/g,o=>o.toUpperCase()))||"",...a.warneg==="ID"?{nik:a.nik}:{paspor:a.paspor}};await Promise.all([R.visit(route("register",{nouid:w,q:"agreement"}),{method:"post",data:t,only:["agreement"],preserveState:!0,preserveScroll:!0,onStart:()=>{v(!0),h("Memanggil getSignature...")},onSuccess:o=>{h("CEK RESPONSE : ",o),b(r=>({...r,isAgreement:!0}))},onError:()=>{throw f.error("Terjadi Kesalahan"),new Error("Terjadi Kesalahan")},onFinish:()=>{h("Selesai visit, modalState.isAgreement:",P.isAgreement),v(!1)}})])}catch(t){g("Signature request failed:",t),f.error("Terjadi Kesalahan")}},[a,w,h,g,P.isAgreement]),E=p.useCallback((e=null)=>{const t={},o=e!==null,r=(l,m,k)=>{(!o||m===e)&&l&&(t[m]=k)};r(!a.warneg,"warneg","Pilih Negara Anda"),r(!a.nama,"nama","Nama lengkap wajib diisi"),u==="WNI"?(r(a.nik.length>0&&a.nik.length<16,"nik","NIK harus 16 digit"),r(!a.nik,"nik","NIK wajib diisi"),r(a.kk.length>0&&a.kk.length<16,"kk","No. KK harus 16 digit"),r(!a.kk,"kk","No. KK wajib diisi"),r(!a.ktpFile,"ktpFile","Foto KTP wajib diunggah")):u==="WNA"&&(r(!a.paspor,"paspor","Nomor paspor wajib diisi"),r(!a.pasporFile,"pasporFile","Foto paspor wajib diunggah")),r(!a.temtin,"temtin","wajib dipilih"),r(a.tel.length>0&&(a.tel.length<9||a.tel.length>13),"tel","nomor telepon tidak valid"),r(!a.tel,"tel","Nomor telepon wajib diisi"),r(!a.email,"email","Email wajib diisi"),r(!a.hub,"hub","Hubungan dengan siswa wajib diisi");const n=(l,m,k=!1)=>{const j=k?"domisili":"";r(!m.prov,`${l}.prov`,`Provinsi ${j} wajib diisi`),r(!m.kab,`${l}.kab`,`Kabupaten/Kota ${j} wajib diisi`),r(!m.kec,`${l}.kec`,`Kecamatan ${j} wajib diisi`),r(!m.desa,`${l}.desa`,`Desa/Kelurahan ${j} wajib diisi`),r(!m.addr,`${l}.addr`,`Alamat ${j} wajib diisi`),r(!m.rt,`${l}.rt`,"RT wajib diisi"),r(!m.rw,`${l}.rw`,"RW wajib diisi"),r(!m.kodpos,`${l}.kodpos`,"Kode pos wajib diisi")};return(!o||e!=null&&e.startsWith("alamat1"))&&n("alamat1",a.alamat1),parseInt(a.temtin)>0&&(!o||e!=null&&e.startsWith("alamat2"))&&n("alamat2",a.alamat2,!0),t},[a,u]),C=p.useCallback(async e=>{e.preventDefault();const t=E();if(x(t),Object.keys(t).length>0){g("Validation Error : ",t);const o=Object.keys(t)[0];if(o){const r=document.getElementById(o)||document.querySelector(`[name="${o}"], [data-name="${o}"]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center"})}return}await D()},[E,D,g,x]),I=p.useCallback(async e=>{e.preventDefault();try{const t=new FormData;["nama","warneg","warnegName","nik","kk","paspor","temtin","hub","tel","email"].forEach(n=>{const l=a[n];l!=null&&t.append(n,String(l))}),a.ktpFile&&t.append("ktpFile",a.ktpFile),a.pasporFile&&t.append("pasporFile",a.pasporFile);const r=(n,l)=>{Object.entries(l).forEach(([m,k])=>{k!=null&&t.append(`${n}[${m}]`,String(k))})};r("alamat1",a.alamat1),parseInt(a.temtin)===1&&r("alamat2",a.alamat2),c.sign&&(t.append("sign",c.sign),t.append("payload",c.payload)),await Promise.all([R.post(route("auth.register",w),t,{onBefore:()=>{v(!0)},onSuccess:()=>{y(),f.success("Pendaftaran berhasil!")},onError:n=>{f.error("Terjadi kesalahan"),g("Error Submit:",n)},onFinish:()=>{b(n=>({...n,isAgreement:!1})),v(!1)}})])}catch(t){g("Error Submit:",t),f.error("Proses pendaftaran gagal")}},[a,c,w,y,g]),F=p.useMemo(()=>(e,t)=>{if(S(e,t),!t||$(e,t)){const o=E(e);x(o)}else A(e)},[E,A,S,x]),$=(e,t)=>{const r={tel:n=>n.length>0&&(n.length<9||n.length>13),email:n=>!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),nik:n=>n.length>0&&n.length<16,kk:n=>n.length>0&&n.length<16}[e];return r?r(t):!1};return p.useEffect(()=>{i&&console.count("REGISTER RENDER")},[i]),p.useEffect(()=>{h("Processing changed:",d)},[d,h]),s.jsx(M,{title:"Pendaftaran",children:s.jsxs("div",{className:"max-w-2xl min-h-screen mx-auto px-4 py-6 bg-white rounded-lg shadow-md",children:[s.jsxs("div",{className:"flex flex-col items-center justify-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-primary text-center",children:"Formulir Pendaftaran SIP"}),s.jsx("span",{className:"font-semibold text-sm text-blue-500",children:"(Student Information & Payment)"})]}),s.jsx(B,{variant:"warning",title:"Perhatian!",items:["Isi data sesuai identitas resmi (KTP/Paspor).","Unggah foto dokumen asli yang jelas dan terbaca.","Pastikan nomor WhatsApp dan email aktif untuk menerima PIN akses SIP.","Jika WNA, wajib unggah paspor dan KITAS/KITAP yang berlaku."]}),s.jsxs("form",{ref:K,onSubmit:I,className:"space-y-6",encType:"multipart/form-data",children:[s.jsx(V,{data:{warneg:a.warneg,warnegName:a.warnegName,nama:a.nama,nik:a.nik,kk:a.kk,paspor:a.paspor},step:u,errors:N,onChange:(e,t)=>F(e,t)}),u!==null&&s.jsxs(s.Fragment,{children:[s.jsx(q,{step:u,processing:d,previews:{ktpPreview:a.ktpPreview,pasporPreview:a.pasporPreview},errors:N,onChange:T}),s.jsx(H,{data:{temtin:a.temtin,alamat1:a.alamat1,alamat2:a.alamat2},onChange:(e,t)=>F(e,t),step:u,errors:N}),s.jsx(G,{data:{hub:a.hub,tel:a.tel,email:a.email},onChange:(e,t)=>F(e,t),errors:N}),s.jsx("div",{className:"pt-6",children:s.jsx("button",{type:"button",onClick:C,className:Q("w-full px-4 py-3 flex justify-center items-center text-white rounded-md transition-colors bg-primary hover:bg-primary-dark cursor-pointer font-medium",d&&"bg-primary/50 cursor-not-allowed"),disabled:d,children:d?s.jsx(z,{className:"animate-spin text-center"}):"Lanjutkan"})}),s.jsx(J,{isOpen:P.isAgreement,onClose:()=>b(e=>({...e,isAgreement:!1})),onConfirm:I,confirmText:d?"mendaftar":"Setuju",confirmDisabled:d,header:!1,onScrollToBottom:()=>"",agreement:s.jsxs("p",{children:["Saya yang bertanda tangan di bawah ini ",s.jsx("strong",{children:a.nama})," menyatakan telah membaca, memahami, dan menyetujui seluruh ketentuan di atas terkait Kartu Pelajar atas nama ",s.jsx("strong",{children:c==null?void 0:c.siswa}),"."]}),children:s.jsx(_,{childData:c,isChild:!0})})]})]}),s.jsx(X,{open:P.isDialogOpen,onOpenChange:e=>b(t=>({...t,isDialogOpen:e})),title:"Dokumen Belum Lengkap",description:u==="WNI"?"Foto KTP wajib diunggah untuk WNI. Harap lengkapi sebelum melanjutkan.":"Foto paspor wajib diunggah untuk WNA. Harap lengkapi sebelum melanjutkan.",confirmText:"Mengerti",cancelText:null,onConfirm:()=>b(e=>({...e,isDialogOpen:!1})),variant:"danger"})]})})},Pa=O.memo(Y);export{Pa as default};
