import{K as Z,u as ee,a as se,r as n,m as te,y as re,j as s,S as L}from"./app-mikNaC0C.js";import{C as ae}from"./ConfirmDialog -Pwncsttq.js";import{I as U}from"./InputGroup-CRXsE2O-.js";import{O as ne}from"./OtpStep-hI_ZSy1m.js";import{M as V}from"./Modal-C9fNPcqK.js";import{c as le}from"./utils-CG4n9IaS.js";import{b as A,O as ie,P as oe,Q as de,R as ce}from"./index-C54H24OL.js";import{C as ue}from"./circle-alert-BRRWUZgW.js";/* empty css            */import"./Combination-XQKzrb2i.js";import"./index-Cvs2htvU.js";import"./index-C18AIkic.js";import"./iconBase-Bo0gB6JU.js";import"./arrow-left-8jFdTDHU.js";import"./createLucideIcon-D1RJMfw1.js";import"./x-DhGbKiFk.js";const De=({nouid:j})=>{const{data:l,errors:h}=Z().props,{log:N,error:m}=ee(),{APP_DEBUG:_}=se(),[k,O]=n.useState(0),f=n.useRef(Array(6).fill(null)),[C,K]=n.useState(null),[a,i]=n.useState({open:!1,step:null,action:null,exculId:null,title:""}),[x,z]=n.useState({sub:[],waiting:[],rejected:[],exited:[],excul:[]}),J=e=>_?s.jsxs("div",{className:"border-2 border-red-500 px-4 py-2 rounded-lg space-y-2",children:[s.jsx("p",{className:"text-xs font-medium border-b-2",children:"Developer menu"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{L.get(route("simulasi.excul",{simulasi:"acc",excul:e,nouid:j}))},className:"p-1 bg-blue-500 rounded-md text-white cursor-pointer",children:"Terima"}),s.jsx("button",{onClick:()=>{L.get(route("simulasi.excul",{simulasi:"reject",excul:e,nouid:j}))},className:"p-1 bg-red-500 rounded-md text-white cursor-pointer",children:"Tolak"})]})]}):null;n.useEffect(()=>{l!=null&&l.kegiatan&&(z(l.kegiatan),N("Data siswa loaded:",l))},[l==null?void 0:l.kegiatan,N,l]),n.useEffect(()=>{if(k<=0)return;const e=setTimeout(()=>O(k-1),1e3);return()=>clearTimeout(e)},[k]),n.useEffect(()=>{var e;a.step==="otp"&&f.current[0]&&((e=f.current[0])==null||e.focus())},[a.step]);const o=n.useMemo(()=>x.excul.map(e=>x.sub.includes(e.id)?{...e,status:"active",statusText:"Aktif"}:x.waiting.includes(e.id)?{...e,status:"waiting",statusText:"Menunggu"}:x.rejected.includes(e.id)?{...e,status:"rejected",statusText:"Ditolak"}:x.exited.includes(e.id)?{...e,status:"exited",statusText:"Keluar"}:{...e,status:"none",statusText:"Belum Terdaftar"}),[x]),D=n.useMemo(()=>o.filter(e=>e.status==="active"),[o]),T=n.useMemo(()=>o.filter(e=>e.status==="waiting"),[o]),Q=n.useMemo(()=>o.filter(e=>e.status==="rejected"),[o]),W=n.useMemo(()=>o.filter(e=>e.status==="exited"),[o]),{data:u,setData:p,processing:M,post:w,reset:y,clearErrors:v,errors:F,setError:P}=te({otp:"",excul:0,tgl:"",ket:""}),I=n.useMemo(()=>{const e={};return Object.entries(F??{}).forEach(([t,r])=>{r&&(e[t]=Array.isArray(r)?r:[r])}),e},[F]),q=n.useCallback((e=null)=>{const t={},r=e!==null,d=(E,S,b)=>{(!r||S===e)&&E&&(t[S]=b)};return d(!u.excul,"excul","Pilih Excul Anda"),d(!u.tgl,"tgl","Tanggal wajib diisi"),d(!u.ket,"ket","Masukkan alasan Anda"),t},[u]),B=n.useCallback(async(e,t)=>{try{p("excul",e),i({open:!0,step:t==="unsubscribe"?"confirm":"form",action:t,exculId:e,title:t==="subscribe"?"Form Pendaftaran":"Form Keluar Ekstrakurikuler"})}catch(r){m(`${t} failed:`,r)}},[m,p]),R=n.useCallback(async()=>{if(!a.action||a.exculId===null)return;const e=q();if(P(e),Object.keys(e).length>0){m("Validation Error : ",e);const t=Object.keys(e)[0];if(t){const r=document.getElementById(t)||document.querySelector(`[name="${t}"], [data-name="${t}"]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center"})}return}try{const t=a.action==="subscribe"?"subs.excul":"unsubs.excul";await w(route(t,j),{preserveScroll:!0,preserveState:!0,onStart:()=>K(a.exculId),onSuccess:()=>{y()},onError:()=>{re.error("Permintaan Gagal"),m(h)},onFinish:()=>{K(null),i(r=>({...r,open:!1}))}})}catch(t){m(`${a.action} failed:`,t)}},[a,j,w,y,m,h,P,q]),$=n.useCallback(()=>{i(e=>({...e,open:!1})),y(),v()},[y,v]),Y=e=>{e.preventDefault(),w(route("otp.verif",l.nouid),{onSuccess:()=>{N("OTP SUKSES"),R(),i(t=>({...t,step:null}))},onError:()=>{N("OTP GAGAL")}})},G=()=>{w(route("otp.send",l.nouid),{onSuccess:()=>{O(60)}})},H=(e,t,r)=>{const d=u[t].split("");d[r]=e.charAt(e.length-1)||"",p(t,d.join(""))},X=(e,t)=>{var r;e.key==="Backspace"&&!u.otp[t]&&t>0&&f.current[t-1]&&((r=f.current[t-1])==null||r.focus())},g=e=>{switch(e){case"active":return s.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-800",children:"Aktif"});case"waiting":return s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Menunggu"});case"rejected":return s.jsx("span",{className:"rounded bg-red-100 px-2 py-1 text-xs text-red-800",children:"Ditolak"});case"exited":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Anda telah Keluar"});case"registered":return s.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Terdaftar"});default:return null}};return s.jsxs("div",{className:"space-y-6 p-4",children:[a.open&&a.step==="confirm"&&s.jsx(ae,{open:a.step==="confirm",onOpenChange:e=>{i(t=>({...t,open:e}))},title:"Keluar Ekstrakulikuler",description:"Apakah anda yakin ingin keluar dari kegiatan ini?",confirmText:"Ya",cancelText:"Tidak",closeOnConfirm:!1,onConfirm:()=>{i(e=>({...e,open:!0,step:"form"}))}}),a.step==="form"&&s.jsx(V,{isOpen:a.open,onClose:$,onConfirm:()=>{a.action==="unsubscribe"?(G(),i(e=>({...e,step:"otp"}))):a.action==="subscribe"&&(R(),i(e=>({...e,step:null})))},confirmText:M?s.jsx(A,{className:"animate-spin"}):"Kirim",className:"w-100 mx-5",size:"xl",title:a.title,children:s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx(U,{label:`Tanggal ${a.action==="subscribe"?"Mulai":"Berhenti"}`,name:"tgl",type:"date",onChange:e=>{p("tgl",e),v("tgl")},required:!0,errors:I}),s.jsx(U,{label:`${a.action==="subscribe"?"Motivasi mendaftar":"Alasan Berhenti"}`,name:"ket",type:"textarea",onChange:e=>{p("ket",e),v("ket")},required:!0,rows:3,errors:I})]})}),a.step==="otp"&&s.jsx(V,{isOpen:a.open,onClose:$,className:"w-100 mx-5",size:"xl",children:s.jsx(ne,{otp:u.otp,errors:h,processing:M,countdown:k,onOtpChange:(e,t)=>H(e,"otp",t),onKeyDown:X,onBack:()=>i(e=>({...e,step:"form"})),onResendOtp:G,onSubmit:Y,inputRefs:f})}),s.jsx("div",{className:"mb-6 flex items-center justify-between",children:s.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Ekstrakurikuler"})}),Object.keys(h).length>0&&s.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4 border-2 border-red-600",children:[s.jsx(ue,{className:"text-3xl text-red-600"}),s.jsx("span",{className:"text-md font-bold text-red-600",children:h.message??"Terjadi Kesalahan"})]}),D.length>0||T.length>0?s.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(ie,{className:"text-green-500"}),"Ekstrakurikuler Aktif"]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[D.map(e=>s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-md",children:[s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",g(e.status)]})]}),s.jsx("button",{onClick:t=>{p("excul",e.id),t.preventDefault(),B(e.id,"unsubscribe")},disabled:C===e.id,className:"text-sm font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:C===e.id?s.jsx(A,{className:"animate-spin"}):"Keluar"})]}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),s.jsx("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800",children:"Lihat Jadwal"})]})]},e.id)),T.map(e=>s.jsxs("div",{className:"rounded-lg bg-yellow-50 border-2 border-yellow-500 p-4 transition-shadow hover:shadow-md",children:[s.jsx("div",{className:"flex items-start justify-between",children:s.jsxs("div",{children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),s.jsxs("p",{className:"text-gray-600",children:["Status: ",g(e.status)]})]})}),s.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),s.jsxs("span",{className:"text-gray-500",children:[e.day,", ",e.time]}),J(e.id)]})]},e.id))]})]}):s.jsxs("div",{className:"py-8 text-center text-gray-500",children:[s.jsx("p",{children:"Anda belum terdaftar dalam ekstrakurikuler apapun"}),s.jsx("a",{href:"#list_excul",className:"mt-4 font-medium text-indigo-600 hover:text-indigo-800",children:"Daftar Sekarang"})]}),s.jsxs("div",{id:"list_excul",className:"rounded-lg bg-white p-6 shadow",children:[s.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[s.jsx(oe,{className:"text-indigo-500"}),"Daftar Ekstrakurikuler Tersedia"]}),s.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:o.map(e=>{const t=e.registered===e.quota,r=T.some(c=>c.id===e.id),d=Q.some(c=>c.id===e.id),E=W.some(c=>c.id===e.id),S=D.some(c=>c.id===e.id),b=C===e.id;return s.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-lg",children:[s.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[s.jsx("h5",{className:"text-lg font-bold",children:e.name}),d&&g("rejected"),E&&g("exited")]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("p",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(de,{className:"text-gray-400"}),e.day,", ",e.time]}),s.jsxs("p",{className:"text-gray-600",children:["Pelatih: ",e.coach]}),s.jsxs("div",{className:"flex items-center justify-between pt-2",children:[s.jsxs("div",{children:[s.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",e.registered,"/",e.quota]}),s.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:s.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,e.registered/e.quota*100)}%`}})})]}),t?s.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Kuota Penuh"}):r?g("waiting"):s.jsx("div",{className:"flex items-center gap-4 justify-between pt-2",children:S?g("registered"):s.jsxs("button",{onClick:c=>{c.preventDefault(),B(e.id,"subscribe")},className:le("flex items-center justify-center space-x-2 rounded bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700",b&&"bg-indigo-400 hover:bg-indigo-500"),disabled:b,children:[b&&s.jsx(A,{className:"animate-spin"}),s.jsx("span",{children:d||E?"Daftar Ulang":"Daftar"})]})})]})]})]},e.id)})})]}),s.jsx("div",{className:"rounded border-l-4 border-blue-400 bg-blue-50 p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(ce,{className:"mt-1 flex-shrink-0 text-blue-500"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-blue-800",children:"Informasi Penting"}),s.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-sm text-blue-700",children:[s.jsx("li",{children:"Setiap siswa boleh mengikuti maksimal 2 ekstrakurikuler"}),s.jsx("li",{children:"Pendaftaran ditutup ketika kuota terpenuhi"}),s.jsx("li",{children:"Kehadiran minimal 80% untuk mendapatkan sertifikat"}),s.jsx("li",{children:"Status pendaftaran akan diperiksa oleh admin"})]})]})]})})]})};export{De as default};
