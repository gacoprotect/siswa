import{j as e,r as l}from"./app-uq_RES5Q.js";import{e as _,b as I,B,C as E,q as M,D as L}from"./index-NpDSoNB-.js";import J from"./TambahTagihan-C5bLUdU3.js";import{X as O}from"./x-TFbWQK4F.js";/* empty css            */import"./Modal-B2HakZo5.js";import"./utils-CXz1v5ar.js";import"./clsx-B-dksMZM.js";const R=({setparam:x,summary:m})=>{const y=({tagihan:p,spr:N,jen1:j})=>{x({spr:N,jen1:j,tagihan:p})};return e.jsxs("button",{onClick:()=>y({tagihan:m.total_tagihan,spr:m.spr,jen1:m.jen1}),className:"flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700","aria-label":"Bayar tagihan sekarang",children:[e.jsx(_,{className:"text-sm"}),"Bayar Sekarang"]})},A=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],Q=({nouid:x,setTagihanParam:m})=>{const[y,p]=l.useState(!1),[N,j]=l.useState(!1),[b,w]=l.useState([]),[v,T]=l.useState(null),[i,k]=l.useState({total_tagihan:0,sisa_tagihan:0,total_disc:0,spr:[],jen1:[]});l.useEffect(()=>{(async()=>{try{p(!0),T(null);const s=await fetch(route("tagihan.index",x));if(!s.ok)throw new Error("Gagal memuat data tagihan");const t=await s.json();if(t.success)throw new Error("Terjadi kesalahan server");w(t.data),k(t.summary)}catch(s){T(s instanceof Error?s.message:"Terjadi kesalahan jaringan")}finally{p(!1)}})()},[x]);const u=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),C=(a,s)=>{const t=A.indexOf(s)+1,d=new Date,h=d.getFullYear(),f=d.getMonth()+1;return parseInt(a)>h||parseInt(a)===h&&t>f},S=l.useCallback(a=>{var s;(s=a==null?void 0:a.data)!=null&&s.length&&(w(t=>{const d=new Set(t.map(n=>`${n.tah}-${n.bulan.toLowerCase()}-${n.ket}`)),h=a.data.filter(n=>{const c=n.bulan.toLowerCase(),o=`${n.tah}-${c}-${n.ket}`;return!d.has(o)});return[...t,...h].sort((n,c)=>{const o=parseInt(c.tah)-parseInt(n.tah);if(o!==0)return o;const r=["januari","februari","maret","april","mei","juni","juli","agustus","september","oktober","november","desember"];return r.indexOf(n.bulan.toLowerCase())-r.indexOf(c.bulan.toLowerCase())})}),k(t=>{const d=new Set(t.spr),h=new Set(t.jen1),f=new Set(b.map(r=>`${r.tah}-${r.bulan.toLowerCase()}-${r.ket}`));let n=0;const c=[],o=[];return a.data.forEach((r,g)=>{const $=r.bulan.toLowerCase(),F=`${r.tah}-${$}-${r.ket}`;f.has(F)||(d.has(a.spr[g])||c.push(a.spr[g]),a.jen1[g]&&!h.has(a.jen1[g])&&o.push(a.jen1[g]),n+=r.jumlah)}),{...t,spr:[...t.spr,...c],jen1:[...t.jen1,...o],total_tagihan:t.total_tagihan+n,sisa_tagihan:t.total_tagihan+n-(t.total_pembayaran||0)-(t.total_disc||0)}}))},[b]),D=l.useCallback(a=>{w(s=>s.filter(t=>!(t.tah===a.tah&&t.bulan===a.bulan&&t.ket===a.ket))),k(s=>{const t=a.jumlah;return{...s,total_tagihan:s.total_tagihan-t,sisa_tagihan:s.sisa_tagihan-t}})},[]);return y?e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(I,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:"Memuat data"})]}):v?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4 text-red-600",children:[e.jsx(O,{className:"animate-pulse"}),e.jsx("span",{children:v})]}):e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"rounded-lg bg-green-50 p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Tagihan"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:u(i.total_tagihan)})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:e.jsx(_,{className:"text-green-500"})})]})}),e.jsx("div",{className:"rounded-lg bg-amber-50 p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Sisa Tagihan"}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:u(i.sisa_tagihan)})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:e.jsx(B,{className:"text-amber-500"})})]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>j(!0),className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(E,{}),"Buat Tagihan"]}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg bg-gray-600 px-4 py-2 text-white hover:bg-gray-700",children:[e.jsx(M,{}),"Riwayat"]})]}),b.length===0?e.jsx("div",{className:"rounded-lg border border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tagihan"})}):e.jsx("div",{className:"overflow-hidden rounded-lg border shadow-sm",children:e.jsxs("div",{className:"bg-white p-4",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Rincian Tagihan"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Tagihan"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-500 uppercase",children:"Keterangan"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:b.map(a=>{const s=C(a.tah,a.bulan);return e.jsxs("tr",{children:[e.jsxs("td",{className:"flex items-center gap-2 px-4 py-3 text-sm whitespace-nowrap text-gray-900",children:[s&&e.jsx("button",{onClick:()=>D(a),className:"text-red-500 hover:text-red-700",title:"Hapus Tagihan",children:e.jsx(L,{})}),a.tah," - ",a.bulan]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900",children:u(a.jumlah)}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900",children:a.ket})]},`${a.tah}-${a.bulan}-${a.ket}`)})})]})}),e.jsxs("div",{className:"mt-6 space-y-3 border-t pt-4",children:[i.total_disc?e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Diskon:"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",u(i.total_disc)]})]}):null,e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total Tagihan:"}),e.jsx("span",{className:"text-blue-600",children:u(i.total_tagihan-(i.total_disc||0))})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{setparam:m,summary:i})})]})]})}),e.jsx(J,{setTambahTagihan:S,open:N,onClose:()=>j(!1),nouid:x})]})};export{Q as default};
