import{j as e,K as S,r as l,S as v}from"./app-mikNaC0C.js";import{M as F}from"./menu-layout-Dl4Lybll.js";import{y as C,F as B,e as M,b as k}from"./index-C54H24OL.js";import{a as N}from"./utils-CG4n9IaS.js";import{B as b}from"./button-DPOCsi2C.js";import{D as E,T as O,a as D}from"./detail-payment-TR7R7RrD.js";import{M as I}from"./Modal-C9fNPcqK.js";import{S as T}from"./SelectInput-DHEGr_1v.js";import{S as z}from"./send-B734r3Ww.js";/* empty css            */import"./AppLayout-CLv256GS.js";import"./iconBase-Bo0gB6JU.js";import"./index-Cvs2htvU.js";import"./badge-BNeoF58C.js";import"./payment-method-brLNHEjk.js";import"./payment-utils-ClLdR7Ke.js";import"./wallet-BRnzROpM.js";import"./createLucideIcon-D1RJMfw1.js";import"./InputGroup-CRXsE2O-.js";import"./circle-alert-BRRWUZgW.js";import"./x-DhGbKiFk.js";import"./Combination-XQKzrb2i.js";import"./index-BDmBD7QO.js";import"./check-BsP8JYcV.js";const _=({summary:t})=>e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsx("div",{className:"rounded-lg bg-green-50 p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Tagihan"}),e.jsx("p",{className:"mt-1 text-lg font-semibold text-gray-900",children:N((t==null?void 0:t.total_tagihan)??0)})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:e.jsx(C,{className:"text-green-500"})})]})})}),J=({state:t,setState:s})=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(b,{size:"sm",onClick:()=>{s("riwayat",!1),s("tambahTagihan",!0)},className:"bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:[e.jsx(B,{}),"Buat Tagihan"]}),e.jsxs(b,{size:"sm",onClick:()=>s("riwayat",!t.riwayat),className:"bg-gray-600 px-4 py-2 text-white hover:bg-gray-700",children:[e.jsx(M,{}),"Riwayat"]})]}),P=({summary:t,state:s,setState:o})=>e.jsxs("div",{className:"space-y-4 border-b-2 pb-4",children:[e.jsx(_,{summary:t}),e.jsx(J,{state:s,setState:o})]}),R=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],A=({nouid:t,open:s,onClose:o})=>{const{errors:x}=S().props,[h,i]=l.useState({}),[d,r]=l.useState(""),[g,n]=l.useState(""),[m,c]=l.useState(!1);l.useEffect(()=>{s&&(r(""),n(""),i({}))},[s]);const p=l.useCallback(async()=>{if(!(!t||!s||m)&&!(Object.keys(h).length>0)){c(!0);try{v.visit(route("bill.index",{nouid:t}),{data:{tab:0},preserveState:!0,preserveScroll:!0,except:["ziggy","auth"],onStart:()=>{c(!0)},onSuccess:a=>{a.props.exist_bills&&i(a.props.exist_bills)},onError:a=>{console.error("Error loading data:",a)},onFinish:()=>c(!1)})}catch(a){console.error("Gagal memuat data tagihan:",a),c(!1)}}},[t,s,m,h]);l.useEffect(()=>{s&&p()},[s,p]);const j=Object.keys(h).sort((a,u)=>parseInt(u)-parseInt(a)).map(a=>({value:a,label:`Tahun ${a}`})),f=d?(h[d]||[]).sort((a,u)=>a-u).map(a=>({value:a,label:R[a-1]})):[],y=async()=>{if(!d||!g){console.error("Harap pilih tahun dan bulan terlebih dahulu.");return}if(!t){console.error("ID siswa tidak valid.");return}c(!0);try{v.visit(route("bill.index",{nouid:t}),{data:{t:Number(d),b:Number(g)},preserveState:!1,preserveScroll:!0,except:["ziggy","auth"],onSuccess:()=>{o(!1)},onError:a=>{console.error("Error adding tagihan:",a)},onFinish:()=>c(!1)})}catch(a){console.error("Gagal menambahkan tagihan:",a),c(!1)}};return e.jsx(I,{size:"md",title:"Pilih Tagihan",isOpen:s,onClose:()=>o(!1),children:e.jsx("div",{className:"max-h-[75vh] space-y-6 overflow-y-auto px-1",children:m?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-gray-500",children:[e.jsx(k,{className:"mb-2 animate-spin text-2xl"}),e.jsx("span",{children:"Memuat data tagihan..."})]}):Object.keys(h).length===0?e.jsx("p",{className:"py-4 text-center text-gray-600",children:"Tidak ada data tagihan tersedia"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 ",children:[e.jsx(T,{name:"year",label:"Tahun:",value:d,onChange:a=>{r(a),n("")},options:j,placeholder:"Pilih tahun",errors:x,required:!0}),e.jsx(T,{name:"month",label:"Bulan:",value:g,onChange:a=>n(parseInt(a)),options:f,placeholder:"Pilih bulan",errors:x,required:!0,disabled:!d})]}),x&&Object.keys(x).length>0&&e.jsx("p",{className:"pt-2 text-sm text-red-600",children:Object.values(x).flat().join(", ")}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(b,{disabled:!d||!g||m,onClick:y,children:m?"Memproses...":"Tambahkan Tagihan"})})]})})})},he=()=>{var p,j,f,y;const{auth:t,data:s,summary:o,nouid:x}=S().props,h=x??((p=t.user)==null?void 0:p.nouid)??((j=s.siswa)==null?void 0:j.nouid)??null,[i,d]=l.useState({loading:!1,bayar:!1,riwayat:!1,tambahTagihan:!1}),[r,g]=l.useState(s.tagihan);l.useEffect(()=>{g(s.tagihan)},[s.tagihan]);const n=(a,u)=>{u!==void 0&&d(w=>({...w,[a]:u}))},m=(r==null?void 0:r.filter(a=>a.jen===0).map(a=>({tagihan:`${a.tah} - ${a.bulan}`,jumlah:N(a.jumlah),ket:a.ket})))||[],c=()=>(n("loading",!1),i.bayar?n("bayar",!1):window.history.back());return e.jsx(F,{title:"Tagihan",onBack:c,children:i.bayar?e.jsx("div",{className:"space-y-2",children:e.jsx(E,{siswa:s.siswa,tableData:s.tagihan??[],existingTransaction:{exist:((f=o.exist_trx)==null?void 0:f.exist)??!1,uri:(y=o.exist_trx)==null?void 0:y.uri}})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{state:i,setState:n,summary:o}),i.riwayat?e.jsxs("div",{className:"rounded-lg border border-dashed border-gray-300 p-8 text-center",children:[e.jsx("p",{className:"text-gray-500",children:"Fitur riwayat tagihan (dummy)"}),e.jsx("ul",{className:"mt-4 space-y-2",children:r==null?void 0:r.map((a,u)=>e.jsxs("li",{className:"text-sm text-gray-700",children:[a.tah," - ",a.bulan," : ",a.ket," (",N(a.jumlah),")"]},u))})]}):(r==null?void 0:r.filter(a=>a.jen===0).length)===0?e.jsx("div",{className:"rounded-lg border border-dashed border-gray-300 p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tagihan"})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{title:"Rincian Tagihan",badge:!0,badgeRender:e.jsx(D,{data:r??[]}),dataLength:m.length,subtext:"Tagihan",th:["Tagihan","Jumlah","Keterangan"],data:m}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[o.future_bills&&e.jsx(b,{onClick:()=>v.visit(route("bill.index",h)),variant:"destructive",size:"sm",disabled:i.loading,children:"Batal"}),e.jsxs(b,{onClick:()=>{n("loading",!0),n("bayar",!0)},className:"bg-emerald-600 hover:bg-emerald-700",variant:"default",size:"sm",disabled:i.loading,children:[i.loading?e.jsx(k,{className:"animate-spin"}):e.jsx(z,{}),i.loading?"memproses":"Bayar Sekarang"]})]})]}),e.jsx(A,{nouid:h??null,open:i.tambahTagihan,onClose:()=>n("tambahTagihan",!1)})]})})};export{he as default};
