import{R as D,a as R,h as T,r as l,m as A,S as F,y as h,j as n}from"./app-BWpdhQRk.js";import{A as C}from"./AppLayout-BJBepDhE.js";import{I as $,P as L,D as U,A as M,K as W}from"./info-badge-ICPvm3lb.js";import{M as B}from"./Modal-N4x66npJ.js";import H from"./Show-BITXisXy.js";import{b as q}from"./index-yPNjdcxd.js";import{c as G}from"./utils-iJrWbPl1.js";import{C as V}from"./ConfirmDialog -BrKhREWb.js";/* empty css            */import"./InputGroup-D6VgpfYc.js";import"./iconBase-BJIFRU9w.js";import"./circle-alert-BQ02chY-.js";import"./createLucideIcon-B0KvbV85.js";import"./SelectInput-BB8xjXbL.js";import"./Combination-Dmvasl7E.js";import"./index-CgvJKWco.js";import"./index-CnUDar4a.js";import"./check-xPlMQfgH.js";import"./circle-check-big-BzOfjmMH.js";import"./x-DTYk8YmA.js";import"./index-B_2ORSCl.js";const J=({nouid:u,agreement:p})=>{const r=R().APP_ENV==="local",{log:v,error:g}=T(),[P,k]=l.useState({isDialogOpen:!1,isSignatureModalOpen:!1}),[d,f]=l.useState(!1),{data:a,setData:m,reset:S,errors:b}=A({nama:r?"TEST MODE":"",warneg:r?"ID":"",warnegName:r?"Indonesia":"",nik:r?"1234567890123456":"",kk:r?"1234567890123456":"",paspor:r?"1234567890":"",temtin:r?"0":"",alamat1:{prov:r?"33":"",kab:r?"33.06":"",kec:r?"33.06.07":"",desa:r?"33.06.07.2017":"",kabName:r?"Purworejo":"",addr:r?"TEST MODE":"",rt:r?"001":"",rw:r?"001":"",kodpos:r?"12345":""},alamat2:{prov:r?"33":"",kab:r?"33.06":"",kec:r?"33.06.07":"",desa:r?"33.06.07.2017":"",kabName:r?"Purworejo":"",addr:r?"TEST MODE":"",rt:r?"001":"",rw:r?"001":"",kodpos:r?"12345":""},hub:r?"0":"",tel:r?"081808856626":"",email:r?"gacoprotect@gmail.com":"",ktpFile:null,pasporFile:null,ktpPreview:null,pasporPreview:null}),E=l.useRef(null),c=l.useMemo(()=>a.warneg==="ID"?"WNI":a.warneg?"WNA":null,[a.warneg]);l.useEffect(()=>()=>{a.ktpPreview&&URL.revokeObjectURL(a.ktpPreview),a.pasporPreview&&URL.revokeObjectURL(a.pasporPreview)},[a.ktpPreview,a.pasporPreview]);const I=l.useCallback((e,t)=>{e==="ktpFile"&&a.ktpPreview&&URL.revokeObjectURL(a.ktpPreview),e==="pasporFile"&&a.pasporPreview&&URL.revokeObjectURL(a.pasporPreview);const s=t?URL.createObjectURL(t):null;m(i=>({...i,[e]:t,[`${e}Preview`]:s}))},[a.ktpPreview,a.pasporPreview,m]),x=l.useCallback(()=>{const e={};a.warneg||(e.warneg="Pilih Negara Anda"),a.nama||(e.nama="Nama lengkap wajib diisi"),c==="WNI"?(a.nik.length>0&&a.nik.length<16&&(e.nik="NIK harus 16 digit"),a.nik||(e.nik="NIK wajib diisi"),a.kk.length>0&&a.kk.length<16&&(e.kk="No. KK harus 16 digit"),a.kk||(e.kk="No. KK wajib diisi"),a.ktpFile||(e.ktpFile="Foto KTP wajib diunggah")):c==="WNA"&&(a.paspor||(e.paspor="Nomor paspor wajib diisi"),a.pasporFile||(e.pasporFile="Foto paspor wajib diunggah")),a.temtin||(e.temtin="wajib dipilih");const t=(s,i,o=!1)=>{i.prov||(e[`${s}.prov`]=`${o?"Provinsi domisili":"Provinsi"} wajib diisi`),i.kab||(e[`${s}.kab`]=`${o?"Kabupaten/Kota domisili":"Kabupaten/Kota"} wajib diisi`),i.kec||(e[`${s}.kec`]=`${o?"Kecamatan domisili":"Kecamatan"} wajib diisi`),i.desa||(e[`${s}.desa`]=`${o?"Desa/Kelurahan domisili":"Desa/Kelurahan"} wajib diisi`),i.addr||(e[`${s}.addr`]=`${o?"Alamat domisili":"Alamat"} wajib diisi`),i.rt||(e[`${s}.rt`]="wajib diisi"),i.rw||(e[`${s}.rw`]="wajib diisi"),i.kodpos||(e[`${s}.kodpos`]="wajib diisi")};return t("alamat1",a.alamat1),parseInt(a.temtin)>0&&t("alamat2",a.alamat2,!0),a.tel.length>0&&(a.tel.length<9||a.tel.length>13)&&(e.tel="nomor telepon tidak valid"),a.tel||(e.tel="Nomor telepon wajib diisi"),a.email||(e.email="Email wajib diisi"),a.hub||(e.hub="Hubungan dengan siswa wajib diisi"),e},[a,c]),N=l.useCallback(async(e=!1)=>{var t;try{const s={nouid:u,warneg:a.warneg,nama:a.nama,kabName:((t=a.alamat1.kabName)==null?void 0:t.replace(/^KAB\.\s*/i,"").replace(/^KOTA\s*/i,"").trim().toLowerCase().replace(/\b\w/g,i=>i.toUpperCase()))||"",...a.warneg==="ID"?{nik:a.nik}:{paspor:a.paspor}};await F.visit(route("test.register",{nouid:u,q:"agreement"}),{method:"post",data:s,only:["agreement"],preserveState:!0,preserveScroll:!0,onStart:()=>f(!0),onSuccess:i=>{v("RESPONSE : ",i),e&&k(o=>({...o,isSignatureModalOpen:!0}))},onError:()=>{throw new Error("Terjadi Kesalahan")},onFinish:()=>f(!1)})}catch(s){g("Signature request failed:",s),h.error("Gagal mendapatkan tanda tangan digital")}finally{f(!1)}},[a,u,v,g]),K=l.useCallback(async e=>{e.preventDefault();const t=x();if(Object.keys(t).length>0){Object.entries(t).forEach(([i,o])=>{m(i,o)});const s=Object.keys(t)[0];if(s){const i=document.getElementById(s)||document.querySelector(`[name="${s}"], [data-name="${s}"]`);i==null||i.scrollIntoView({behavior:"smooth",block:"center"})}return}await N(!0)},[x,N,m]),y=l.useCallback(async e=>{e.preventDefault(),f(!0);try{const t=new FormData;["nama","warneg","warnegName","nik","kk","paspor","temtin","hub","tel","email"].forEach(o=>{const w=a[o];w!=null&&t.append(o,String(w))}),a.ktpFile&&t.append("ktpFile",a.ktpFile),a.pasporFile&&t.append("pasporFile",a.pasporFile);const i=(o,w)=>{Object.entries(w).forEach(([O,j])=>{j!=null&&t.append(`${o}[${O}]`,String(j))})};i("alamat1",a.alamat1),parseInt(a.temtin)===1&&i("alamat2",a.alamat2),p.sign&&(t.append("sign",p.sign),t.append("payload",p.payload)),await F.post(route("register",u),t,{onSuccess:()=>{S(),k(o=>({...o,isSignatureModalOpen:!1})),h.success("Pendaftaran berhasil!")},onError:o=>{h.error("Terjadi kesalahan saat pendaftaran"),g("Error Submit:",o)}})}catch(t){g("Error Submit:",t),h.error("Proses pendaftaran gagal")}finally{f(!1)}},[a,p,u,S,g]);return l.useEffect(()=>{r&&console.count("REGISTER RENDER")},[r]),n.jsx(C,{title:"Pendaftaran",children:n.jsxs("div",{className:"max-w-2xl min-h-screen mx-auto px-4 py-6 bg-white rounded-lg shadow-md",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center mb-6",children:[n.jsx("h1",{className:"text-2xl font-bold text-primary text-center",children:"Formulir Pendaftaran SIP"}),n.jsx("span",{className:"font-semibold text-sm text-blue-500",children:"(Student Information & Payment)"})]}),n.jsx($,{variant:"warning",title:"Perhatian!",items:["Isi data sesuai identitas resmi (KTP/Paspor).","Unggah foto dokumen asli yang jelas dan terbaca.","Pastikan nomor WhatsApp dan email aktif untuk menerima PIN akses SIP.","Jika WNA, wajib unggah paspor dan KITAS/KITAP yang berlaku."]}),n.jsxs("form",{ref:E,onSubmit:y,className:"space-y-6",encType:"multipart/form-data",children:[n.jsx(L,{data:{warneg:a.warneg,warnegName:a.warnegName,nama:a.nama,nik:a.nik,kk:a.kk,paspor:a.paspor},step:c,setStep:e=>m("warneg",e==="WNI"?"ID":"OTHER"),errors:b,onChange:(e,t)=>m(e,t)}),c!==null&&n.jsxs(n.Fragment,{children:[n.jsx(U,{step:c,processing:d,previews:{ktpPreview:a.ktpPreview,pasporPreview:a.pasporPreview},errors:b,onChange:I}),n.jsx(M,{data:{temtin:a.temtin,alamat1:a.alamat1,alamat2:a.alamat2},onChange:(e,t)=>m(e,t),step:c,errors:b}),n.jsx(W,{data:{hub:a.hub,tel:a.tel,email:a.email},onChange:(e,t)=>m(e,t),errors:b}),n.jsx("div",{className:"pt-6",children:n.jsx("button",{type:"button",onClick:K,className:G("w-full px-4 py-3 flex justify-center items-center text-white rounded-md transition-colors bg-primary hover:bg-primary-dark cursor-pointer font-medium",d&&"bg-primary/50 cursor-not-allowed"),disabled:d,children:d?n.jsx(q,{className:"animate-spin text-center"}):"Lanjutkan"})}),n.jsx(B,{isOpen:P.isSignatureModalOpen,onClose:()=>k(e=>({...e,isSignatureModalOpen:!1})),onConfirm:y,confirmText:d?"mendaftar":"Setuju",confirmDisabled:d,header:!1,agreement:n.jsxs("p",{children:["Saya yang bertanda tangan di bawah ini ",n.jsx("strong",{children:a.nama})," menyatakan telah membaca, memahami, dan menyetujui seluruh ketentuan di atas terkait Kartu Pelajar atas nama ",n.jsx("strong",{children:p==null?void 0:p.siswa}),"."]}),children:n.jsx(H,{childData:p,isChild:!0})})]})]}),n.jsx(V,{open:P.isDialogOpen,onOpenChange:e=>k(t=>({...t,isDialogOpen:e})),title:"Dokumen Belum Lengkap",description:c==="WNI"?"Foto KTP wajib diunggah untuk WNI. Harap lengkapi sebelum melanjutkan.":"Foto paspor wajib diunggah untuk WNA. Harap lengkapi sebelum melanjutkan.",confirmText:"Mengerti",cancelText:null,onConfirm:()=>k(e=>({...e,isDialogOpen:!1})),variant:"danger"})]})})},fa=D.memo(J);export{fa as default};
