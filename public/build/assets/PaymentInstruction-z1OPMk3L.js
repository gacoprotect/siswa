import{g as R,K as T,r as $,S as E,j as s}from"./app--SEvYMZI.js";import{u as q}from"./use-toast-Bv6UriAr.js";import{A as J}from"./AppLayout-CJJcDsIg.js";import{d as D}from"./dayjs.min-BumAB3hy.js";import{F as z,a as G,b as B,c as O,d as K}from"./index-80Psauk_.js";/* empty css            */import"./index-B-aLMAM0.js";import"./clsx-B-dksMZM.js";import"./iconBase-CxjpI2wG.js";var I={exports:{}},Z=I.exports,V;function Q(){return V||(V=1,function(C,r){(function(h,u){C.exports=u()})(Z,function(){var h,u,M=1e3,w=6e4,v=36e5,p=864e5,H=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S=31536e6,b=2628e6,Y=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,g={years:S,months:b,days:p,hours:v,minutes:w,seconds:M,milliseconds:1,weeks:6048e5},k=function(n){return n instanceof l},y=function(n,t,e){return new l(n,e,t.$l)},N=function(n){return u.p(n)+"s"},P=function(n){return n<0},x=function(n){return P(n)?Math.ceil(n):Math.floor(n)},_=function(n){return Math.abs(n)},j=function(n,t){return n?P(n)?{negative:!0,format:""+_(n)+t}:{negative:!1,format:""+n+t}:{negative:!1,format:""}},l=function(){function n(e,i,o){var a=this;if(this.$d={},this.$l=o,e===void 0&&(this.$ms=0,this.parseFromMilliseconds()),i)return y(e*g[N(i)],this);if(typeof e=="number")return this.$ms=e,this.parseFromMilliseconds(),this;if(typeof e=="object")return Object.keys(e).forEach(function(f){a.$d[N(f)]=e[f]}),this.calMilliseconds(),this;if(typeof e=="string"){var d=e.match(Y);if(d){var m=d.slice(2).map(function(f){return f!=null?Number(f):0});return this.$d.years=m[0],this.$d.months=m[1],this.$d.weeks=m[2],this.$d.days=m[3],this.$d.hours=m[4],this.$d.minutes=m[5],this.$d.seconds=m[6],this.calMilliseconds(),this}}return this}var t=n.prototype;return t.calMilliseconds=function(){var e=this;this.$ms=Object.keys(this.$d).reduce(function(i,o){return i+(e.$d[o]||0)*g[o]},0)},t.parseFromMilliseconds=function(){var e=this.$ms;this.$d.years=x(e/S),e%=S,this.$d.months=x(e/b),e%=b,this.$d.days=x(e/p),e%=p,this.$d.hours=x(e/v),e%=v,this.$d.minutes=x(e/w),e%=w,this.$d.seconds=x(e/M),e%=M,this.$d.milliseconds=e},t.toISOString=function(){var e=j(this.$d.years,"Y"),i=j(this.$d.months,"M"),o=+this.$d.days||0;this.$d.weeks&&(o+=7*this.$d.weeks);var a=j(o,"D"),d=j(this.$d.hours,"H"),m=j(this.$d.minutes,"M"),f=this.$d.seconds||0;this.$d.milliseconds&&(f+=this.$d.milliseconds/1e3,f=Math.round(1e3*f)/1e3);var A=j(f,"S"),W=e.negative||i.negative||a.negative||d.negative||m.negative||A.negative,L=d.format||m.format||A.format?"T":"",F=(W?"-":"")+"P"+e.format+i.format+a.format+L+d.format+m.format+A.format;return F==="P"||F==="-P"?"P0D":F},t.toJSON=function(){return this.toISOString()},t.format=function(e){var i=e||"YYYY-MM-DDTHH:mm:ss",o={Y:this.$d.years,YY:u.s(this.$d.years,2,"0"),YYYY:u.s(this.$d.years,4,"0"),M:this.$d.months,MM:u.s(this.$d.months,2,"0"),D:this.$d.days,DD:u.s(this.$d.days,2,"0"),H:this.$d.hours,HH:u.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:u.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:u.s(this.$d.seconds,2,"0"),SSS:u.s(this.$d.milliseconds,3,"0")};return i.replace(H,function(a,d){return d||String(o[a])})},t.as=function(e){return this.$ms/g[N(e)]},t.get=function(e){var i=this.$ms,o=N(e);return o==="milliseconds"?i%=1e3:i=o==="weeks"?x(i/g[o]):this.$d[o],i||0},t.add=function(e,i,o){var a;return a=i?e*g[N(i)]:k(e)?e.$ms:y(e,this).$ms,y(this.$ms+a*(o?-1:1),this)},t.subtract=function(e,i){return this.add(e,i,!0)},t.locale=function(e){var i=this.clone();return i.$l=e,i},t.clone=function(){return y(this.$ms,this)},t.humanize=function(e){return h().add(this.$ms,"ms").locale(this.$l).fromNow(!e)},t.valueOf=function(){return this.asMilliseconds()},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},n}(),c=function(n,t,e){return n.add(t.years()*e,"y").add(t.months()*e,"M").add(t.days()*e,"d").add(t.hours()*e,"h").add(t.minutes()*e,"m").add(t.seconds()*e,"s").add(t.milliseconds()*e,"ms")};return function(n,t,e){h=e,u=e().$utils(),e.duration=function(a,d){var m=e.locale();return y(a,{$l:m},d)},e.isDuration=k;var i=t.prototype.add,o=t.prototype.subtract;t.prototype.add=function(a,d){return k(a)?c(this,a,1):i.bind(this)(a,d)},t.prototype.subtract=function(a,d){return k(a)?c(this,a,-1):o.bind(this)(a,d)}}})}(I)),I.exports}var U=Q();const X=R(U);D.extend(X);const de=({order_id:C,transaction:r})=>{const{nouid:h,errors:u}=T().props,[M,w]=$.useState(""),[v,p]=$.useState(!1),[H,S]=$.useState(!0),[b,Y]=$.useState(null),[g,k]=$.useState(null),y=D(r.expiry_time);q(T().props),$.useEffect(()=>{if(!C||r.status==="success"){E.visit(route("siswa.index",h));return}const l=()=>{const n=D(),t=y.diff(n);if(t<=0)return w("Waktu pembayaran telah habis"),!1;{const e=D.duration(t);return w(`${e.hours()}j ${e.minutes()}m ${e.seconds()}d`),!0}};if(l()){const n=setInterval(l,1e3);return()=>clearInterval(n)}},[C,r,y,h]);const N=$.useCallback(()=>{const c={success:{bg:"bg-green-100",text:"text-green-700",icon:s.jsx(K,{}),label:"Berhasil"},pending:{bg:"bg-yellow-100",text:"text-yellow-700",icon:s.jsx(B,{className:"animate-spin"}),label:"Menunggu Pembayaran"},failed:{bg:"bg-red-100",text:"text-red-700",icon:s.jsx(O,{}),label:"Gagal"},canceled:{bg:"bg-red-100",text:"text-red-700",icon:s.jsx(O,{}),label:"Transaksi Dibatalkan"}}[r.status];return c?s.jsxs("span",{className:`inline-flex items-center gap-2 rounded-full ${c.bg} px-3 py-1 text-sm ${c.text}`,children:[c.icon," ",c.label]}):null},[r.status]);$.useEffect(()=>{(()=>{["success","failed","canceled"].includes(r.status)?S(!1):S(!0)})()},[r.status]);const P=async l=>{l.preventDefault();try{Y(null),await E.post(route("transactions.cancel",{nouid:h,orderId:r.order_id}),{nouid:h,order_id:r.order_id})}catch(c){Y("Terjadi kesalahan saat memproses pembayaran"),console.error(c)}},x=async(l,c)=>{l.preventDefault();try{p(!0),k(null),await E.post(route("payment.simulate",{nouid:h,orderId:r.order_id}),{nouid:h,order_id:r.order_id,va_number:c,amount:r.amount,type:r.type,tah:r.tah,month:r.month,spr:r.spr},{onBefore:()=>{p(!0)}})}catch(n){k("Simulasi pembayaran gagal"),console.error("Simulasi pembayaran gagal:",n)}finally{p(!1)}},_=l=>`Rp ${parseInt(l).toLocaleString("id-ID")}`,j=l=>D(l).format("DD MMM YYYY HH:mm");return s.jsx(J,{title:"Instruksi Pembayaran",children:s.jsxs("div",{className:"mx-auto max-w-2xl overflow-hidden rounded-lg bg-white shadow-md",children:[s.jsx("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:s.jsxs("button",{onClick:()=>window.history.back(),className:"flex items-center space-x-2 transition-opacity hover:opacity-80",children:[s.jsx(z,{}),s.jsx("span",{children:"Dashboard"})]})}),s.jsxs("div",{className:"p-6",children:[s.jsx("h1",{className:"mb-3 text-center text-2xl font-bold",children:"Instruksi Pembayaran"}),s.jsx("div",{className:"mb-4 flex justify-center",children:N()}),r.status==="pending"&&s.jsxs("div",{className:"mb-6 flex flex-col gap-2 rounded-lg bg-blue-50 p-4 text-blue-800 lg:flex-row lg:items-center lg:justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(G,{}),s.jsx("span",{children:"Batas Waktu Pembayaran"})]}),s.jsxs("div",{className:"text-sm lg:text-right",children:[s.jsx("div",{className:"font-bold",children:j(r.expiry_time)}),s.jsxs("div",{className:"text-xs text-blue-700",children:["Sisa waktu: ",M]})]})]}),b&&s.jsx("p",{className:"mb-4 text-center text-sm text-red-500",children:b}),s.jsxs("div",{className:"mb-6 rounded-lg border border-gray-200 p-4",children:[s.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Detail Transaksi"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Order ID"}),s.jsx("span",{className:"font-medium",children:r.order_id})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Jumlah"}),s.jsx("span",{className:"font-medium",children:_(r.amount)})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Metode Pembayaran"}),s.jsx("span",{className:"font-medium",children:"Virtual Account (VA)"})]}),s.jsxs("div",{className:"flex flex-col lg:flex-row lg:justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Nomor Virtual Account"}),s.jsxs("div",{className:"flex items-center justify-between space-x-4",children:[s.jsx("span",{className:"font-medium",children:r.va_number}),r.status==="pending"&&s.jsx("button",{disabled:v,onClick:l=>{p(!0),x(l,r.va_number)},className:`flex items-center space-x-2 rounded-lg px-4 py-2 font-bold text-white ${v?"bg-cyan-700":"bg-cyan-900 hover:bg-cyan-800"} transition-colors disabled:opacity-70`,children:v?s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"animate-spin"}),s.jsx("span",{children:"Memproses pembayaran"})]}):"Simulasi Pembayaran"})]}),g&&s.jsx("p",{className:"text-center text-sm text-red-500",children:g})]})]})]}),s.jsxs("div",{className:"mb-6 rounded-lg border border-gray-200 p-4",children:[s.jsx("h2",{className:"mb-3 text-lg font-semibold",children:"Instruksi Pembayaran"}),s.jsxs("ol",{className:"list-decimal space-y-3 pl-5",children:[s.jsx("li",{children:"Buka aplikasi mobile banking / internet banking Anda"}),s.jsxs("li",{children:["Masukkan nomor VA: ",s.jsx("span",{className:"font-bold",children:r.va_number})]}),s.jsx("li",{children:"Masukkan jumlah pembayaran sesuai tagihan"}),s.jsx("li",{children:"Ikuti instruksi di aplikasi hingga selesai"}),s.jsx("li",{children:"Pembayaran akan dikonfirmasi otomatis dalam 1-5 menit"})]})]}),H&&s.jsxs("div",{className:"mb-6 flex flex-col items-center justify-center space-y-2",children:[b&&s.jsx("p",{className:"text-center text-sm text-red-500",children:b}),s.jsx("button",{disabled:r.status==="canceled",onClick:P,className:`rounded-lg px-4 py-2 font-bold text-white transition-colors ${r.status==="canceled"?"cursor-not-allowed bg-red-300":"bg-red-700 hover:bg-red-800"}`,children:"Batalkan Transaksi"})]}),s.jsxs("div",{className:"rounded-lg bg-yellow-50 p-4 text-yellow-800",children:[s.jsx("h3",{className:"mb-2 font-semibold",children:"Perhatian!"}),s.jsx("p",{children:"Hanya lakukan pembayaran ke nomor VA di atas. Simpan bukti transaksi untuk referensi."})]})]})]})})};export{de as default};
