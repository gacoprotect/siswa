import{r,j as e,K as te,a as se,u as re,m as ne,S as ie}from"./app-BY6ewAwp.js";import{c as le,B as w}from"./button-Cd7qcwtg.js";import{I as G}from"./InputGroup-C6O9Rqug.js";import{c as C,C as oe}from"./circle-alert-C3JH-0O7.js";import{C as de}from"./ConfirmDialog -BAWgDMr2.js";import{S as ce}from"./SelectInput-CzyrkpJZ.js";import{d as v}from"./dayjs.min-CowRcm1Z.js";import{u as ue}from"./use-mobile-saCNPWV2.js";import{c as P}from"./utils-CRBq6u4R.js";import{S as me}from"./index-DCwhtrBD.js";import{C as L,a as ge}from"./clock-DhQw5QxF.js";import{C as he}from"./circle-check-big-WEwYylCf.js";import{F as xe}from"./file-text-DFCVbHOG.js";/* empty css            */import"./iconBase-DIl_u5jI.js";import"./check-DX6CTfTG.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],be=C("CalendarDays",pe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ke=C("Plus",fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],je=C("Send",ye);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ne=C("Trash2",ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],we=C("Upload",Me),Q=r.forwardRef(({name:n,label:g,preview:h,showError:o=!1,errorMessage:i="",processing:d=!1,required:I=!1,handleRemoveImage:f,handleFileChange:F,className:x=""},l)=>{const N=()=>{!d&&typeof l!="function"&&(l!=null&&l.current)&&l.current.click()},p=S=>{F(S,n)},A=()=>{f(n),typeof l!="function"&&(l!=null&&l.current)&&(l.current.value="")};return e.jsxs("div",{className:`space-y-2 ${x}`,children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[g," ",I&&"*"]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[h?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:h,alt:`Preview ${g}`,className:"max-w-full h-auto max-h-64 rounded border border-gray-200"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx("button",{type:"button",className:"bg-red-500 text-white rounded-full p-2 hover:bg-red-600 transition-colors",onClick:A,disabled:d,children:e.jsx(Ne,{className:"h-5 w-5"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{onClick:N,className:`flex flex-col items-center justify-center px-4 py-8 bg-white rounded-md border-2 border-dashed ${o?"border-red-300":"border-gray-300"} cursor-pointer hover:bg-gray-50 transition-colors`,"aria-invalid":o,children:[e.jsx(we,{className:"h-12 w-12 text-gray-400"}),e.jsxs("span",{className:"mt-2 text-sm font-medium text-gray-700",children:["Upload ",g]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Format: JPG/PNG, maksimal 2MB"})]}),e.jsx("input",{ref:l,id:n,name:n,type:"file",accept:"image/jpeg, image/png, image/jpg",className:"hidden",onChange:p,disabled:d})]}),o&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-2",children:[e.jsx(oe,{className:"text-red-500 w-5 h-5"}),e.jsx("span",{children:i})]})]})]})});Q.displayName="InputFile";const Ce=le("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-auto",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ie({className:n,variant:g,asChild:h=!1,...o}){const i=h?me:"span";return e.jsx(i,{"data-slot":"badge",className:P(Ce({variant:g}),n),...o})}const X={menunggu:{label:"Menunggu",icon:ge,color:"text-yellow-500",bg:"bg-yellow-50",border:"border-yellow-100",text:"text-yellow-600"},disetujui:{label:"Disetujui",icon:he,color:"text-green-500",bg:"bg-green-50",border:"border-green-100",text:"text-green-600"},ditolak:{label:"Ditolak",icon:L,color:"text-red-500",bg:"bg-red-50",border:"border-red-100",text:"text-red-600"},dibatalkan:{label:"Dibatalkan",icon:L,color:"text-gray-500",bg:"bg-gray-50",border:"border-gray-100",text:"text-gray-600"}},Se=({status:n,className:g})=>{const o=typeof n=="number"?{0:"menunggu",1:"disetujui",[-1]:"ditolak",[-2]:"dibatalkan"}[n]||"menunggu":n,i=X[o]||X.menunggu;return e.jsxs(Ie,{variant:"outline",className:P(`flex items-center gap-1 px-3 py-1 ${i.bg} ${i.text} ${i.border}`,g),children:[e.jsx(i.icon,{className:i.color,size:16}),e.jsx("span",{className:"capitalize",children:i.label})]})},Ve=({nouid:n})=>{const{auth:g,data:h,jenis:o=[]}=te().props,i=ue(),{log:d,error:I}=se(),{APP_DEBUG:f}=re(),[F,x]=r.useState(!1),[l,N]=r.useState(!1),[p,A]=r.useState(null),[S,E]=r.useState(h.izin||[]),[k,_]=r.useState(null),[u,m]=r.useState({}),z=r.useRef(null),{data:s,setData:y,reset:D,post:U,processing:Y}=ne({jen:f?2:0,tgl_mulai:f?v().format("YYYY-MM-DD"):"",tgl_akhir:f?v().format("YYYY-MM-DD"):"",ket:f?"TEST AJA DULU YA GAES":"",dok:null}),$=r.useMemo(()=>o.map(a=>({value:a.id.toString(),label:a.title})),[o]),R=r.useCallback(()=>{const a={};let t=!0;return s.jen||(a.jen="Jenis izin harus dipilih",t=!1),s.tgl_mulai||(a.tgl_mulai="Tanggal mulai harus diisi",t=!1),s.tgl_akhir?v(s.tgl_akhir).isBefore(v(s.tgl_mulai))&&(a.tgl_akhir="Tanggal selesai tidak boleh sebelum tanggal mulai",t=!1):(a.tgl_akhir="Tanggal selesai harus diisi",t=!1),s.ket?s.ket.length<10&&(a.ket="Keterangan minimal 10 karakter",t=!1):(a.ket="Keterangan harus diisi",t=!1),!s.dok&&!k&&(a.dok="Dokumen pendukung diperlukan",t=!1,setTimeout(()=>{var c;(c=z.current)==null||c.focus()},0)),m(a),t||I("Validation errors",a),t},[s,k,I]),J=r.useCallback(a=>{var q;const t=(q=a.target.files)==null?void 0:q[0];if(!t)return;const c=["image/jpeg","image/png"],T=2*1024*1024;if(!c.includes(t.type)){m(b=>({...b,dok:"Format file harus JPG atau PNG"}));return}if(t.size>T){m(b=>({...b,dok:"Ukuran file maksimal 2MB"}));return}m(b=>({...b,dok:void 0}));const j=new FileReader;j.onload=b=>{var H;_((H=b.target)==null?void 0:H.result),y("dok",t)},j.readAsDataURL(t)},[y]),K=r.useCallback(()=>{_(null),y("dok",null),m(a=>({...a,dok:void 0})),z.current&&(z.current.value="")},[y]),M=r.useCallback((a,t)=>{y(c=>({...c,[a]:t})),u[a]&&m(c=>({...c,[a]:void 0}))},[y,u]),V=r.useCallback(async a=>{if(a.preventDefault(),!!R()){x(!0);try{await U(route("izin.store",n),{onSuccess:()=>{const t=o.find(j=>j.id===s.jen),c=(t==null?void 0:t.title)||"Unknown",T={id:Math.random().toString(36).substring(2,9),...s,dok:k||null,sta:"menunggu",created_at:new Date,title:c};E(j=>[...j,T]),D(),_(null),m({}),d("Pengajuan izin berhasil",T)},onError:t=>{m(t),d("Gagal mengajukan izin",{errors:t,data:s})},onFinish:()=>{x(!1)}})}catch(t){console.error("Submission error:",t),x(!1),d("Error sistem saat mengajukan izin",{error:t})}}},[s,k,R,n,D,d,U,o]),O=r.useCallback(a=>{A(a),N(!0)},[]),W=r.useCallback(()=>{p&&ie.post(route("izin.cancel",n),{id:p},{onSuccess:()=>{E(a=>a.map(t=>t.id===p?{...t,sta:"dibatalkan"}:t)),N(!1),d("Izin dibatalkan",{idIzin:p})}})},[p,d,n]),B=r.useCallback((a,t=!1)=>v(a).format(t?"DD MMMM YYYY HH:mm":"DD MMMM YYYY"),[]),Z=r.useMemo(()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(xe,{className:"w-10 h-10 text-gray-400 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-1",children:"Belum ada pengajuan izin"}),e.jsx("p",{className:"text-gray-400 text-center max-w-md px-4",children:'Anda belum membuat permohonan izin. Klik tombol "Ajukan Izin Baru" untuk membuat pengajuan.'})]}),[]),ee=r.useCallback(a=>e.jsxs("div",{className:"border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow bg-white space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"font-semibold text-lg text-gray-800 capitalize",children:a.title||"Izin Tidak Diketahui"})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(be,{className:"inline mr-1 w-4 h-4"}),B(a.tgl_mulai)," - ",B(a.tgl_akhir)]})]}),e.jsx(Se,{status:a.sta})]}),e.jsxs("div",{className:P("mt-4 flex justify-between gap-2 items-end",i&&"flex-col-reverse items-start"),children:[e.jsxs("span",{className:"text-xs text-start text-gray-400",children:["Diajukan pada: ",B(a.created_at,!0)]}),e.jsxs("div",{className:P("flex-1 flex w-full gap-2 justify-end",i&&"w-full"),children:[a.sta==="menunggu"&&e.jsx(w,{variant:"destructive",size:"sm",onClick:()=>O(a.id),className:"hover:bg-red-600 transition-colors",children:"Batalkan"}),e.jsx(w,{size:"sm",onClick:()=>{},children:"Detail"})]})]})]},a.id),[B,O,i]),ae=r.useMemo(()=>e.jsxs("form",{onSubmit:V,className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("h2",{className:"text-xl font-bold text-blue-800",children:"Formulir Pengajuan Izin"})}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(ce,{name:"jen",label:"Jenis Izin",value:s.jen.toString(),onChange:a=>M("jen",parseInt(a)),options:$,placeholder:"Pilih jenis izin",errors:u,required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Tanggal Mulai",type:s.jen===3?"datetime-local":"date",name:"tgl_mulai",value:s.tgl_mulai,min:v().format("YYYY-MM-DD"),onChange:a=>M("tgl_mulai",a),errors:u,required:!0}),e.jsx(G,{label:"Tanggal Selesai",type:s.jen===3?"datetime-local":"date",name:"tgl_akhir",value:s.tgl_akhir,onChange:a=>M("tgl_akhir",a),min:s.tgl_mulai,errors:u,required:!0})]}),e.jsx(G,{label:"Keterangan",type:"textarea",name:"ket",value:s.ket,onChange:a=>M("ket",a),placeholder:"Berikan penjelasan detail alasan izin...",rows:4,errors:u,required:!0}),e.jsx(Q,{ref:z,name:"dok",label:"Dokumen Pendukung",preview:k??void 0,showError:!!u.dok,errorMessage:u.dok,handleRemoveImage:K,handleFileChange:J}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Format: JPG, PNG (Maks. 2MB)"}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100",children:[e.jsx(w,{variant:"destructive",type:"button",onClick:()=>{D(),m({}),_(null),x(!1)},disabled:Y,children:"Batal"}),e.jsxs(w,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:Y,children:[e.jsx(je,{className:"mr-2 w-4 h-4"}),Y?"Mengajukan...":"Ajukan Izin"]})]})]})]}),[s,u,J,M,K,V,k,D,$,Y]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-2",children:[F?ae:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs(w,{onClick:()=>x(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ke,{className:"mr-2",size:16})," Ajukan Izin Baru"]})}),S.length===0?Z:e.jsx("div",{className:"space-y-4",children:S.map(ee)})]}),e.jsx(de,{open:l,onOpenChange:N,title:"Batalkan Izin",description:"Apakah anda yakin ingin membatalkan izin ini?",confirmText:"Ya",cancelText:"Tidak",onConfirm:W})]})};export{Ve as default};
