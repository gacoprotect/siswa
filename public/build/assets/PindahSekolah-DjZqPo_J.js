import{K as _,u as E,r as d,j as e,m as F}from"./app-CKQm0Nsx.js";import{I as k}from"./InputGroup-ZyYCV7Vw.js";import{d as y}from"./dayjs.min-C-lxxHWg.js";import{b as A}from"./index-Crl6ZrwW.js";import{u as B}from"./use-mobile-ZAdXAY5M.js";import{C as L,S as $}from"./status-badge-BFHPBO7h.js";import{B as C}from"./button-OyDdaR9A.js";import{c as I}from"./utils-Dus-J79J.js";/* empty css            */import"./iconBase-DzkbRCMi.js";import"./circle-alert-CfkC42On.js";import"./index-C0_RRpE9.js";import"./clock-9Nxx8Gp2.js";import"./circle-check-big-Hq-iImqw.js";const q=({siswa:m,onSubmit:c,isTagihanLunas:a})=>{const{errors:t}=_().props,{APP_DEBUG:n}=E(),[l,h]=d.useState({tgl:n?y().format("YYYY-MM-DD"):"",kelas:m.kel||"",tujuan:n?"TEST MODE":"",tgl_stop:n?y().format("YYYY-MM-DD"):"",ket:n?"TEST MODE TEST MODE":""}),[j,v]=d.useState(t),o=d.useCallback((s,M)=>{h(r=>({...r,[s]:M})),j[s]},[h,j]),g=s=>{s.preventDefault(),c(l)};return e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(k,{label:"Tanggal",type:"date",name:"tgl",value:l.tgl,min:y().format("YYYY-MM-DD"),onChange:s=>o("tgl",s),errors:t,required:!0}),e.jsx(k,{label:"Kelas saat ini",type:"text",name:"kelas",value:l.kelas,onChange:s=>o("kelas",s),errors:t,required:!0}),e.jsx(k,{label:"Sekolah Tujuan",type:"text",name:"tujuan",value:l.tujuan,onChange:s=>o("tujuan",s),errors:t,required:!0}),e.jsx(k,{label:"Tanggal mulai berhenti",type:"date",name:"tgl_stop",value:l.tgl_stop,min:y().format("YYYY-MM-DD"),onChange:s=>o("tgl_stop",s),errors:t,required:!0})]}),e.jsx(k,{label:"Alasan",type:"textarea",name:"ket",value:l.ket,min:y().format("YYYY-MM-DD"),onChange:s=>o("ket",s),errors:t,className:"mb-4",required:!0}),e.jsx("button",{type:"submit",className:`px-4 py-2 rounded text-white ${a?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,disabled:!a,children:"Ajukan Pindah Sekolah"}),!a&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"Anda harus melunasi semua tagihan terlebih dahulu sebelum mengajukan pindah sekolah."})]})})},O=({billData:m})=>{const c=m.tagihan<=0,a=m.transactions.reduce((t,n)=>t+n.jumlah,0);return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Tagihan"}),c?e.jsx("div",{className:"bg-green-100 text-green-800 p-3 rounded",children:e.jsx("p",{className:"font-medium",children:"Semua tagihan sudah lunas. Anda dapat melanjutkan pengajuan pindah sekolah."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-100 text-red-800 p-3 rounded mb-4",children:[e.jsxs("p",{className:"font-medium",children:["Anda memiliki tagihan yang belum lunas sebesar Rp ",a.toLocaleString()]}),e.jsx("p",{className:"text-sm mt-1",children:"Silakan lunasi terlebih dahulu untuk mengajukan pindah sekolah."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detail Tagihan:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.transactions.map((t,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:t.bulan}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:t.ket}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:["Rp ",t.jumlah.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.sta===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.sta===1?"Lunas":"Belum Lunas"})})]},n))})]})})]})]})]})},R=({siswa:m,tagihanParam:c,onClose:a})=>{var P;const{auth:t,data:n,summary:l}=_().props,h=B(),[j,v]=d.useState(!1),[o,g]=d.useState(!1),[s,M]=d.useState({nouid:n.nouid??((P=t.user)==null?void 0:P.nouid),items:n.tagihan??[],total_tagihan:(l==null?void 0:l.total_tagihan)??c.tagihan,total_diskon:l.total_disc??0,sisa_tagihan:0,orderId:""}),[r,S]=d.useState("wallet"),{data:D,post:T,processing:i,setData:f,errors:N}=F({spr:c.spr,nouid:c.nouid,payment_method:r,amount:c.tagihan,orderId:"",uri:null});d.useEffect(()=>{f("payment_method",r)},[r,f]);const u=async x=>{x.preventDefault(),!b&&await T(route("tagihan.pay",c.nouid),{preserveScroll:!0,onSuccess:()=>{g(!0),setTimeout(()=>{a==null||a()},1e4)},onError:Y=>{console.error("Payment error:",Y),g(!1)}})},p=x=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(x),w=r==="wallet"&&m.balance<s.total_tagihan,b=i||w;return e.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"border-b p-4 sm:p-6",children:[h&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("h1",{className:"text-2xl font-bold text-center",children:"Pembayaran Tagihan"})}),e.jsxs("div",{className:"mt-3grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 bg-gray-100 p-2",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-bold sm:text-base",children:["NIS: ",m.nis," - ",m.namlen.toUpperCase()]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nomor Telepon"}),e.jsx("p",{className:"text-sm sm:text-base",children:m.tel||"Tidak ada data"})]})]})]}),e.jsxs("div",{className:"border-b p-4 sm:p-6",children:[e.jsxs("div",{className:"flex mb-3 text-center items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Rincian Tagihan"}),e.jsxs("span",{className:"bg-gray-100 p-1 text-sm rounded-3xl text-gray-500",children:["ID# ",s.orderId]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Tahun"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Keterangan"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:s.items.map((x,Y)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:x.tah}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:x.bulan}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:p(x.jumlah)}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:x.ket})]},`${x.id}-${Y}`))})]})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between sm:mt-6",children:[e.jsx("span",{className:"text-base font-semibold sm:text-lg",children:"Total Tagihan:"}),e.jsx("span",{className:"text-xl font-bold text-blue-600 sm:text-2xl",children:p(s.total_tagihan)})]})]}),e.jsx("div",{className:"p-4 sm:p-6",children:j?e.jsxs("div",{className:"mx-6 mb-4 rounded-lg border-l-4 border-yellow-500 bg-yellow-100 p-4 text-yellow-700 shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Transaksi Belum Selesai"}),e.jsx("p",{className:"mt-1",children:"Anda memiliki transaksi yang belum selesai. Silakan selesaikan transaksi sebelumnya untuk melanjutkan."}),e.jsx("button",{onClick:()=>{D.uri&&(window.location.href=D.uri)},className:"mt-3 inline-block rounded bg-yellow-600 px-4 py-2 font-medium text-white transition hover:bg-yellow-700",children:"Lanjutkan ke Transaksi"})]}):o?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-md mb-3 font-semibold sm:mb-4",children:["Metode Pembayaran : ",r==="wallet"?"Saldo Tabungan":"Virtual Account"]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 p-6",children:[e.jsx("div",{className:"flex h-15 w-40 items-center justify-center border-4 border-green-700 p-4",children:e.jsx("h1",{className:"text-4xl font-bold text-green-700",children:"LUNAS"})}),e.jsx("p",{className:"text-gray-600",children:"Pembayaran berhasil diproses"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold sm:mb-4 sm:text-xl",children:"Metode Pembayaran"}),e.jsxs("form",{onSubmit:u,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-1 flex h-5 items-center",children:e.jsx("input",{id:"wallet",name:"payment_method",type:"radio",checked:r==="wallet",onChange:()=>S("wallet"),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:i})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("label",{htmlFor:"wallet",className:"block text-sm font-medium text-gray-700 sm:text-base",children:["Saldo Tabungan : ",p(m.balance)]}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:w?e.jsx("p",{className:"text-red-500",children:"Saldo tidak mencukupi"}):e.jsx("p",{children:"Cukup dan aman untuk bertransaksi"})})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-1 flex h-5 items-center",children:e.jsx("input",{id:"va",name:"payment_method",type:"radio",checked:r==="va",onChange:()=>S("va"),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:i})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("label",{htmlFor:"va",className:"block text-sm font-medium text-gray-700 sm:text-base",children:"Virtual Account"}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:"Transfer melalui bank partner"})]})]})]}),N.payment_method&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:N.payment_method}),e.jsx("div",{className:"mt-6 flex justify-end sm:mt-8",children:e.jsx("button",{type:"submit",disabled:b,className:`rounded-md px-6 py-3 text-base font-medium text-white shadow-sm transition-colors ${b?"cursor-not-allowed bg-gray-400":"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none"}`,children:i?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(A,{className:"mr-2 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})})]})]})})]})},te=({nouid:m})=>{var f,N;const{auth:c,data:a,summary:t}=_().props,n=B(),[l,h]=d.useState(null),[j,v]=d.useState(null);d.useEffect(()=>{a.pindah&&h(a.pindah)},[a.pindah]);const o={tagihan:t.total_tagihan??0,transactions:a.tagihan??[]},g=o.tagihan<=0,[s,M]=d.useState({spr:t.spr??[],tagihan:t.total_tagihan??0}),r=d.useCallback((u,p=!1)=>y(u).format(p?"DD MMMM YYYY HH:mm":"DD MMMM YYYY"),[]),S=u=>{var w,b;const p={nops:`PS-${Math.floor(Math.random()*1e4)}`,tin:0,idta:0,tgl:u.tgl,idsis:((w=a.siswa)==null?void 0:w.id)||0,oldidkel:((b=a.siswa)==null?void 0:b.idkel)||0,sek:u.tujuan,ala:u.ket,sta:"menunggu",created_at:new Date().toISOString(),tgl_stop:u.tgl_stop};v(p),h(p)},D=()=>{h(null),v(null)},T=()=>{console.log("Detail pengajuan:",l)},i=j||l;return e.jsx("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:i?e.jsxs("div",{className:"border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow bg-white space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 capitalize",children:"Pengajuan Pindah Sekolah"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(L,{className:"inline mr-1 w-4 h-4"}),r(i.tgl)]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Sekolah Tujuan:"})," ",i.sek]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Nomor Pengajuan:"})," ",i.nops||"-"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Alasan:"})," ",i.ala]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Tanggal Berhenti:"})," ",r(i.tgl_stop)]})]})]}),e.jsx($,{status:i.sta})]}),e.jsxs("div",{className:I("mt-4 flex justify-between gap-2 items-end",n&&"flex-col-reverse items-start"),children:[e.jsxs("span",{className:"text-xs text-start text-gray-400",children:["Diajukan pada: ",r(i.created_at,!0)]}),e.jsxs("div",{className:I("flex-1 flex w-full gap-2 justify-end",n&&"w-full"),children:[i.sta==="menunggu"&&e.jsx(C,{variant:"destructive",size:"sm",onClick:D,className:"hover:bg-red-600 transition-colors",children:"Batalkan"}),e.jsx(C,{size:"sm",onClick:T,children:"Detail"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-center text-blue-500 text-xl font-bold mb-6",children:"Formulir Permohonan Pindah Sekolah"}),e.jsx(O,{billData:o}),!g&&e.jsx(R,{siswa:a.siswa,tagihanParam:{...s,nouid:a.nouid},walletBalance:a.balance,onClose:()=>{}}),e.jsx(q,{siswa:a.siswa,onSubmit:S,isTagihanLunas:g,initialFormData:{kelas:((N=(f=a.siswa)==null?void 0:f.kelas)==null?void 0:N.nama)||"",tgl:new Date().toISOString().split("T")[0]},walletBalance:a.balance})]})})};export{te as default};
