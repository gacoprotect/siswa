import{j as n,r as j,K as U,m as ae,L as ie,S as V,a as oe,u as le}from"./app-CUK3jhPj.js";import{M as ce}from"./Modal-CgjoREFZ.js";import{m as ue,c as _,f as de}from"./utils-CXz1v5ar.js";import{P as pe,O as fe,a as me}from"./Pin-lLPIjHAi.js";import{c as he}from"./clsx-B-dksMZM.js";import{b as xe,e as ge,f as be,g as ye,h as je,i as ve,j as we,k as ke,l as Ne,m as Se,n as Oe,o as Pe,p as Ce,q as Ae}from"./index-N2WP3azp.js";import{u as De}from"./use-toast-D2Fss4uq.js";import{A as G}from"./AppLayout-O3CS3V0f.js";import $e from"./TagihanContent-BN20w8NX.js";import Ee from"./Topup-DmTb1aAU.js";import Fe from"./Tagihan-DK0qH0CK.js";import Ie from"./DataSiswaContent-BstWopfv.js";import Re from"./Excul-BmyFPNEU.js";import Te from"./SetupPin-CnRJnZfQ.js";import{C as re}from"./ConfirmDialog -D1pYq7wT.js";import{G as Ke}from"./iconBase-N-VmcBHL.js";import{C as Be}from"./circle-alert-DqkiMWPE.js";import{c as Me}from"./x-C0alGaor.js";import{C as Le}from"./circle-x-BK26Cfvh.js";import{C as He}from"./circle-check-big-CFalu_vP.js";/* empty css            */import"./InputGroup-3-Ai6tk7.js";import"./arrow-left-D1tF6RVz.js";import"./index-j-HmbCK0.js";import"./TambahTagihan-CSzqHrjb.js";import"./RiwayatTagihan-BwgP7_7K.js";import"./dayjs.min-PuwOuydH.js";import"./check-DjnoBOJr.js";import"./copy-BOpTjCL6.js";import"./index-DafQ3j5s.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],Ue=Me("ShieldOff",qe),Ve=({phone:s,errors:e,processing:t,registeredPhone:r,onPhoneChange:o,onSubmit:i})=>n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Masukkan Nomor HP Anda yang terdaftar"}),n.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Kami akan mengirimkan kode OTP ke nomor ini ",n.jsx("br",{}),r]})]}),e.phone&&n.jsx("div",{className:"text-center text-sm text-red-500",children:e.phone}),n.jsxs("form",{onSubmit:i,className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Nomor Handphone"}),n.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[n.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:n.jsx("span",{className:"text-gray-500 sm:text-sm",children:"+62"})}),n.jsx("input",{type:"tel",id:"phone",name:"phone",autoComplete:"tel",className:`block w-full rounded-md border-2 ${e.phone?"border-red-500":"border-gray-300"} py-2 pl-12 focus:border-blue-500 focus:ring-blue-500`,placeholder:"8123456789",value:s,onChange:a=>o(a.target.value.replace(/\D/g,"")),required:!0})]})]}),n.jsx("div",{children:n.jsx("button",{type:"submit",disabled:t||s.length<10,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${s.length>=10?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:t?"Mengirim OTP...":"Kirim Kode OTP"})})]})]}),_e=({open:s,onClose:e,setLoading:t})=>{const[r,o]=j.useState("pin"),{errors:i,data:a}=U().props,[d,c]=j.useState(0),[h,f]=j.useState("password"),{data:u,setData:p,post:l,processing:b,reset:v}=ae({phone:"",otp:"",pin:"",nouid:a.nouid??""}),m=j.useRef(Array(6).fill(null)),g=j.useRef(Array(6).fill(null));j.useEffect(()=>{if(d<=0)return;const x=setTimeout(()=>c(d-1),1e3);return()=>clearTimeout(x)},[d]),j.useEffect(()=>{const y=window.location.pathname.split("/")[1];p("nouid",y)},[p]),j.useEffect(()=>{var x,y;s&&r==="pin"&&g.current[0]&&((x=g.current[0])==null||x.focus()),s&&r==="otp"&&m.current[0]&&((y=m.current[0])==null||y.focus())},[s,r]);const w=(x,y)=>{const k=u.pin.split("");k[y]=x.charAt(x.length-1)||"",p("pin",k.join(""))},S=x=>{x.preventDefault();const y=route("otp.send",a.nouid);l(y,{onSuccess:()=>{o("otp"),c(60)}})},C=()=>{V.post(route("siswa.blocked",a.nouid),{},{onFinish:()=>{e(),setTimeout(()=>{t==null||t(!1)},5e3)}})},A=x=>{x.preventDefault(),l(route("otp.verif",a.nouid),{onSuccess:()=>{t==null||t(!0),console.log("KARTU DIBLOKIR"),C()}})},T=x=>{x.preventDefault(),/^\d{6}$/.test(u.pin)&&l(route("siswa.verify-pin",{nouid:a.nouid,p:"auth"}),{preserveState:!0,onSuccess:()=>{o("phone"),v()},onError:()=>{var y;p("pin",""),g.current[0]&&((y=g.current[0])==null||y.focus())}})},L=()=>{l(route("otp.send",a.nouid),{onSuccess:()=>{c(60)}})},F=(x,y,k)=>{const I=u[y].split("");I[k]=x.charAt(x.length-1)||"",p(y,I.join(""))},D=(x,y)=>{var k;x.key==="Backspace"&&!u.otp[y]&&y>0&&m.current[y-1]&&((k=m.current[y-1])==null||k.focus())},K=(x,y)=>{var k;x.key==="Backspace"&&!u.pin[y]&&y>0&&g.current[y-1]&&((k=g.current[y-1])==null||k.focus())},E=(x,y)=>{var I;x.preventDefault();const k=x.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(k.length>0){p(y,k);const O=Math.min(k.length-1,5),Y=g;Y.current[O]&&((I=Y.current[O])==null||I.focus())}};return n.jsx(ce,{title:"Verifikasi PIN",isOpen:s,onClose:e,children:n.jsxs("div",{className:"flex items-center justify-center",children:[n.jsx(ie,{title:r==="pin"?"Verifikasi PIN":r==="otp"?"Verifikasi OTP":"Verifikasi Nomor Telepon"}),n.jsxs("div",{className:"w-full max-w-md rounded-lg",children:[r==="pin"&&n.jsx(pe,{pin:u.pin,errors:i,inputType:h,processing:b,onPinChange:(x,y)=>w(x.target.value,y),onKeyDown:K,onPaste:x=>E(x,"pin"),onToggleInputType:()=>f(h==="password"?"text":"password"),onSubmit:T,setInputRef:(x,y)=>{g.current[y]=x},inputRefs:g}),r==="phone"&&n.jsx(Ve,{phone:u.phone,errors:i,processing:b,registeredPhone:ue(a.siswa.tel??""),onPhoneChange:x=>p("phone",x),onSubmit:S}),r==="otp"&&n.jsx(fe,{otp:u.otp,phone:u.phone,errors:i,processing:b,countdown:d,onOtpChange:(x,y)=>F(x,"otp",y),onKeyDown:D,onBack:()=>o("phone"),onResendOtp:L,onSubmit:A,inputRefs:m})]})]})})},Qe=({text:s="Loading",variant:e="full"})=>n.jsxs("div",{className:he("flex justify-center items-center flex-col z-50",e==="full"&&"h-screen bg-white",e==="overlay"&&"fixed inset-0 bg-black/50 backdrop-blur-sm"),children:[n.jsx(xe,{className:"animate-spin text-3xl text-blue-500"}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"bg-gradient-to-b from-blue-200 to-blue-600 bg-clip-text text-2xl font-bold tracking-wider text-transparent",children:s}),n.jsx("div",{className:"animate-loading-line absolute bottom-0 left-0 h-0.5 w-full bg-gradient-to-r from-blue-200 to-blue-600"})]})]});function P(){return P=Object.assign?Object.assign.bind():function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(s[r]=t[r])}return s},P.apply(null,arguments)}var ze=String.prototype.replace,Ze=/%20/g,Ge="RFC3986",H={default:Ge,formatters:{RFC1738:function(s){return ze.call(s,Ze,"+")},RFC3986:function(s){return String(s)}},RFC1738:"RFC1738"},Q=Object.prototype.hasOwnProperty,B=Array.isArray,$=function(){for(var s=[],e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s}(),J=function(s,e){for(var t=e&&e.plainObjects?Object.create(null):{},r=0;r<s.length;++r)s[r]!==void 0&&(t[r]=s[r]);return t},R={arrayToObject:J,assign:function(s,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},s)},combine:function(s,e){return[].concat(s,e)},compact:function(s){for(var e=[{obj:{o:s},prop:"o"}],t=[],r=0;r<e.length;++r)for(var o=e[r],i=o.obj[o.prop],a=Object.keys(i),d=0;d<a.length;++d){var c=a[d],h=i[c];typeof h=="object"&&h!==null&&t.indexOf(h)===-1&&(e.push({obj:i,prop:c}),t.push(h))}return function(f){for(;f.length>1;){var u=f.pop(),p=u.obj[u.prop];if(B(p)){for(var l=[],b=0;b<p.length;++b)p[b]!==void 0&&l.push(p[b]);u.obj[u.prop]=l}}}(e),s},decode:function(s,e,t){var r=s.replace(/\+/g," ");if(t==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},encode:function(s,e,t,r,o){if(s.length===0)return s;var i=s;if(typeof s=="symbol"?i=Symbol.prototype.toString.call(s):typeof s!="string"&&(i=String(s)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});for(var a="",d=0;d<i.length;++d){var c=i.charCodeAt(d);c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||o===H.RFC1738&&(c===40||c===41)?a+=i.charAt(d):c<128?a+=$[c]:c<2048?a+=$[192|c>>6]+$[128|63&c]:c<55296||c>=57344?a+=$[224|c>>12]+$[128|c>>6&63]+$[128|63&c]:(c=65536+((1023&c)<<10|1023&i.charCodeAt(d+=1)),a+=$[240|c>>18]+$[128|c>>12&63]+$[128|c>>6&63]+$[128|63&c])}return a},isBuffer:function(s){return!(!s||typeof s!="object"||!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s)))},isRegExp:function(s){return Object.prototype.toString.call(s)==="[object RegExp]"},maybeMap:function(s,e){if(B(s)){for(var t=[],r=0;r<s.length;r+=1)t.push(e(s[r]));return t}return e(s)},merge:function s(e,t,r){if(!t)return e;if(typeof t!="object"){if(B(e))e.push(t);else{if(!e||typeof e!="object")return[e,t];(r&&(r.plainObjects||r.allowPrototypes)||!Q.call(Object.prototype,t))&&(e[t]=!0)}return e}if(!e||typeof e!="object")return[e].concat(t);var o=e;return B(e)&&!B(t)&&(o=J(e,r)),B(e)&&B(t)?(t.forEach(function(i,a){if(Q.call(e,a)){var d=e[a];d&&typeof d=="object"&&i&&typeof i=="object"?e[a]=s(d,i,r):e.push(i)}else e[a]=i}),e):Object.keys(t).reduce(function(i,a){var d=t[a];return i[a]=Q.call(i,a)?s(i[a],d,r):d,i},o)}},We=Object.prototype.hasOwnProperty,X={brackets:function(s){return s+"[]"},comma:"comma",indices:function(s,e){return s+"["+e+"]"},repeat:function(s){return s}},M=Array.isArray,Ye=String.prototype.split,Je=Array.prototype.push,ne=function(s,e){Je.apply(s,M(e)?e:[e])},Xe=Date.prototype.toISOString,ee=H.default,N={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:R.encode,encodeValuesOnly:!1,format:ee,formatter:H.formatters[ee],indices:!1,serializeDate:function(s){return Xe.call(s)},skipNulls:!1,strictNullHandling:!1},et=function s(e,t,r,o,i,a,d,c,h,f,u,p,l,b){var v,m=e;if(typeof d=="function"?m=d(t,m):m instanceof Date?m=f(m):r==="comma"&&M(m)&&(m=R.maybeMap(m,function(x){return x instanceof Date?f(x):x})),m===null){if(o)return a&&!l?a(t,N.encoder,b,"key",u):t;m=""}if(typeof(v=m)=="string"||typeof v=="number"||typeof v=="boolean"||typeof v=="symbol"||typeof v=="bigint"||R.isBuffer(m)){if(a){var g=l?t:a(t,N.encoder,b,"key",u);if(r==="comma"&&l){for(var w=Ye.call(String(m),","),S="",C=0;C<w.length;++C)S+=(C===0?"":",")+p(a(w[C],N.encoder,b,"value",u));return[p(g)+"="+S]}return[p(g)+"="+p(a(m,N.encoder,b,"value",u))]}return[p(t)+"="+p(String(m))]}var A,T=[];if(m===void 0)return T;if(r==="comma"&&M(m))A=[{value:m.length>0?m.join(",")||null:void 0}];else if(M(d))A=d;else{var L=Object.keys(m);A=c?L.sort(c):L}for(var F=0;F<A.length;++F){var D=A[F],K=typeof D=="object"&&D.value!==void 0?D.value:m[D];if(!i||K!==null){var E=M(m)?typeof r=="function"?r(t,D):t:t+(h?"."+D:"["+D+"]");ne(T,s(K,E,r,o,i,a,d,c,h,f,u,p,l,b))}}return T},W=Object.prototype.hasOwnProperty,tt=Array.isArray,q={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:R.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},rt=function(s){return s.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})},se=function(s,e){return s&&typeof s=="string"&&e.comma&&s.indexOf(",")>-1?s.split(","):s},nt=function(s,e,t,r){if(s){var o=t.allowDots?s.replace(/\.([^.[]+)/g,"[$1]"):s,i=/(\[[^[\]]*])/g,a=t.depth>0&&/(\[[^[\]]*])/.exec(o),d=a?o.slice(0,a.index):o,c=[];if(d){if(!t.plainObjects&&W.call(Object.prototype,d)&&!t.allowPrototypes)return;c.push(d)}for(var h=0;t.depth>0&&(a=i.exec(o))!==null&&h<t.depth;){if(h+=1,!t.plainObjects&&W.call(Object.prototype,a[1].slice(1,-1))&&!t.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+o.slice(a.index)+"]"),function(f,u,p,l){for(var b=l?u:se(u,p),v=f.length-1;v>=0;--v){var m,g=f[v];if(g==="[]"&&p.parseArrays)m=[].concat(b);else{m=p.plainObjects?Object.create(null):{};var w=g.charAt(0)==="["&&g.charAt(g.length-1)==="]"?g.slice(1,-1):g,S=parseInt(w,10);p.parseArrays||w!==""?!isNaN(S)&&g!==w&&String(S)===w&&S>=0&&p.parseArrays&&S<=p.arrayLimit?(m=[])[S]=b:w!=="__proto__"&&(m[w]=b):m={0:b}}b=m}return b}(c,e,t,r)}},st=function(s,e){var t=function(h){return q}();if(s===""||s==null)return t.plainObjects?Object.create(null):{};for(var r=typeof s=="string"?function(h,f){var u,p={},l=(f.ignoreQueryPrefix?h.replace(/^\?/,""):h).split(f.delimiter,f.parameterLimit===1/0?void 0:f.parameterLimit),b=-1,v=f.charset;if(f.charsetSentinel)for(u=0;u<l.length;++u)l[u].indexOf("utf8=")===0&&(l[u]==="utf8=%E2%9C%93"?v="utf-8":l[u]==="utf8=%26%2310003%3B"&&(v="iso-8859-1"),b=u,u=l.length);for(u=0;u<l.length;++u)if(u!==b){var m,g,w=l[u],S=w.indexOf("]="),C=S===-1?w.indexOf("="):S+1;C===-1?(m=f.decoder(w,q.decoder,v,"key"),g=f.strictNullHandling?null:""):(m=f.decoder(w.slice(0,C),q.decoder,v,"key"),g=R.maybeMap(se(w.slice(C+1),f),function(A){return f.decoder(A,q.decoder,v,"value")})),g&&f.interpretNumericEntities&&v==="iso-8859-1"&&(g=rt(g)),w.indexOf("[]=")>-1&&(g=tt(g)?[g]:g),p[m]=W.call(p,m)?R.combine(p[m],g):g}return p}(s,t):s,o=t.plainObjects?Object.create(null):{},i=Object.keys(r),a=0;a<i.length;++a){var d=i[a],c=nt(d,r[d],t,typeof s=="string");o=R.merge(o,c,t)}return R.compact(o)};class z{constructor(e,t,r){var o,i;this.name=e,this.definition=t,this.bindings=(o=t.bindings)!=null?o:{},this.wheres=(i=t.wheres)!=null?i:{},this.config=r}get template(){const e=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return e===""?"/":e}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var e,t;return(e=(t=this.template.match(/{[^}?]+\??}/g))==null?void 0:t.map(r=>({name:r.replace(/{|\??}/g,""),required:!/\?}$/.test(r)})))!=null?e:[]}matchesUrl(e){var t;if(!this.definition.methods.includes("GET"))return!1;const r=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(d,c,h,f)=>{var u;const p=`(?<${h}>${((u=this.wheres[h])==null?void 0:u.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return f?`(${c}${p})?`:`${c}${p}`}).replace(/^\w+:\/\//,""),[o,i]=e.replace(/^\w+:\/\//,"").split("?"),a=(t=new RegExp(`^${r}/?$`).exec(o))!=null?t:new RegExp(`^${r}/?$`).exec(decodeURI(o));if(a){for(const d in a.groups)a.groups[d]=typeof a.groups[d]=="string"?decodeURIComponent(a.groups[d]):a.groups[d];return{params:a.groups,query:st(i)}}return!1}compile(e){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(t,r,o)=>{var i,a;if(!o&&[null,void 0].includes(e[r]))throw new Error(`Ziggy error: '${r}' parameter is required for route '${this.name}'.`);if(this.wheres[r]&&!new RegExp(`^${o?`(${this.wheres[r]})?`:this.wheres[r]}$`).test((a=e[r])!=null?a:""))throw new Error(`Ziggy error: '${r}' parameter '${e[r]}' does not match required format '${this.wheres[r]}' for route '${this.name}'.`);return encodeURI((i=e[r])!=null?i:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class at extends String{constructor(e,t,r=!0,o){if(super(),this.t=o??(typeof Ziggy<"u"?Ziggy:globalThis==null?void 0:globalThis.Ziggy),this.t=P({},this.t,{absolute:r}),e){if(!this.t.routes[e])throw new Error(`Ziggy error: route '${e}' is not in the route list.`);this.i=new z(e,this.t.routes[e],this.t),this.u=this.l(t)}}toString(){const e=Object.keys(this.u).filter(t=>!this.i.parameterSegments.some(({name:r})=>r===t)).filter(t=>t!=="_query").reduce((t,r)=>P({},t,{[r]:this.u[r]}),{});return this.i.compile(this.u)+function(t,r){var o,i=t,a=function(l){if(!l)return N;if(l.encoder!=null&&typeof l.encoder!="function")throw new TypeError("Encoder has to be a function.");var b=l.charset||N.charset;if(l.charset!==void 0&&l.charset!=="utf-8"&&l.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var v=H.default;if(l.format!==void 0){if(!We.call(H.formatters,l.format))throw new TypeError("Unknown format option provided.");v=l.format}var m=H.formatters[v],g=N.filter;return(typeof l.filter=="function"||M(l.filter))&&(g=l.filter),{addQueryPrefix:typeof l.addQueryPrefix=="boolean"?l.addQueryPrefix:N.addQueryPrefix,allowDots:l.allowDots===void 0?N.allowDots:!!l.allowDots,charset:b,charsetSentinel:typeof l.charsetSentinel=="boolean"?l.charsetSentinel:N.charsetSentinel,delimiter:l.delimiter===void 0?N.delimiter:l.delimiter,encode:typeof l.encode=="boolean"?l.encode:N.encode,encoder:typeof l.encoder=="function"?l.encoder:N.encoder,encodeValuesOnly:typeof l.encodeValuesOnly=="boolean"?l.encodeValuesOnly:N.encodeValuesOnly,filter:g,format:v,formatter:m,serializeDate:typeof l.serializeDate=="function"?l.serializeDate:N.serializeDate,skipNulls:typeof l.skipNulls=="boolean"?l.skipNulls:N.skipNulls,sort:typeof l.sort=="function"?l.sort:null,strictNullHandling:typeof l.strictNullHandling=="boolean"?l.strictNullHandling:N.strictNullHandling}}(r);typeof a.filter=="function"?i=(0,a.filter)("",i):M(a.filter)&&(o=a.filter);var d=[];if(typeof i!="object"||i===null)return"";var c=X[r&&r.arrayFormat in X?r.arrayFormat:r&&"indices"in r?r.indices?"indices":"repeat":"indices"];o||(o=Object.keys(i)),a.sort&&o.sort(a.sort);for(var h=0;h<o.length;++h){var f=o[h];a.skipNulls&&i[f]===null||ne(d,et(i[f],f,c,a.strictNullHandling,a.skipNulls,a.encode?a.encoder:null,a.filter,a.sort,a.allowDots,a.serializeDate,a.format,a.formatter,a.encodeValuesOnly,a.charset))}var u=d.join(a.delimiter),p=a.addQueryPrefix===!0?"?":"";return a.charsetSentinel&&(p+=a.charset==="iso-8859-1"?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),u.length>0?p+u:""}(P({},e,this.u._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(t,r)=>typeof t=="boolean"?Number(t):r(t)})}p(e){e?this.t.absolute&&e.startsWith("/")&&(e=this.h().host+e):e=this.v();let t={};const[r,o]=Object.entries(this.t.routes).find(([i,a])=>t=new z(i,a,this.t).matchesUrl(e))||[void 0,void 0];return P({name:r},t,{route:o})}v(){const{host:e,pathname:t,search:r}=this.h();return(this.t.absolute?e+t:t.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+r}current(e,t){const{name:r,params:o,query:i,route:a}=this.p();if(!e)return r;const d=new RegExp(`^${e.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(r);if([null,void 0].includes(t)||!d)return d;const c=new z(r,a,this.t);t=this.l(t,c);const h=P({},o,i);if(Object.values(t).every(u=>!u)&&!Object.values(h).some(u=>u!==void 0))return!0;const f=(u,p)=>Object.entries(u).every(([l,b])=>Array.isArray(b)&&Array.isArray(p[l])?b.every(v=>p[l].includes(v)):typeof b=="object"&&typeof p[l]=="object"&&b!==null&&p[l]!==null?f(b,p[l]):p[l]==b);return f(t,h)}h(){var e,t,r,o,i,a;const{host:d="",pathname:c="",search:h=""}=typeof window<"u"?window.location:{};return{host:(e=(t=this.t.location)==null?void 0:t.host)!=null?e:d,pathname:(r=(o=this.t.location)==null?void 0:o.pathname)!=null?r:c,search:(i=(a=this.t.location)==null?void 0:a.search)!=null?i:h}}get params(){const{params:e,query:t}=this.p();return P({},e,t)}get routeParams(){return this.p().params}get queryParams(){return this.p().query}has(e){return this.t.routes.hasOwnProperty(e)}l(e={},t=this.i){e!=null||(e={}),e=["string","number"].includes(typeof e)?[e]:e;const r=t.parameterSegments.filter(({name:o})=>!this.t.defaults[o]);return Array.isArray(e)?e=e.reduce((o,i,a)=>P({},o,r[a]?{[r[a].name]:i}:typeof i=="object"?i:{[i]:""}),{}):r.length!==1||e[r[0].name]||!e.hasOwnProperty(Object.values(t.bindings)[0])&&!e.hasOwnProperty("id")||(e={[r[0].name]:e}),P({},this.m(t),this.j(e,t))}m(e){return e.parameterSegments.filter(({name:t})=>this.t.defaults[t]).reduce((t,{name:r},o)=>P({},t,{[r]:this.t.defaults[r]}),{})}j(e,{bindings:t,parameterSegments:r}){return Object.entries(e).reduce((o,[i,a])=>{if(!a||typeof a!="object"||Array.isArray(a)||!r.some(({name:d})=>d===i))return P({},o,{[i]:a});if(!a.hasOwnProperty(t[i])){if(!a.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${i}' parameter is missing route model binding key '${t[i]}'.`);t[i]="id"}return P({},o,{[i]:a[t[i]]})},{})}valueOf(){return this.toString()}}function te(s,e,t,r){const o=new at(s,e,t,r);return s?o.toString():o}const it=({activeItem:s,menuItems:e,onBack:t})=>{if(s===null)return null;const r=e[s];return r!=null&&r.content?n.jsx(G,{title:(r==null?void 0:r.title)||"MAI",children:n.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[n.jsxs("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:[n.jsxs("button",{onClick:t,className:"flex items-center space-x-2 transition-opacity hover:opacity-80","aria-label":"Kembali",children:[n.jsx(ge,{className:"text-primary-foreground"}),n.jsx("span",{children:"Kembali"})]}),n.jsx("h1",{className:"text-2xl font-bold text-white",children:r==null?void 0:r.title})]}),r.content]})}):n.jsx("div",{children:"Konten tidak tersedia"})},ot=({auth:s,siswaData:e,onBlockRequest:t})=>{var d,c,h;const[r,o]=j.useState(!1),[i,a]=j.useState(!1);return j.useEffect(()=>{const f=u=>{r&&!u.target.closest(".menu-container")&&o(!1)};return document.addEventListener("click",f),()=>document.removeEventListener("click",f)},[r]),n.jsxs("div",{className:"relative flex w-full flex-col items-start rounded-t-lg bg-white p-4 px-6",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(be,{className:"flex-shrink-0 text-xl text-primary"}),n.jsx("h2",{className:"truncate text-3xl font-semibold text-primary",children:((d=s.user)==null?void 0:d.namlen)??e.siswa.namlen??"******"})]}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(ye,{className:"flex-shrink-0 text-lg text-primary"}),n.jsxs("p",{className:"text-primary md:text-lg",children:["NIS: ",((c=s.user)==null?void 0:c.nis)??e.siswa.nis??"*****"]})]}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(je,{className:"flex-shrink-0 text-lg text-primary"}),n.jsxs("p",{className:"text-primary md:text-lg",children:["Kelas: ",((h=s.user)==null?void 0:h.kel)??e.siswa.kel??"***"]})]}),n.jsx("div",{className:"absolute right-4 bottom-2 menu-container",children:n.jsxs("div",{className:"relative",children:[n.jsx("button",{onClick:()=>o(f=>!f),className:"p-2 focus:outline-none","aria-label":"Menu pengaturan",children:n.jsx(ve,{className:"text-xl text-blue-500"})}),r&&n.jsx("div",{className:"absolute right-0 z-10 mt-1 w-40 rounded-md border bg-white shadow-md",children:n.jsx("button",{onClick:()=>{o(!1),a(!0)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"🔒 Blokir Kartu"})})]})}),n.jsx(re,{open:i,onOpenChange:a,title:"Konfirmasi Blokir",description:"Apakah kamu yakin ingin memblokir kartu siswa ini?",confirmText:"Ya, Blokir",onConfirm:t})]})};function lt(s){return Ke({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(s)}const ct=({auth:s,data:e,hasPined:t,onPinModalOpen:r,onSetupPinModalOpen:o,onLogout:i})=>{var f,u;const[a,d]=j.useState(!1),c=()=>{V.get(route("register",e.nouid))},h=((f=e.summary)==null?void 0:f.reg)===0;return h?n.jsxs("div",{className:"flex items-center justify-center gap-4 border-t-2 border-b-2 border-blue-500 bg-white p-2 px-6",children:[n.jsx(Be,{className:"font-medium text-amber-600"}),n.jsx("span",{className:"font-medium text-amber-600",children:"Status Akun sedang dalam verifikasi"})]}):n.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-4 border-b-2 p-2 px-6",children:[s.user?n.jsxs(n.Fragment,{children:[n.jsxs("button",{onClick:()=>d(!0),className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-red-800 px-4 py-3 text-white shadow-sm transition-colors hover:bg-red-700",children:[n.jsx(lt,{className:"text-lg"}),n.jsx("span",{children:"Keluar"})]}),n.jsx(re,{open:a,onOpenChange:d,title:"Konfirmasi Logout",description:"Anda yakin ingin keluar?",confirmText:"Ya, Keluar",onConfirm:i})]}):n.jsxs("button",{onClick:r,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",disabled:h,children:[n.jsx(we,{className:"text-lg"}),n.jsx("span",{children:"Masukan PIN"})]}),n.jsxs("button",{onClick:()=>{var p;t||!t&&((p=e.summary)==null?void 0:p.reg)===1?o():c()},className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",disabled:h,children:[n.jsx(ke,{className:"text-lg"}),n.jsx("span",{children:t?"Ubah PIN":!t&&((u=e.summary)==null?void 0:u.reg)===1?"Buat Pin":"daftar"})]})]})},ut=({formattedSaldo:s,onNavigate:e})=>n.jsx("div",{className:"mb-4 w-full shadow-[0px_10px_10px_-4px_rgba(0,0,0,0.1)] shadow-black",children:n.jsxs("div",{className:"flex w-full flex-row items-center justify-between gap-4 p-4 sm:px-6",children:[n.jsxs("div",{className:"flex flex-col space-y-4",children:[n.jsx("h1",{className:"text-lg font-semibold text-primary-foreground",children:"Saldo Tabungan"}),n.jsxs("div",{className:"flex items-center gap-2 text-primary-foreground",children:[n.jsx(Ne,{className:"text-xl"}),n.jsx("span",{className:"text-xl font-bold",children:s})]})]}),n.jsxs("div",{className:"flex flex-col items-end justify-end space-y-4",children:[n.jsxs("button",{onClick:()=>e("topup"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[n.jsx(Se,{}),n.jsx("span",{children:"Topup"})]}),n.jsxs("button",{onClick:()=>e("riwayat"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[n.jsx(Oe,{}),n.jsx("span",{children:"Riwayat"})]})]})]})}),dt=({menuItems:s,onItemClick:e})=>n.jsx("div",{className:"mb-6 grid grid-cols-3 gap-4 px-4 sm:grid-cols-5",children:s.map((t,r)=>n.jsxs("button",{className:`flex flex-col items-center justify-center rounded-xl border border-t-5 p-2 transition duration-200 ${t.color}`,onClick:()=>e(r),children:[t.icon,n.jsx("span",{className:"mt-2 text-center text-sm font-semibold text-gray-800",children:t.title})]},r))}),Z=({variant:s,title:e,description:t,icon:r,className:o})=>{const i={success:n.jsx(He,{className:"h-10 w-10 text-green-500"}),error:n.jsx(Le,{className:"h-10 w-10 text-red-500"}),blocked:n.jsx(Ue,{className:"h-10 w-10 text-red-500"})},a={success:{container:"border-blue-200 bg-blue-50 hover:shadow-blue-200",text:"text-blue-600",description:"text-blue-700"},error:{container:"border-red-300 bg-red-50 hover:shadow-red-200",text:"text-red-600",description:"text-red-700"},blocked:{container:"border-red-400 bg-red-50",text:"text-red-600",description:"text-red-700"}};return n.jsx("div",{className:"m-4 flex items-center justify-center",children:n.jsx("div",{className:_("relative w-full max-w-xl rounded-2xl border shadow-md transition-all duration-300",a[s].container,o),children:n.jsxs("div",{className:"flex flex-col items-center p-6 text-center",children:[n.jsx("div",{className:"mb-4",children:r||i[s]}),n.jsx("h3",{className:_("mb-2 text-xl font-bold",a[s].text),children:e}),n.jsx("div",{className:_("space-y-1 text-sm",a[s].description),children:typeof t=="string"?n.jsx("p",{children:t}):t})]})})})},pt=({data:s})=>{var e,t,r;return((e=s.summary)==null?void 0:e.reg)===0?n.jsx(Z,{variant:"success",title:"Pendaftaran Anda berhasil",description:n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Terima kasih! Kami sedang memverifikasi data Anda."}),n.jsx("p",{children:"PIN akan dikirim ke nomor WhatsApp Anda setelah disetujui."}),n.jsx("p",{children:"Pastikan nomor WhatsApp yang Anda daftarkan aktif untuk menerima informasi lebih lanjut."})]})}):((t=s.summary)==null?void 0:t.reg)===-1?n.jsx(Z,{variant:"error",title:"Pendaftaran Anda ditolak",description:n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Mohon maaf, pendaftaran Anda belum dapat disetujui pada saat ini."}),n.jsx("p",{children:"Silakan mendaftar kembali dengan memastikan seluruh data telah lengkap dan sesuai ketentuan."}),n.jsx("p",{children:"Jika membutuhkan bantuan, silakan hubungi tim kami melalui kontak resmi yang tersedia."})]})}):((r=s.summary)==null?void 0:r.reg)===-2?n.jsx(Z,{variant:"blocked",title:"Kartu Diblokir",description:"Kartu ini telah diblokir dan tidak dapat digunakan. Silakan hubungi pihak terkait untuk informasi lebih lanjut."}):null};function Ut(){var k,I;const{auth:s,data:e}=U().props,{log:t,count:r}=oe(),{props:o}=U();le().APP_DEBUG&&j.useEffect(()=>{r("Component Render"),t(o)},[]);const[i,a]=j.useState({idok:e.idok,active:e.active,nouid:e.nouid,balance:e.balance,summary:e.summary,siswa:e.siswa}),[d,c]=j.useState(null),[h,f]=j.useState("index"),[u,p]=j.useState(!1),[l,b]=j.useState(!1),[v,m]=j.useState(!!((k=e.summary)!=null&&k.pin)),[g,w]=j.useState(null),[S,C]=j.useState({spr:[],tagihan:0});De(U().props),j.useEffect(()=>{a(O=>({...O,initialData:e}))},[e]);const A=j.useMemo(()=>[{title:"Tagihan",icon:n.jsx(Pe,{className:"h-6 w-6 text-green-600"}),color:"border-green-700 bg-green-50 hover:bg-green-100",content:n.jsx($e,{nouid:i.nouid,setTagihanParam:O=>{C(O),f("tagihan")},onClose:()=>c(null)})},{title:"Data Siswa",icon:n.jsx(Ce,{className:"h-6 w-6 text-amber-600"}),color:"border-amber-700 bg-amber-50 hover:bg-amber-100",content:n.jsx(Ie,{nouid:i.nouid,siswa:i.siswa})},{title:"Kegiatan",icon:n.jsx(Ae,{className:"h-6 w-6 text-rose-600"}),color:"border-rose-700 bg-rose-50 hover:bg-rose-100",content:n.jsx(Re,{nouid:i.nouid})}],[i]),T=j.useMemo(()=>de((i==null?void 0:i.balance)||0),[i==null?void 0:i.balance]),L=j.useCallback(O=>{O==="riwayat"?(b(!0),w("pin")):f(O)},[]),F=j.useCallback(()=>{p(!0),V.visit(te("siswa.index",i.nouid),{only:["data"],preserveState:!0,onSuccess:()=>p(!1),onError:()=>p(!1)}),console.count("Refresh Data")},[i.nouid]),D=j.useCallback(()=>{u||w("pin")},[u]),K=j.useCallback(()=>{u||w("setupPin")},[u]),E=j.useCallback((O=!1)=>{w(null),O||(b(!1),f("index"))},[]),x=j.useCallback(()=>{V.post(te("siswa.logout",i.nouid),{},{onStart:()=>p(!0),onFinish:()=>p(!1)})},[i.nouid]),y=j.useCallback(()=>{w("blokir")},[]);if(!i.active)return n.jsx(G,{title:"Kartu Siswa",children:n.jsx("div",{className:"flex min-h-screen items-center bg-white",children:n.jsxs("div",{className:"mx-2 flex w-full flex-col items-center justify-center rounded-lg border-2 border-red-400 bg-red-50 p-6 text-center shadow-sm",children:[n.jsx("h3",{className:"mb-2 text-lg font-semibold text-red-600",children:"🔒 Kartu Diblokir"}),n.jsx("p",{className:"mb-4 text-sm text-red-700",children:"Kartu ini telah diblokir dan tidak dapat digunakan. Silakan aktifkan kembali untuk melanjutkan."}),n.jsx("button",{onClick:K,className:"inline-flex items-center gap-2 rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white transition hover:bg-red-700",children:"🔓 Aktifkan Kembali"})]})})});if(d!==null)return n.jsx(it,{activeItem:d,menuItems:A,onBack:()=>c(null)});switch(h){case"topup":return n.jsx(Ee,{siswa:i.siswa,nouid:i.nouid,onClose:()=>{f("index"),E(),F()}});case"tagihan":return n.jsx(Fe,{siswa:i.siswa,tagihanParam:{...S,nouid:i.nouid},onClose:()=>{f("index"),E(),F()}});default:return n.jsxs(n.Fragment,{children:[u&&n.jsx(Qe,{text:"Memuat Data",variant:"overlay"}),n.jsxs(G,{title:((I=s.user)==null?void 0:I.namlen)??"Login",children:[n.jsx(ot,{auth:s,siswaData:i,onBlockRequest:y}),n.jsx(ct,{auth:s,data:i,hasPined:v,onPinModalOpen:D,onSetupPinModalOpen:K,onLogout:x}),s.user&&n.jsxs(n.Fragment,{children:[n.jsx(ut,{formattedSaldo:T,onNavigate:L}),n.jsx(dt,{menuItems:A,onItemClick:c})]}),n.jsx(pt,{data:i})]}),n.jsx(_e,{open:g==="blokir",onClose:()=>E(),setLoading:p}),n.jsx(me,{open:g==="pin",hasPin:v,setPage:f,handle:s.user?l?"riwayat":"auth":"index",onClose:O=>{E(O),O||b(!1)}}),n.jsx(Te,{open:g==="setupPin",hasPin:v,setHasPined:()=>m(!0),onClose:()=>{E()}})]})}}export{Ut as default};
