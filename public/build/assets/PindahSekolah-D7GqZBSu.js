import{K as S,u as E,r,j as e,m as F}from"./app-DO3tZnVq.js";import{I as y}from"./InputGroup-TjL9Kuks.js";import{d as N}from"./dayjs.min-CrXzgMAg.js";import{b as A}from"./index-CHxJwc3r.js";import{u as C}from"./use-mobile-Bylt0pvm.js";import{C as B,S as L}from"./status-badge-BmUx-53p.js";import{B as Y}from"./button-Bl_tdHr7.js";import{c as _}from"./utils-D30qrNMz.js";/* empty css            */import"./iconBase-DueJbBB4.js";import"./circle-alert-DW158ZSF.js";import"./index-pMqOmh7-.js";import"./clock-C0A0rIRi.js";import"./circle-check-big-DwzBQ1cW.js";const $=({siswa:n,onSubmit:t,isTagihanLunas:d})=>{const{errors:a}=S().props,{APP_DEBUG:s}=E(),[m,g]=r.useState({tgl:N().format("YYYY-MM-DD"),kelas:n.kel??"",sek:s?"TEST MODE":"",ala:s?"TEST MODE TEST MODE":""}),[j,f]=r.useState(a),o=r.useCallback((l,c)=>{g(b=>({...b,[l]:c})),j[l]},[g,j]),x=l=>{l.preventDefault(),t(m)};return e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(y,{label:"Tanggal",type:"date",name:"tgl",value:m.tgl,min:N().format("YYYY-MM-DD"),onChange:l=>o("tgl",l),errors:a,required:!0}),e.jsx(y,{label:"Kelas saat ini",type:"text",name:"kelas",value:m.kelas,onChange:l=>o("kelas",l),errors:a,required:!0}),e.jsx(y,{label:"Sekolah Tujuan",type:"text",name:"sek",value:m.sek,onChange:l=>o("sek",l),errors:a,required:!0})]}),e.jsx(y,{label:"Alasan",type:"textarea",name:"ala",value:m.ala,min:N().format("YYYY-MM-DD"),onChange:l=>o("ala",l),errors:a,className:"mb-4",required:!0}),e.jsx("button",{type:"submit",className:`px-4 py-2 rounded text-white ${d?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,disabled:!d,children:"Ajukan Pindah Sekolah"}),!d&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"Anda harus melunasi semua tagihan terlebih dahulu sebelum mengajukan pindah sekolah."})]})})},R=({billData:n})=>{const t=n.tagihan<=0,d=n.transactions.reduce((a,s)=>a+s.jumlah,0);return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Tagihan"}),t?e.jsx("div",{className:"bg-green-100 text-green-800 p-3 rounded",children:e.jsx("p",{className:"font-medium",children:"Semua tagihan sudah lunas. Anda dapat melanjutkan pengajuan pindah sekolah."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-100 text-red-800 p-3 rounded mb-4",children:[e.jsxs("p",{className:"font-medium",children:["Anda memiliki tagihan yang belum lunas sebesar Rp ",d.toLocaleString()]}),e.jsx("p",{className:"text-sm mt-1",children:"Silakan lunasi terlebih dahulu untuk mengajukan pindah sekolah."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detail Tagihan:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.transactions.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.bulan}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.ket}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:["Rp ",a.jumlah.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.sta===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.sta===1?"Lunas":"Belum Lunas"})})]},s))})]})})]})]})]})},q=({siswa:n,onClose:t})=>{var P;const{auth:d,data:a,summary:s}=S().props,m=C(),[g,j]=r.useState(!1),[f,o]=r.useState(!1),[x,l]=r.useState({nouid:a.nouid??((P=d.user)==null?void 0:P.nouid),items:a.tagihan??[],total_tagihan:(s==null?void 0:s.total_tagihan)??0,total_diskon:s.total_disc??0,sisa_tagihan:0,orderId:""}),[c,b]=r.useState("wallet"),{data:i,post:p,processing:h,setData:D,errors:M}=F({spr:s==null?void 0:s.spr,nouid:a.nouid,payment_method:c,amount:s.total_tagihan,orderId:"",uri:null});r.useEffect(()=>{D("payment_method",c)},[c,D]);const I=async u=>{u.preventDefault(),!k&&await p(route("tagihan.pay",a.nouid),{preserveScroll:!0,onSuccess:()=>{o(!0),setTimeout(()=>{t==null||t()},1e4)},onError:v=>{console.error("Payment error:",v),o(!1)}})},w=u=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(u),T=c==="wallet"&&n.balance<x.total_tagihan,k=h||T;return e.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[e.jsxs("div",{className:"border-b p-4 sm:p-6",children:[m&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("h1",{className:"text-2xl font-bold text-center",children:"Pembayaran Tagihan"})}),e.jsxs("div",{className:"mt-3grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 bg-gray-100 p-2",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-bold sm:text-base",children:["NIS: ",n.nis," - ",n.namlen.toUpperCase()]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Nomor Telepon"}),e.jsx("p",{className:"text-sm sm:text-base",children:n.tel||"Tidak ada data"})]})]})]}),e.jsxs("div",{className:"border-b p-4 sm:p-6",children:[e.jsxs("div",{className:"flex mb-3 text-center items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Rincian Tagihan"}),e.jsxs("span",{className:"bg-gray-100 p-1 text-sm rounded-3xl text-gray-500",children:["ID# ",x.orderId]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Tahun"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium tracking-wider text-gray-500 uppercase sm:px-6 sm:py-3",children:"Keterangan"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:x.items.map((u,v)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:u.tah}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:u.bulan}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:w(u.jumlah)}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-900 sm:px-6",children:u.ket})]},`${u.id}-${v}`))})]})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between sm:mt-6",children:[e.jsx("span",{className:"text-base font-semibold sm:text-lg",children:"Total Tagihan:"}),e.jsx("span",{className:"text-xl font-bold text-blue-600 sm:text-2xl",children:w(x.total_tagihan)})]})]}),e.jsx("div",{className:"p-4 sm:p-6",children:g?e.jsxs("div",{className:"mx-6 mb-4 rounded-lg border-l-4 border-yellow-500 bg-yellow-100 p-4 text-yellow-700 shadow-sm",children:[e.jsx("p",{className:"font-semibold",children:"Transaksi Belum Selesai"}),e.jsx("p",{className:"mt-1",children:"Anda memiliki transaksi yang belum selesai. Silakan selesaikan transaksi sebelumnya untuk melanjutkan."}),e.jsx("button",{onClick:()=>{i.uri&&(window.location.href=i.uri)},className:"mt-3 inline-block rounded bg-yellow-600 px-4 py-2 font-medium text-white transition hover:bg-yellow-700",children:"Lanjutkan ke Transaksi"})]}):f?e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:"text-md mb-3 font-semibold sm:mb-4",children:["Metode Pembayaran : ",c==="wallet"?"Saldo Tabungan":"Virtual Account"]}),e.jsxs("div",{className:"flex flex-col items-center space-y-4 p-6",children:[e.jsx("div",{className:"flex h-15 w-40 items-center justify-center border-4 border-green-700 p-4",children:e.jsx("h1",{className:"text-4xl font-bold text-green-700",children:"LUNAS"})}),e.jsx("p",{className:"text-gray-600",children:"Pembayaran berhasil diproses"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-3 text-lg font-semibold sm:mb-4 sm:text-xl",children:"Metode Pembayaran"}),e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-1 flex h-5 items-center",children:e.jsx("input",{id:"wallet",name:"payment_method",type:"radio",checked:c==="wallet",onChange:()=>b("wallet"),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:h})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("label",{htmlFor:"wallet",className:"block text-sm font-medium text-gray-700 sm:text-base",children:["Saldo Tabungan : ",w(n.balance)]}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:T?e.jsx("p",{className:"text-red-500",children:"Saldo tidak mencukupi"}):e.jsx("p",{children:"Cukup dan aman untuk bertransaksi"})})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mt-1 flex h-5 items-center",children:e.jsx("input",{id:"va",name:"payment_method",type:"radio",checked:c==="va",onChange:()=>b("va"),className:"h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500",disabled:h})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("label",{htmlFor:"va",className:"block text-sm font-medium text-gray-700 sm:text-base",children:"Virtual Account"}),e.jsx("div",{className:"mt-1 text-sm text-gray-500",children:"Transfer melalui bank partner"})]})]})]}),M.payment_method&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:M.payment_method}),e.jsx("div",{className:"mt-6 flex justify-end sm:mt-8",children:e.jsx("button",{type:"submit",disabled:k,className:`rounded-md px-6 py-3 text-base font-medium text-white shadow-sm transition-colors ${k?"cursor-not-allowed bg-gray-400":"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:outline-none"}`,children:h?e.jsxs("span",{className:"flex items-center justify-center",children:[e.jsx(A,{className:"mr-2 animate-spin"}),"Memproses..."]}):"Bayar Sekarang"})})]})]})})]})},se=({nouid:n})=>{const{data:t,summary:d}=S().props,a=C(),[s,m]=r.useState(null),[g,j]=r.useState(null);r.useEffect(()=>{t.pindah&&m(t.pindah)},[t.pindah]);const f={tagihan:(d==null?void 0:d.total_tagihan)??0,transactions:t.tagihan??[]},o=f.tagihan<=0,x=r.useCallback((p,h=!1)=>N(p).format(h?"DD MMMM YYYY HH:mm":"DD MMMM YYYY"),[]),l=p=>{const h={nops:`PS-${Math.floor(Math.random()*1e4)}`,tin:0,idta:0,tgl:p.tgl,idsis:t.idok||0,sek:p.sek,kelas:p.kelas,ala:p.ala,sta:"menunggu",created_at:new Date().toISOString()};j(h),m(h)},c=()=>{m(null),j(null)},b=()=>{console.log("Detail pengajuan:",s)},i=g||s;return e.jsx("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:i?e.jsxs("div",{className:"border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow bg-white space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 capitalize",children:"Pengajuan Pindah Sekolah"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(B,{className:"inline mr-1 w-4 h-4"}),x(i.tgl)]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Sekolah Tujuan:"})," ",i.sek]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Nomor Pengajuan:"})," ",i.nops||"-"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Alasan:"})," ",i.ala]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Tanggal Berhenti:"})," ",x(i.tgl)]})]})]}),e.jsx(L,{status:i.sta})]}),e.jsxs("div",{className:_("mt-4 flex justify-between gap-2 items-end",a&&"flex-col-reverse items-start"),children:[e.jsxs("span",{className:"text-xs text-start text-gray-400",children:["Diajukan pada: ",x(i.created_at,!0)]}),e.jsxs("div",{className:_("flex-1 flex w-full gap-2 justify-end",a&&"w-full"),children:[i.sta==="menunggu"&&e.jsx(Y,{variant:"destructive",size:"sm",onClick:c,className:"hover:bg-red-600 transition-colors",children:"Batalkan"}),e.jsx(Y,{size:"sm",onClick:b,children:"Detail"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-center text-blue-500 text-xl font-bold mb-6",children:"Formulir Permohonan Pindah Sekolah"}),e.jsx($,{siswa:t.siswa,onSubmit:l,isTagihanLunas:o}),e.jsx(R,{billData:f}),!o&&e.jsx(q,{siswa:t.siswa,onClose:()=>{}})]})})};export{se as default};
