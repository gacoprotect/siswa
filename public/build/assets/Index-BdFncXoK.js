import{R as fe,j as t,r as w,K as J,m as he,L as xe,S as X}from"./app-BRPsa61O.js";import{M as ge}from"./Modal-k6qPI2ZV.js";import{m as be,c as z,f as ye}from"./utils-CXz1v5ar.js";import{A as je,S as ve}from"./SetupPin-tVCqrpt3.js";import{C as ie}from"./ConfirmDialog -BKjs92rc.js";import{u as we}from"./use-toast-DOCIkLPK.js";import{A as q}from"./AppLayout-BQU1fh30.js";import{e as ke,f as Ne,g as Se,h as Oe,i as Pe,j as Ce,k as Ae,l as $e,m as De,n as Ie,o as Te,p as Fe,q as Ke,r as Ee}from"./index-FRbOP28H.js";import{G as Me}from"./iconBase-D5Xrf7wg.js";import Re from"./Topup-BmiOCUyZ.js";import Be from"./Tagihan-DdHdaedd.js";import He from"./DataSiswaContent-DWT5yfSs.js";import Le from"./Excul-DfRV8SUr.js";import Ue from"./Pin-bCMZAugp.js";import Ve from"./TagihanContent-D4cGwk6S.js";import{c as _e}from"./x-D0xI8Z31.js";import{C as qe}from"./circle-x-Dr_bgoI0.js";import{C as Qe}from"./circle-check-big-BYSxtb8b.js";import"./InputGroup-BxsDbU2v.js";import"./circle-alert-BUUYGTYP.js";import"./clsx-B-dksMZM.js";import"./index-m15TeWof.js";import"./index-Dw_nsZrn.js";import"./check-DSpnQ2ef.js";import"./copy-uFNn3zTN.js";import"./TambahTagihan-CZELMgyL.js";import"./RiwayatTagihan-lD7TXPcp.js";import"./dayjs.min-C3EG-i_Y.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],Ze=_e("ShieldOff",ze),te=fe.forwardRef(({value:a,onChange:r,onKeyDown:e,onPaste:n,type:l="text",error:o=!1,autoFocus:s=!1},u)=>t.jsx("input",{ref:u,type:l,inputMode:"numeric",pattern:"[0-9]*",maxLength:1,required:!0,autoComplete:"off",className:`h-12 w-12 rounded-md border text-center text-2xl focus:ring-1 focus:outline-none ${o?"border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"}`,value:a,onChange:r,onKeyDown:e,onPaste:n,autoFocus:s,onFocus:c=>c.target.select()}));te.displayName="DigitInput";const Ge=({otp:a,phone:r,errors:e,processing:n,countdown:l,onOtpChange:o,onKeyDown:s,onBack:u,onResendOtp:c,onSubmit:x,inputRefs:h})=>{const d=(p,i)=>{var b;const m=p.target.value.replace(/\D/g,"");o(m,i),m&&i<5&&h.current[i+1]&&((b=h.current[i+1])==null||b.focus())};return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("button",{onClick:u,className:"flex items-center text-sm text-gray-600 hover:text-gray-800",type:"button",children:[t.jsx(je,{className:"mr-1 h-4 w-4"}),"Kembali"]}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Verifikasi OTP"}),t.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Masukkan 6 digit kode OTP yang dikirim ke +62",r]})]}),e.otp&&t.jsx("div",{className:"text-center text-sm text-red-500",children:e.otp}),t.jsxs("form",{onSubmit:x,className:"space-y-6",children:[t.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((p,i)=>t.jsx(te,{ref:m=>{h.current[i]=m},value:a[i]||"",onChange:m=>d(m,i),onKeyDown:m=>s(m,i),error:!!e.otp,autoFocus:i===0},i))}),t.jsx("div",{className:"text-center",children:l>0?t.jsxs("p",{className:"text-sm text-gray-500",children:["Kirim ulang OTP dalam ",l," detik"]}):t.jsx("button",{type:"button",onClick:c,className:"text-sm text-blue-600 hover:text-blue-800",children:"Kirim Ulang OTP"})}),t.jsx("div",{children:t.jsx("button",{type:"submit",disabled:n||a.length!==6,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${a.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:n?"Memverifikasi...":"Verifikasi"})})]})]})},We=({phone:a,errors:r,processing:e,registeredPhone:n,onPhoneChange:l,onSubmit:o})=>t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Masukkan Nomor HP Anda yang terdaftar"}),t.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Kami akan mengirimkan kode OTP ke nomor ini ",t.jsx("br",{}),n]})]}),r.phone&&t.jsx("div",{className:"text-center text-sm text-red-500",children:r.phone}),t.jsxs("form",{onSubmit:o,className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Nomor Handphone"}),t.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[t.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:t.jsx("span",{className:"text-gray-500 sm:text-sm",children:"+62"})}),t.jsx("input",{type:"tel",id:"phone",name:"phone",autoComplete:"tel",className:`block w-full rounded-md border-2 ${r.phone?"border-red-500":"border-gray-300"} py-2 pl-12 focus:border-blue-500 focus:ring-blue-500`,placeholder:"8123456789",value:a,onChange:s=>l(s.target.value.replace(/\D/g,"")),required:!0})]})]}),t.jsx("div",{children:t.jsx("button",{type:"submit",disabled:e||a.length<10,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${a.length>=10?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:e?"Mengirim OTP...":"Kirim Kode OTP"})})]})]}),Ye=({pin:a,errors:r,inputType:e,processing:n,onPinChange:l,onKeyDown:o,onPaste:s,onToggleInputType:u,onSubmit:c,setInputRef:x,inputRefs:h})=>{const d=(p,i)=>{var b;const m=p.target.value.replace(/\D/g,"");l(p,i),m&&i<5&&h.current[i+1]&&((b=h.current[i+1])==null||b.focus())};return t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t.jsx("div",{children:t.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),r.pin&&t.jsx("div",{className:"mb-4 text-center text-sm text-red-500",children:r.pin}),t.jsxs("form",{className:"mt-8 space-y-6",onSubmit:c,children:[t.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((p,i)=>t.jsx(te,{ref:m=>{h.current[i]=m},type:e,value:a[i]||"",onChange:m=>d(m,i),onKeyDown:m=>o(m,i),onPaste:s,autoFocus:i===0},i))}),t.jsx("div",{className:"flex justify-center",children:t.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:u,children:e==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsx("button",{type:"submit",disabled:n||a.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${a.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:n?"Memverifikasi...":"Masuk"})})]})]})})},Je=({open:a,onClose:r,setLoading:e})=>{const[n,l]=w.useState("pin"),{errors:o,data:s}=J().props,[u,c]=w.useState(0),[x,h]=w.useState("password"),{data:d,setData:p,post:i,processing:m,reset:b}=he({phone:"",otp:"",pin:"",nouid:s.nouid??""}),f=w.useRef(Array(6).fill(null)),y=w.useRef(Array(6).fill(null));w.useEffect(()=>{if(u<=0)return;const g=setTimeout(()=>c(u-1),1e3);return()=>clearTimeout(g)},[u]),w.useEffect(()=>{const v=window.location.pathname.split("/")[1];p("nouid",v)},[p]),w.useEffect(()=>{var g,v;a&&n==="pin"&&y.current[0]&&((g=y.current[0])==null||g.focus()),a&&n==="otp"&&f.current[0]&&((v=f.current[0])==null||v.focus())},[a,n]);const k=(g,v)=>{const O=d.pin.split("");O[v]=g.charAt(g.length-1)||"",p("pin",O.join(""))},N=g=>{g.preventDefault();const v=route("otp.send",s.nouid);i(v,{onSuccess:()=>{l("otp"),c(60)}})},P=()=>{X.post(route("siswa.blocked",s.nouid),{},{onFinish:()=>{r(),setTimeout(()=>{e==null||e(!1)},5e3)}})},$=g=>{g.preventDefault(),i(route("otp.verif",s.nouid),{onSuccess:()=>{e==null||e(!0),console.log("KARTU DIBLOKIR"),P()}})},F=g=>{g.preventDefault(),/^\d{6}$/.test(d.pin)&&i(route("siswa.verify-pin",{nouid:s.nouid,p:"auth"}),{preserveState:!0,onSuccess:()=>{l("phone"),b()},onError:()=>{var v;p("pin",""),y.current[0]&&((v=y.current[0])==null||v.focus())}})},D=()=>{i(route("otp.send",s.nouid),{onSuccess:()=>{c(60)}})},E=(g,v,O)=>{const M=d[v].split("");M[O]=g.charAt(g.length-1)||"",p(v,M.join(""))},A=(g,v)=>{var O;g.key==="Backspace"&&!d.otp[v]&&v>0&&f.current[v-1]&&((O=f.current[v-1])==null||O.focus())},H=(g,v)=>{var O;g.key==="Backspace"&&!d.pin[v]&&v>0&&y.current[v-1]&&((O=y.current[v-1])==null||O.focus())},U=(g,v)=>{var M;g.preventDefault();const O=g.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(O.length>0){p(v,O);const _=Math.min(O.length-1,5),V=y;V.current[_]&&((M=V.current[_])==null||M.focus())}};return t.jsx(ge,{title:"Verifikasi PIN",isOpen:a,onClose:r,children:t.jsxs("div",{className:"flex items-center justify-center",children:[t.jsx(xe,{title:n==="pin"?"Verifikasi PIN":n==="otp"?"Verifikasi OTP":"Verifikasi Nomor Telepon"}),t.jsxs("div",{className:"w-full max-w-md rounded-lg",children:[n==="pin"&&t.jsx(Ye,{pin:d.pin,errors:o,inputType:x,processing:m,onPinChange:(g,v)=>k(g.target.value,v),onKeyDown:H,onPaste:g=>U(g,"pin"),onToggleInputType:()=>h(x==="password"?"text":"password"),onSubmit:F,setInputRef:(g,v)=>{y.current[v]=g},inputRefs:y}),n==="phone"&&t.jsx(We,{phone:d.phone,errors:o,processing:m,registeredPhone:be(s.siswa.tel??""),onPhoneChange:g=>p("phone",g),onSubmit:N}),n==="otp"&&t.jsx(Ge,{otp:d.otp,phone:d.phone,errors:o,processing:m,countdown:u,onOtpChange:(g,v)=>E(g,"otp",v),onKeyDown:A,onBack:()=>l("phone"),onResendOtp:D,onSubmit:$,inputRefs:f})]})]})})};function Xe(a){return Me({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(a)}function C(){return C=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)({}).hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},C.apply(null,arguments)}var et=String.prototype.replace,tt=/%20/g,rt="RFC3986",L={default:rt,formatters:{RFC1738:function(a){return et.call(a,tt,"+")},RFC3986:function(a){return String(a)}},RFC1738:"RFC1738"},Z=Object.prototype.hasOwnProperty,R=Array.isArray,I=function(){for(var a=[],r=0;r<256;++r)a.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return a}(),oe=function(a,r){for(var e=r&&r.plainObjects?Object.create(null):{},n=0;n<a.length;++n)a[n]!==void 0&&(e[n]=a[n]);return e},K={arrayToObject:oe,assign:function(a,r){return Object.keys(r).reduce(function(e,n){return e[n]=r[n],e},a)},combine:function(a,r){return[].concat(a,r)},compact:function(a){for(var r=[{obj:{o:a},prop:"o"}],e=[],n=0;n<r.length;++n)for(var l=r[n],o=l.obj[l.prop],s=Object.keys(o),u=0;u<s.length;++u){var c=s[u],x=o[c];typeof x=="object"&&x!==null&&e.indexOf(x)===-1&&(r.push({obj:o,prop:c}),e.push(x))}return function(h){for(;h.length>1;){var d=h.pop(),p=d.obj[d.prop];if(R(p)){for(var i=[],m=0;m<p.length;++m)p[m]!==void 0&&i.push(p[m]);d.obj[d.prop]=i}}}(r),a},decode:function(a,r,e){var n=a.replace(/\+/g," ");if(e==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},encode:function(a,r,e,n,l){if(a.length===0)return a;var o=a;if(typeof a=="symbol"?o=Symbol.prototype.toString.call(a):typeof a!="string"&&(o=String(a)),e==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(x){return"%26%23"+parseInt(x.slice(2),16)+"%3B"});for(var s="",u=0;u<o.length;++u){var c=o.charCodeAt(u);c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||l===L.RFC1738&&(c===40||c===41)?s+=o.charAt(u):c<128?s+=I[c]:c<2048?s+=I[192|c>>6]+I[128|63&c]:c<55296||c>=57344?s+=I[224|c>>12]+I[128|c>>6&63]+I[128|63&c]:(c=65536+((1023&c)<<10|1023&o.charCodeAt(u+=1)),s+=I[240|c>>18]+I[128|c>>12&63]+I[128|c>>6&63]+I[128|63&c])}return s},isBuffer:function(a){return!(!a||typeof a!="object"||!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a)))},isRegExp:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},maybeMap:function(a,r){if(R(a)){for(var e=[],n=0;n<a.length;n+=1)e.push(r(a[n]));return e}return r(a)},merge:function a(r,e,n){if(!e)return r;if(typeof e!="object"){if(R(r))r.push(e);else{if(!r||typeof r!="object")return[r,e];(n&&(n.plainObjects||n.allowPrototypes)||!Z.call(Object.prototype,e))&&(r[e]=!0)}return r}if(!r||typeof r!="object")return[r].concat(e);var l=r;return R(r)&&!R(e)&&(l=oe(r,n)),R(r)&&R(e)?(e.forEach(function(o,s){if(Z.call(r,s)){var u=r[s];u&&typeof u=="object"&&o&&typeof o=="object"?r[s]=a(u,o,n):r.push(o)}else r[s]=o}),r):Object.keys(e).reduce(function(o,s){var u=e[s];return o[s]=Z.call(o,s)?a(o[s],u,n):u,o},l)}},nt=Object.prototype.hasOwnProperty,le={brackets:function(a){return a+"[]"},comma:"comma",indices:function(a,r){return a+"["+r+"]"},repeat:function(a){return a}},B=Array.isArray,st=String.prototype.split,at=Array.prototype.push,ue=function(a,r){at.apply(a,B(r)?r:[r])},it=Date.prototype.toISOString,ce=L.default,S={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:K.encode,encodeValuesOnly:!1,format:ce,formatter:L.formatters[ce],indices:!1,serializeDate:function(a){return it.call(a)},skipNulls:!1,strictNullHandling:!1},ot=function a(r,e,n,l,o,s,u,c,x,h,d,p,i,m){var b,f=r;if(typeof u=="function"?f=u(e,f):f instanceof Date?f=h(f):n==="comma"&&B(f)&&(f=K.maybeMap(f,function(g){return g instanceof Date?h(g):g})),f===null){if(l)return s&&!i?s(e,S.encoder,m,"key",d):e;f=""}if(typeof(b=f)=="string"||typeof b=="number"||typeof b=="boolean"||typeof b=="symbol"||typeof b=="bigint"||K.isBuffer(f)){if(s){var y=i?e:s(e,S.encoder,m,"key",d);if(n==="comma"&&i){for(var k=st.call(String(f),","),N="",P=0;P<k.length;++P)N+=(P===0?"":",")+p(s(k[P],S.encoder,m,"value",d));return[p(y)+"="+N]}return[p(y)+"="+p(s(f,S.encoder,m,"value",d))]}return[p(e)+"="+p(String(f))]}var $,F=[];if(f===void 0)return F;if(n==="comma"&&B(f))$=[{value:f.length>0?f.join(",")||null:void 0}];else if(B(u))$=u;else{var D=Object.keys(f);$=c?D.sort(c):D}for(var E=0;E<$.length;++E){var A=$[E],H=typeof A=="object"&&A.value!==void 0?A.value:f[A];if(!o||H!==null){var U=B(f)?typeof n=="function"?n(e,A):e:e+(x?"."+A:"["+A+"]");ue(F,a(H,U,n,l,o,s,u,c,x,h,d,p,i,m))}}return F},ee=Object.prototype.hasOwnProperty,lt=Array.isArray,Q={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:K.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},ct=function(a){return a.replace(/&#(\d+);/g,function(r,e){return String.fromCharCode(parseInt(e,10))})},de=function(a,r){return a&&typeof a=="string"&&r.comma&&a.indexOf(",")>-1?a.split(","):a},ut=function(a,r,e,n){if(a){var l=e.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,o=/(\[[^[\]]*])/g,s=e.depth>0&&/(\[[^[\]]*])/.exec(l),u=s?l.slice(0,s.index):l,c=[];if(u){if(!e.plainObjects&&ee.call(Object.prototype,u)&&!e.allowPrototypes)return;c.push(u)}for(var x=0;e.depth>0&&(s=o.exec(l))!==null&&x<e.depth;){if(x+=1,!e.plainObjects&&ee.call(Object.prototype,s[1].slice(1,-1))&&!e.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+l.slice(s.index)+"]"),function(h,d,p,i){for(var m=i?d:de(d,p),b=h.length-1;b>=0;--b){var f,y=h[b];if(y==="[]"&&p.parseArrays)f=[].concat(m);else{f=p.plainObjects?Object.create(null):{};var k=y.charAt(0)==="["&&y.charAt(y.length-1)==="]"?y.slice(1,-1):y,N=parseInt(k,10);p.parseArrays||k!==""?!isNaN(N)&&y!==k&&String(N)===k&&N>=0&&p.parseArrays&&N<=p.arrayLimit?(f=[])[N]=m:k!=="__proto__"&&(f[k]=m):f={0:m}}m=f}return m}(c,r,e,n)}},dt=function(a,r){var e=function(x){return Q}();if(a===""||a==null)return e.plainObjects?Object.create(null):{};for(var n=typeof a=="string"?function(x,h){var d,p={},i=(h.ignoreQueryPrefix?x.replace(/^\?/,""):x).split(h.delimiter,h.parameterLimit===1/0?void 0:h.parameterLimit),m=-1,b=h.charset;if(h.charsetSentinel)for(d=0;d<i.length;++d)i[d].indexOf("utf8=")===0&&(i[d]==="utf8=%E2%9C%93"?b="utf-8":i[d]==="utf8=%26%2310003%3B"&&(b="iso-8859-1"),m=d,d=i.length);for(d=0;d<i.length;++d)if(d!==m){var f,y,k=i[d],N=k.indexOf("]="),P=N===-1?k.indexOf("="):N+1;P===-1?(f=h.decoder(k,Q.decoder,b,"key"),y=h.strictNullHandling?null:""):(f=h.decoder(k.slice(0,P),Q.decoder,b,"key"),y=K.maybeMap(de(k.slice(P+1),h),function($){return h.decoder($,Q.decoder,b,"value")})),y&&h.interpretNumericEntities&&b==="iso-8859-1"&&(y=ct(y)),k.indexOf("[]=")>-1&&(y=lt(y)?[y]:y),p[f]=ee.call(p,f)?K.combine(p[f],y):y}return p}(a,e):a,l=e.plainObjects?Object.create(null):{},o=Object.keys(n),s=0;s<o.length;++s){var u=o[s],c=ut(u,n[u],e,typeof a=="string");l=K.merge(l,c,e)}return K.compact(l)};class G{constructor(r,e,n){var l,o;this.name=r,this.definition=e,this.bindings=(l=e.bindings)!=null?l:{},this.wheres=(o=e.wheres)!=null?o:{},this.config=n}get template(){const r=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return r===""?"/":r}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var r,e;return(r=(e=this.template.match(/{[^}?]+\??}/g))==null?void 0:e.map(n=>({name:n.replace(/{|\??}/g,""),required:!/\?}$/.test(n)})))!=null?r:[]}matchesUrl(r){var e;if(!this.definition.methods.includes("GET"))return!1;const n=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(u,c,x,h)=>{var d;const p=`(?<${x}>${((d=this.wheres[x])==null?void 0:d.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return h?`(${c}${p})?`:`${c}${p}`}).replace(/^\w+:\/\//,""),[l,o]=r.replace(/^\w+:\/\//,"").split("?"),s=(e=new RegExp(`^${n}/?$`).exec(l))!=null?e:new RegExp(`^${n}/?$`).exec(decodeURI(l));if(s){for(const u in s.groups)s.groups[u]=typeof s.groups[u]=="string"?decodeURIComponent(s.groups[u]):s.groups[u];return{params:s.groups,query:dt(o)}}return!1}compile(r){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(e,n,l)=>{var o,s;if(!l&&[null,void 0].includes(r[n]))throw new Error(`Ziggy error: '${n}' parameter is required for route '${this.name}'.`);if(this.wheres[n]&&!new RegExp(`^${l?`(${this.wheres[n]})?`:this.wheres[n]}$`).test((s=r[n])!=null?s:""))throw new Error(`Ziggy error: '${n}' parameter '${r[n]}' does not match required format '${this.wheres[n]}' for route '${this.name}'.`);return encodeURI((o=r[n])!=null?o:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class pt extends String{constructor(r,e,n=!0,l){if(super(),this.t=l??(typeof Ziggy<"u"?Ziggy:globalThis==null?void 0:globalThis.Ziggy),this.t=C({},this.t,{absolute:n}),r){if(!this.t.routes[r])throw new Error(`Ziggy error: route '${r}' is not in the route list.`);this.i=new G(r,this.t.routes[r],this.t),this.u=this.l(e)}}toString(){const r=Object.keys(this.u).filter(e=>!this.i.parameterSegments.some(({name:n})=>n===e)).filter(e=>e!=="_query").reduce((e,n)=>C({},e,{[n]:this.u[n]}),{});return this.i.compile(this.u)+function(e,n){var l,o=e,s=function(i){if(!i)return S;if(i.encoder!=null&&typeof i.encoder!="function")throw new TypeError("Encoder has to be a function.");var m=i.charset||S.charset;if(i.charset!==void 0&&i.charset!=="utf-8"&&i.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var b=L.default;if(i.format!==void 0){if(!nt.call(L.formatters,i.format))throw new TypeError("Unknown format option provided.");b=i.format}var f=L.formatters[b],y=S.filter;return(typeof i.filter=="function"||B(i.filter))&&(y=i.filter),{addQueryPrefix:typeof i.addQueryPrefix=="boolean"?i.addQueryPrefix:S.addQueryPrefix,allowDots:i.allowDots===void 0?S.allowDots:!!i.allowDots,charset:m,charsetSentinel:typeof i.charsetSentinel=="boolean"?i.charsetSentinel:S.charsetSentinel,delimiter:i.delimiter===void 0?S.delimiter:i.delimiter,encode:typeof i.encode=="boolean"?i.encode:S.encode,encoder:typeof i.encoder=="function"?i.encoder:S.encoder,encodeValuesOnly:typeof i.encodeValuesOnly=="boolean"?i.encodeValuesOnly:S.encodeValuesOnly,filter:y,format:b,formatter:f,serializeDate:typeof i.serializeDate=="function"?i.serializeDate:S.serializeDate,skipNulls:typeof i.skipNulls=="boolean"?i.skipNulls:S.skipNulls,sort:typeof i.sort=="function"?i.sort:null,strictNullHandling:typeof i.strictNullHandling=="boolean"?i.strictNullHandling:S.strictNullHandling}}(n);typeof s.filter=="function"?o=(0,s.filter)("",o):B(s.filter)&&(l=s.filter);var u=[];if(typeof o!="object"||o===null)return"";var c=le[n&&n.arrayFormat in le?n.arrayFormat:n&&"indices"in n?n.indices?"indices":"repeat":"indices"];l||(l=Object.keys(o)),s.sort&&l.sort(s.sort);for(var x=0;x<l.length;++x){var h=l[x];s.skipNulls&&o[h]===null||ue(u,ot(o[h],h,c,s.strictNullHandling,s.skipNulls,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset))}var d=u.join(s.delimiter),p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(p+=s.charset==="iso-8859-1"?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),d.length>0?p+d:""}(C({},r,this.u._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(e,n)=>typeof e=="boolean"?Number(e):n(e)})}p(r){r?this.t.absolute&&r.startsWith("/")&&(r=this.h().host+r):r=this.v();let e={};const[n,l]=Object.entries(this.t.routes).find(([o,s])=>e=new G(o,s,this.t).matchesUrl(r))||[void 0,void 0];return C({name:n},e,{route:l})}v(){const{host:r,pathname:e,search:n}=this.h();return(this.t.absolute?r+e:e.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+n}current(r,e){const{name:n,params:l,query:o,route:s}=this.p();if(!r)return n;const u=new RegExp(`^${r.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(n);if([null,void 0].includes(e)||!u)return u;const c=new G(n,s,this.t);e=this.l(e,c);const x=C({},l,o);if(Object.values(e).every(d=>!d)&&!Object.values(x).some(d=>d!==void 0))return!0;const h=(d,p)=>Object.entries(d).every(([i,m])=>Array.isArray(m)&&Array.isArray(p[i])?m.every(b=>p[i].includes(b)):typeof m=="object"&&typeof p[i]=="object"&&m!==null&&p[i]!==null?h(m,p[i]):p[i]==m);return h(e,x)}h(){var r,e,n,l,o,s;const{host:u="",pathname:c="",search:x=""}=typeof window<"u"?window.location:{};return{host:(r=(e=this.t.location)==null?void 0:e.host)!=null?r:u,pathname:(n=(l=this.t.location)==null?void 0:l.pathname)!=null?n:c,search:(o=(s=this.t.location)==null?void 0:s.search)!=null?o:x}}get params(){const{params:r,query:e}=this.p();return C({},r,e)}get routeParams(){return this.p().params}get queryParams(){return this.p().query}has(r){return this.t.routes.hasOwnProperty(r)}l(r={},e=this.i){r!=null||(r={}),r=["string","number"].includes(typeof r)?[r]:r;const n=e.parameterSegments.filter(({name:l})=>!this.t.defaults[l]);return Array.isArray(r)?r=r.reduce((l,o,s)=>C({},l,n[s]?{[n[s].name]:o}:typeof o=="object"?o:{[o]:""}),{}):n.length!==1||r[n[0].name]||!r.hasOwnProperty(Object.values(e.bindings)[0])&&!r.hasOwnProperty("id")||(r={[n[0].name]:r}),C({},this.m(e),this.j(r,e))}m(r){return r.parameterSegments.filter(({name:e})=>this.t.defaults[e]).reduce((e,{name:n},l)=>C({},e,{[n]:this.t.defaults[n]}),{})}j(r,{bindings:e,parameterSegments:n}){return Object.entries(r).reduce((l,[o,s])=>{if(!s||typeof s!="object"||Array.isArray(s)||!n.some(({name:u})=>u===o))return C({},l,{[o]:s});if(!s.hasOwnProperty(e[o])){if(!s.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${o}' parameter is missing route model binding key '${e[o]}'.`);e[o]="id"}return C({},l,{[o]:s[e[o]]})},{})}valueOf(){return this.toString()}}function W(a,r,e,n){const l=new pt(a,r,e,n);return a?l.toString():l}const Y=({variant:a,title:r,description:e,icon:n,className:l})=>{const o={success:t.jsx(Qe,{className:"h-10 w-10 text-green-500"}),error:t.jsx(qe,{className:"h-10 w-10 text-red-500"}),blocked:t.jsx(Ze,{className:"h-10 w-10 text-red-500"})},s={success:{container:"border-blue-200 bg-blue-50 hover:shadow-blue-200",text:"text-blue-600",description:"text-blue-700"},error:{container:"border-red-300 bg-red-50 hover:shadow-red-200",text:"text-red-600",description:"text-red-700"},blocked:{container:"border-red-400 bg-red-50",text:"text-red-600",description:"text-red-700"}};return t.jsx("div",{className:"m-4 flex items-center justify-center",children:t.jsx("div",{className:z("relative w-full max-w-xl rounded-2xl border shadow-md transition-all duration-300",s[a].container,l),children:t.jsxs("div",{className:"flex flex-col items-center p-6 text-center",children:[t.jsx("div",{className:"mb-4",children:n||o[a]}),t.jsx("h3",{className:z("mb-2 text-xl font-bold",s[a].text),children:r}),t.jsx("div",{className:z("space-y-1 text-sm",s[a].description),children:typeof e=="string"?t.jsx("p",{children:e}):e})]})})})};function Lt(){var V,re,ne,se;const{auth:a,data:r}=J().props;console.count("Component Render : ");const[e,n]=w.useState(r),[l,o]=w.useState(null),[s,u]=w.useState("index"),[c,x]=w.useState(!1),[h,d]=w.useState(!1),[p,i]=w.useState(!!((V=r.summary)!=null&&V.pin)),[m,b]=w.useState(null),[f,y]=w.useState({spr:[],tagihan:0});we(J().props),w.useEffect(()=>{n(r)},[r]);const k=w.useCallback(async j=>{j==="riwayat"?(d(!0),b("pin")):u(j)},[]),N=w.useMemo(()=>[{title:"Tagihan",icon:t.jsx(ke,{className:"h-6 w-6 text-green-600"}),color:"border-green-700 bg-green-50 hover:bg-green-100",content:t.jsx(Ve,{nouid:e.nouid,setTagihanParam:j=>{y(j),k("tagihan")},onClose:()=>o(null)})},{title:"Data Siswa",icon:t.jsx(Ne,{className:"h-6 w-6 text-amber-600"}),color:"border-amber-700 bg-amber-50 hover:bg-amber-100",content:t.jsx(He,{nouid:e.nouid,siswa:e.siswa})},{title:"Kegiatan",icon:t.jsx(Se,{className:"h-6 w-6 text-rose-600"}),color:"border-rose-700 bg-rose-50 hover:bg-rose-100",content:t.jsx(Le,{nouid:r.nouid})}],[e,k,r]),P=w.useCallback(async()=>{try{x(!0);const j=await fetch(W("api.siswa",e.nouid)+`?nouid=${encodeURIComponent(e.nouid)}`);j.ok||console.error("Terjadi kesalahan saat mengambil data siswa");const T=await j.json();T.success!==!0&&console.error(T.message||"Terjadi kesalahan pada server"),n(T.data)}catch(j){x(!1),console.error(j instanceof Error?j.message:"Terjadi kesalahan jaringan")}finally{x(!1)}},[e]),$=w.useCallback(async()=>{c||b("pin")},[c]),F=w.useCallback(async()=>{c||b("setupPin")},[c]),D=w.useCallback(async(j=!1)=>{b(null),j||(d(!1),u("index"))},[]),[E,A]=w.useState(!1),H=w.useCallback(()=>{X.post(W("siswa.logout",e.nouid),{},{onStart:()=>x(!0),onSuccess:()=>x(!1),onError:()=>x(!1)})},[e.nouid]),U=w.useMemo(()=>ye((e==null?void 0:e.siswa.balance)||0),[e==null?void 0:e.siswa.balance]),g=w.useMemo(()=>{if(l===null)return null;const j=N[l];return j!=null&&j.content?t.jsx(q,{title:(j==null?void 0:j.title)||"MAI",children:t.jsxs("div",{className:"min-h-screen overflow-hidden rounded-lg bg-white shadow-md",children:[t.jsxs("div",{className:"flex items-center justify-between bg-primary px-4 py-4 text-primary-foreground",children:[t.jsxs("button",{onClick:()=>o(null),className:"flex items-center space-x-2 transition-opacity hover:opacity-80","aria-label":"Kembali",children:[t.jsx(Oe,{className:"text-primary-foreground"}),t.jsx("span",{children:"Kembali"})]}),t.jsx("h1",{className:"text-2xl font-bold text-white",children:j==null?void 0:j.title})]}),j.content]})}):t.jsx("div",{children:"Konten tidak tersedia"})},[l,N]),v=()=>{const[j,T]=w.useState(!1),[pe,ae]=w.useState(!1);return t.jsxs("div",{className:"relative flex w-full flex-col items-start rounded-t-lg bg-white p-4 px-6",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ce,{className:"flex-shrink-0 text-xl text-primary"}),t.jsx("h2",{className:"truncate text-3xl font-semibold text-primary",children:(e==null?void 0:e.siswa.namlen)||"******"})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx(Ae,{className:"flex-shrink-0 text-lg text-primary"}),t.jsxs("p",{className:"text-primary md:text-lg",children:["NIS: ",(e==null?void 0:e.siswa.nis)||"*****"]})]}),t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx($e,{className:"flex-shrink-0 text-lg text-primary"}),t.jsxs("p",{className:"text-primary md:text-lg",children:["Kelas: ",(e==null?void 0:e.siswa.kel)||"******"]})]}),t.jsx("div",{className:"absolute right-4 bottom-2",children:t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"cursor-pointer p-2",onClick:()=>T(me=>!me),children:t.jsx(De,{className:"text-xl text-blue-500"})}),j&&t.jsx("div",{className:"absolute right-0 z-10 mt-1 w-40 rounded-md border bg-white shadow-md",children:t.jsx("button",{onClick:()=>{T(!1),ae(!0)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"🔒 Blokir Kartu"})})]})}),t.jsx(ie,{open:pe,onOpenChange:ae,title:"Konfirmasi Blokir",description:"Apakah kamu yakin ingin memblokir kartu siswa ini?",confirmText:"Ya, Blokir",onConfirm:()=>{b("blokir")}})]})},O=()=>{const j=()=>{X.get(W("register",r.nouid))};return t.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-4 border-b-2 p-2 px-6",children:[a.user?t.jsxs(t.Fragment,{children:[t.jsxs("button",{onClick:()=>A(!0),className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-red-800 px-4 py-3 text-white shadow-sm transition-colors hover:bg-red-700",children:[t.jsx(Xe,{className:"text-lg"}),t.jsx("span",{children:"Keluar"})]}),t.jsx(ie,{open:E,onOpenChange:A,title:"Konfirmasi Logout",description:"Anda yakin ingin keluar?",confirmText:"Ya, Keluar",onConfirm:H})]}):t.jsxs("button",{onClick:$,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[t.jsx(Ie,{className:"text-lg"}),t.jsx("span",{children:"Masukan PIN"})]}),t.jsxs("button",{onClick:()=>{p?F():j()},className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[t.jsx(Te,{className:"text-lg"}),t.jsx("span",{children:p?"Ubah PIN":"Daftar"})]})]})},M=()=>t.jsx("div",{className:"mb-4 w-full shadow-[0px_10px_10px_-4px_rgba(0,0,0,0.1)] shadow-black",children:t.jsxs("div",{className:"flex w-full flex-row items-center justify-between gap-4 p-4 sm:px-6",children:[t.jsxs("div",{className:"flex flex-col space-y-4",children:[t.jsx("h1",{className:"text-lg font-semibold text-primary-foreground",children:"Saldo Tabungan"}),t.jsxs("div",{className:"flex items-center gap-2 text-primary-foreground",children:[t.jsx(Fe,{className:"text-xl"}),t.jsx("span",{className:"text-xl font-bold",children:U})]})]}),t.jsxs("div",{className:"flex flex-col items-end justify-end space-y-4",children:[t.jsxs("button",{onClick:()=>k("topup"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[t.jsx(Ke,{}),t.jsx("span",{children:"Topup"})]}),t.jsxs("button",{onClick:()=>k("riwayat"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[t.jsx(Ee,{}),t.jsx("span",{children:"Riwayat"})]})]})]})}),_=()=>t.jsx("div",{className:"mb-6 grid grid-cols-3 gap-4 px-4 sm:grid-cols-5",children:N.map((j,T)=>t.jsxs("button",{className:`flex flex-col items-center justify-center rounded-xl border border-t-5 p-2 transition duration-200 ${j.color}`,onClick:()=>o(T),children:[j.icon,t.jsx("span",{className:"mt-2 text-center text-sm font-semibold text-gray-800",children:j.title})]},T))});return c?t.jsx(q,{title:"Loading...",children:t.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center space-y-6 bg-blue-100",children:[t.jsx(Pe,{className:"animate-spin-slow text-5xl text-blue-400"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-2xl font-bold tracking-wider text-transparent",children:"Memuat Data"}),t.jsx("div",{className:"animate-loading-line absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-blue-400 to-purple-600"})]})]})}):t.jsxs(t.Fragment,{children:[r.active?t.jsx(t.Fragment,{children:l!==null?g:s==="index"?t.jsxs(q,{title:(e==null?void 0:e.siswa.namlen)||"Login",children:[t.jsx(v,{}),t.jsx(O,{}),a.user&&t.jsxs(t.Fragment,{children:[t.jsx(M,{}),t.jsx(_,{})]}),((re=r.summary)==null?void 0:re.reg)===0?t.jsx(Y,{variant:"success",title:"Pendaftaran Anda berhasil",description:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Terima kasih! Kami sedang memverifikasi data Anda."}),t.jsx("p",{children:"PIN akan dikirim ke nomor WhatsApp Anda setelah disetujui."}),t.jsx("p",{children:"Pastikan nomor WhatsApp yang Anda daftarkan aktif untuk menerima informasi lebih lanjut."})]})}):((ne=r.summary)==null?void 0:ne.reg)===-1?t.jsx(Y,{variant:"error",title:"Pendaftaran Anda ditolak",description:t.jsxs(t.Fragment,{children:[t.jsx("p",{children:"Mohon maaf, pendaftaran Anda belum dapat disetujui pada saat ini."}),t.jsx("p",{children:"Silakan mendaftar kembali dengan memastikan seluruh data telah lengkap dan sesuai ketentuan."}),t.jsx("p",{children:"Jika membutuhkan bantuan, silakan hubungi tim kami melalui kontak resmi yang tersedia."})]})}):((se=r.summary)==null?void 0:se.reg)===-2&&t.jsx(Y,{variant:"blocked",title:"Kartu Diblokir",description:"Kartu ini telah diblokir dan tidak dapat digunakan. Silakan hubungi pihak terkait untuk informasi lebih lanjut."})]}):s==="topup"?t.jsx(Re,{siswa:e.siswa,nouid:e.nouid,onClose:()=>{u("index"),D(),P()}}):s==="tagihan"?t.jsx(Be,{siswa:e.siswa,tagihanParam:{...f,nouid:e.nouid},onClose:()=>{u("index"),D(),P()}}):null}):t.jsx(q,{title:"Kartu Siswa",children:t.jsx("div",{className:"flex min-h-screen items-center bg-white",children:t.jsxs("div",{className:"mx-2 flex w-full flex-col items-center justify-center rounded-lg border-2 border-red-400 bg-red-50 p-6 text-center shadow-sm",children:[t.jsx("h3",{className:"mb-2 text-lg font-semibold text-red-600",children:"🔒 Kartu Diblokir"}),t.jsx("p",{className:"mb-4 text-sm text-red-700",children:"Kartu ini telah diblokir dan tidak dapat digunakan. Silakan aktifkan kembali untuk melanjutkan."}),t.jsx("button",{onClick:()=>b("setupPin"),className:"inline-flex items-center gap-2 rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white transition hover:bg-red-700",children:"🔓 Aktifkan Kembali"})]})})}),t.jsx(Je,{open:m==="blokir",onClose:()=>D(),setLoading:j=>x(j)}),t.jsx(Ue,{open:m==="pin",hasPin:p,handle:a.user?h?"riwayat":"auth":"index",setPage:u,setOpenSetupPin:F,onClose:j=>{D(j),j||d(!1)}}),t.jsx(ve,{open:m==="setupPin",hasPin:p,setHasPined:()=>i(!0),onClose:()=>{D(),P()}})]})}export{Lt as default};
