import{K as w,a as S,r as m,j as e}from"./app-C1oA2mP3.js";import{I as g}from"./InputGroup-Dj9DX4L8.js";import{d as j}from"./dayjs.min-D4M7HfqJ.js";import{D as v}from"./detail-payment-Dqd1YGNa.js";import{C as D,S as M}from"./status-badge-CVkg9guR.js";import{B as k}from"./button-DOpDa49i.js";import{u as Y}from"./use-mobile-BcLWOJmQ.js";import{c as y}from"./utils-DfZ1VLdE.js";/* empty css            */import"./iconBase-CAcpDmPN.js";import"./circle-alert-C57u22UB.js";import"./createLucideIcon-DJTpa_Un.js";import"./badge-BTeYqc9X.js";import"./index-9NrS2gm_.js";import"./payment-method-DDO8NOiz.js";import"./index-DoS0O0fn.js";import"./payment-utils-BtrWgZfc.js";import"./wallet-yHd4O52u.js";import"./clock-BFzwc_dw.js";import"./circle-check-big-FgMlXZAG.js";const P=({siswa:o,onSubmit:t,isTagihanLunas:n})=>{const{errors:a}=w().props,{APP_DEBUG:l}=S(),[i,u]=m.useState({tgl:j().format("YYYY-MM-DD"),kelas:o.kel??"",sek:l?"TEST MODE":"",ala:l?"TEST MODE TEST MODE":""}),[h,b]=m.useState(a),d=m.useCallback((s,f)=>{u(N=>({...N,[s]:f})),h[s]},[u,h]),x=s=>{s.preventDefault(),t(i)};return e.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:e.jsxs("form",{onSubmit:x,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(g,{label:"Tanggal",type:"date",name:"tgl",value:i.tgl,min:j().format("YYYY-MM-DD"),onChange:s=>d("tgl",s),errors:a,required:!0}),e.jsx(g,{label:"Kelas saat ini",type:"text",name:"kelas",value:i.kelas,onChange:s=>d("kelas",s),errors:a,required:!0}),e.jsx(g,{label:"Sekolah Tujuan",type:"text",name:"sek",value:i.sek,onChange:s=>d("sek",s),errors:a,required:!0})]}),e.jsx(g,{label:"Alasan",type:"textarea",name:"ala",value:i.ala,min:j().format("YYYY-MM-DD"),onChange:s=>d("ala",s),errors:a,className:"mb-4",required:!0}),e.jsx("button",{type:"submit",className:`px-4 py-2 rounded text-white ${n?"bg-blue-600 hover:bg-blue-700":"bg-gray-400 cursor-not-allowed"}`,disabled:!n,children:"Ajukan Pindah Sekolah"}),!n&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:"Anda harus melunasi semua tagihan terlebih dahulu sebelum mengajukan pindah sekolah."})]})})},C=({billData:o})=>{const t=o.tagihan<=0,n=o.transactions.reduce((a,l)=>a+l.jumlah,0);return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Status Tagihan"}),t?e.jsx("div",{className:"bg-green-100 text-green-800 p-3 rounded",children:e.jsx("p",{className:"font-medium",children:"Semua tagihan sudah lunas. Anda dapat melanjutkan pengajuan pindah sekolah."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-red-100 text-red-800 p-3 rounded mb-4",children:[e.jsxs("p",{className:"font-medium",children:["Anda memiliki tagihan yang belum lunas sebesar Rp ",n.toLocaleString()]}),e.jsx("p",{className:"text-sm mt-1",children:"Silakan lunasi terlebih dahulu untuk mengajukan pindah sekolah."})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Detail Tagihan:"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Bulan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.transactions.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.bulan}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:a.ket}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap",children:["Rp ",a.jumlah.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${a.sta===1?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.sta===1?"Lunas":"Belum Lunas"})})]},l))})]})})]})]})]})},W=({nouid:o})=>{const{data:t,summary:n}=w().props,a=Y(),[l,i]=m.useState(null),[u,h]=m.useState(null);m.useEffect(()=>{t.pindah&&i(t.pindah)},[t.pindah]);const b={tagihan:(n==null?void 0:n.total_tagihan)??0,transactions:t.tagihan??[]},d=b.tagihan<=0,x=m.useCallback((c,p=!1)=>j(c).format(p?"DD MMMM YYYY HH:mm":"DD MMMM YYYY"),[]),s=c=>{const p={nops:`PS-${Math.floor(Math.random()*1e4)}`,tin:0,idta:0,tgl:c.tgl,idsis:t.idok||0,sek:c.sek,kelas:c.kelas,ala:c.ala,sta:"menunggu",created_at:new Date().toISOString()};h(p),i(p)},f=()=>{i(null),h(null)},N=()=>{console.log("Detail pengajuan:",l)},r=u||l;return e.jsx("div",{className:"max-w-4xl mx-auto p-4 space-y-4",children:r?e.jsxs("div",{className:"border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow bg-white space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-800 capitalize",children:"Pengajuan Pindah Sekolah"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(D,{className:"inline mr-1 w-4 h-4"}),x(r.tgl)]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Sekolah Tujuan:"})," ",r.sek]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Nomor Pengajuan:"})," ",r.nops||"-"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Alasan:"})," ",r.ala]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Tanggal Berhenti:"})," ",x(r.tgl)]})]})]}),e.jsx(M,{status:r.sta})]}),e.jsxs("div",{className:y("mt-4 flex justify-between gap-2 items-end",a&&"flex-col-reverse items-start"),children:[e.jsxs("span",{className:"text-xs text-start text-gray-400",children:["Diajukan pada: ",x(r.created_at,!0)]}),e.jsxs("div",{className:y("flex-1 flex w-full gap-2 justify-end",a&&"w-full"),children:[r.sta==="menunggu"&&e.jsx(k,{variant:"destructive",size:"sm",onClick:f,className:"hover:bg-red-600 transition-colors",children:"Batalkan"}),e.jsx(k,{size:"sm",onClick:N,children:"Detail"})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-center text-blue-500 text-xl font-bold mb-6",children:"Formulir Permohonan Pindah Sekolah"}),e.jsx(P,{siswa:t.siswa,onSubmit:s,isTagihanLunas:d}),e.jsx(C,{billData:b}),!d&&e.jsx(v,{siswa:t.siswa,onClose:()=>{}})]})})};export{W as default};
