import{r,j as e}from"./app-5NnOfU4T.js";import{b as _,O as D,P as C}from"./index-Ce_fzsYs.js";import{d as i}from"./dayjs.min-C9V-DYJ5.js";const I=({nouid:j})=>{const[n,u]=r.useState(!0),[x,y]=r.useState(i().format("YYYY")),[h,N]=r.useState(i().format("MM")),[o,w]=r.useState(!0),[f,v]=r.useState({}),[d,k]=r.useState(null),[c,g]=r.useState(null),m=async(s={})=>{u(!0),g(null);try{const a=new URLSearchParams;s.t&&a.append("t",s.t),s.m&&a.append("m",s.m.toString());const t=await fetch(`${route("tagihan.history",j)}?${a.toString()}`);if(!t.ok)throw t.status===404?new Error("Data siswa tidak ditemukan"):new Error(`Terjadi kesalahan (${t.status})`);const l=await t.json();if(!l.success){if(l.errors){const M=Object.values(l.errors).flat().join(", ");throw new Error(`Validasi gagal: ${M}`)}throw new Error(l.message||"Gagal memuat data")}k(l.data)}catch(a){console.error("Fetch error:",a),g({message:a instanceof Error?a.message:"Gagal memuat data. Silakan coba lagi.",error_code:a==null?void 0:a.error_code})}finally{u(!1)}};r.useEffect(()=>{m()},[]);const b=()=>{const s=o?{}:{t:x,m:parseInt(h,10)};m(s)},S=s=>i(s).format("DD MMMM YYYY HH:mm"),p=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s);return n&&!d?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(_,{className:"animate-spin text-2xl mb-2"}),e.jsx("span",{children:"Memuat data tagihan..."})]}):c?e.jsxs("div",{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-red-500 mb-2",children:[c.message,c.error_code&&e.jsxs("span",{className:"text-gray-500 text-sm block mt-1",children:["Kode: ",c.error_code]})]}),e.jsx("button",{onClick:()=>m(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Coba Lagi"})]}):d?e.jsxs("div",{className:"p-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-8",children:[e.jsxs("div",{className:"flex gap-2 sm:self-end",children:[e.jsx("button",{onClick:()=>{w(!o),b()},className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-xl shadow-sm hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-1 disabled:opacity-50",disabled:n,children:o?"Filter":"Tampilkan Semua"}),!o&&e.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-xl shadow-sm hover:bg-green-700 transition focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-1 disabled:opacity-50",disabled:n,children:"Terapkan Filter"})]}),!o&&e.jsxs("div",{className:"flex flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tahun"}),e.jsx("select",{value:x,onChange:s=>y(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",disabled:n,children:Array.from({length:5},(s,a)=>{const t=i().year()-a;return e.jsx("option",{value:t,children:t},t)})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bulan"}),e.jsx("select",{value:h,onChange:s=>N(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",disabled:n,children:Array.from({length:12},(s,a)=>{const t=a+1;return e.jsx("option",{value:t,children:i().month(a).format("MMMM")},t)})})]})]})]}),e.jsx("div",{className:"space-y-4",children:d.trx.length===0?e.jsx("div",{className:"text-center py-8 bg-white rounded-lg shadow",children:e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tagihan untuk ditampilkan"})}):d.trx.map(s=>e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>v(a=>({...a,[s.order_id]:!a[s.order_id]})),children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-800",children:["ID: ",s.order_id]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:S(s.paid_at)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-bold text-gray-800 mr-3",children:p(s.amount)}),f[s.order_id]?e.jsx(D,{className:"text-gray-500"}):e.jsx(C,{className:"text-gray-500"})]})]}),f[s.order_id]&&e.jsxs("div",{className:"p-4 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Detail Tagihan"}),e.jsx("div",{className:"space-y-3",children:s.bills.map(a=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-b-0",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-800",children:a.ket}),e.jsxs("p",{className:"text-sm text-gray-500",children:["No: ",a.nmr]})]}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-medium text-gray-800",children:p(parseInt(a.jum))})})]},a.id))})]})]},s.order_id))})]}):null};export{I as default};
