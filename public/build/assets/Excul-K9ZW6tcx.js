import{K as W,a as Q,u as X,r as a,S as I,m as Y,j as e}from"./app-BCQLJZXK.js";import{I as B}from"./InputGroup-CCzWmXwm.js";import{M as Z}from"./Modal-o33I06dg.js";import{c as ee}from"./utils-CXz1v5ar.js";import{b as E,E as se,G as te,H as ae,I as re}from"./index-BU9zNRk0.js";import{y as G}from"./index-C37JfznO.js";import{C as le}from"./circle-alert-C9pSu8Fp.js";/* empty css            */import"./iconBase-BQ_oDsPS.js";import"./x-Df1DFpXY.js";import"./createLucideIcon-BDLI8lb5.js";import"./clsx-B-dksMZM.js";const je=({nouid:c,onClose:T})=>{const{data:o,errors:u}=W().props,{log:A,error:n}=Q(),{APP_DEBUG:L}=X(),[O,S]=a.useState(!0),[C,j]=a.useState(null),[l,D]=a.useState({open:!1,action:null,exculId:null,title:""}),[x,R]=a.useState({sub:[],waiting:[],rejected:[],exited:[],excul:[]}),_=s=>L?e.jsxs("div",{className:"border-2 border-red-500 px-4 py-2 rounded-lg space-y-2",children:[e.jsx("p",{className:"text-xs font-medium border-b-2",children:"Developer menu"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{I.get(route("simulasi.excul",{simulasi:"acc",excul:s,nouid:c}))},className:"p-1 bg-blue-500 rounded-md text-white cursor-pointer",children:"Terima"}),e.jsx("button",{onClick:()=>{I.get(route("simulasi.excul",{simulasi:"reject",excul:s,nouid:c}))},className:"p-1 bg-red-500 rounded-md text-white cursor-pointer",children:"Tolak"})]})]}):null,h=a.useCallback(async(s=!0)=>{try{await I.get(route("siswa.index",{nouid:c,page:"index",tab:"kegiatan"}),{},{only:["data.kegiatan"],preserveState:!0,onStart:()=>s&&S(!0),onError:T,onFinish:()=>s&&S(!1)})}catch(t){n(t instanceof Error?t.message:"Terjadi kesalahan jaringan"),S(!1)}},[c,T,n]);a.useEffect(()=>{o!=null&&o.kegiatan&&(R(o.kegiatan),A("Data siswa loaded:",o))},[o==null?void 0:o.kegiatan,A]),a.useEffect(()=>{h()},[]);const i=a.useMemo(()=>x.excul.map(s=>x.sub.includes(s.id)?{...s,status:"active",statusText:"Aktif"}:x.waiting.includes(s.id)?{...s,status:"waiting",statusText:"Menunggu"}:x.rejected.includes(s.id)?{...s,status:"rejected",statusText:"Ditolak"}:x.exited.includes(s.id)?{...s,status:"exited",statusText:"Keluar"}:{...s,status:"none",statusText:"Belum Terdaftar"}),[x]),F=a.useMemo(()=>i.filter(s=>s.status==="active"),[i]),M=a.useMemo(()=>i.filter(s=>s.status==="waiting"),[i]),U=a.useMemo(()=>i.filter(s=>s.status==="rejected"),[i]),V=a.useMemo(()=>i.filter(s=>s.status==="exited"),[i]),{data:b,setData:p,processing:z,post:N,reset:k,clearErrors:w,errors:K,setError:P}=Y({excul:0,tgl:"",ket:""}),q=a.useCallback((s=null)=>{const t={},r=s!==null,g=(y,v,f)=>{(!r||v===s)&&y&&(t[v]=f)};return g(!b.excul,"excul","Pilih Excul Anda"),g(!b.tgl,"tgl","Tanggal wajib diisi"),g(!b.ket,"ket","Masukkan alasan Anda"),t},[b]),$=a.useCallback(async(s,t)=>{try{if(p("excul",s),t==="cancel"){await N(route("cancel.excul",c),{preserveScroll:!0,preserveState:!0,onStart:()=>j(s),onSuccess:()=>h(!1),onError:()=>{G.error("Permintaan Gagal"),n(u)},onFinish:()=>j(null)});return}D({open:!0,action:t,exculId:s,title:t==="subscribe"?"Form Pendaftaran":"Form Keluar Ekstrakurikuler"})}catch(r){n(`${t} failed:`,r)}},[h,c,n,p,N,u]),H=a.useCallback(async()=>{if(!l.action||l.exculId===null)return;const s=q();if(P(s),Object.keys(s).length>0){n("Validation Error : ",s);const t=Object.keys(s)[0];if(t){const r=document.getElementById(t)||document.querySelector(`[name="${t}"], [data-name="${t}"]`);r==null||r.scrollIntoView({behavior:"smooth",block:"center"})}return}try{const t=l.action==="subscribe"?"subs.excul":"unsubs.excul";await N(route(t,c),{preserveScroll:!0,preserveState:!0,onStart:()=>j(l.exculId),onSuccess:()=>{h(!1),k()},onError:()=>{G.error("Permintaan Gagal"),n(u)},onFinish:()=>{j(null),D(r=>({...r,open:!1}))}})}catch(t){n(`${l.action} failed:`,t)}},[l,c,N,h,k,n,u,P,q]),J=a.useCallback(()=>{D(s=>({...s,open:!1})),k(),w()},[k,w]);if(O)return e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4",children:[e.jsx(E,{className:"animate-spin text-3xl text-blue-600"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:"Memuat data"})]});const m=s=>{switch(s){case"active":return e.jsx("span",{className:"rounded bg-green-100 px-2 py-1 text-xs text-green-800",children:"Aktif"});case"waiting":return e.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Menunggu"});case"rejected":return e.jsx("span",{className:"rounded bg-red-100 px-2 py-1 text-xs text-red-800",children:"Ditolak"});case"exited":return e.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Anda telah Keluar"});case"registered":return e.jsx("span",{className:"rounded bg-gray-100 px-2 py-1 text-xs text-gray-800",children:"Terdaftar"});default:return null}};return e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsx(Z,{isOpen:l.open,onClose:J,onConfirm:H,confirmText:z?e.jsx(E,{className:"animate-spin"}):"Kirim",className:"w-100 mx-5",size:"xl",title:l.title,children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(B,{label:`Tanggal ${l.action==="subscribe"?"Mulai":"Berhenti"}`,name:"tgl",type:"date",onChange:s=>{p("tgl",s),w("tgl")},required:!0,error:K.tgl}),e.jsx(B,{label:`${l.action==="subscribe"?"Motivasi mendaftar":"Alasan Berhenti"}`,name:"ket",type:"textarea",onChange:s=>{p("ket",s),w("ket")},required:!0,rows:3,error:K.ket})]})}),e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Ekstrakurikuler"})}),Object.keys(u).length>0&&e.jsxs("div",{className:"flex flex-row items-center justify-center space-x-3 py-4 border-2 border-red-600",children:[e.jsx(le,{className:"text-3xl text-red-600"}),e.jsx("span",{className:"text-md font-bold text-red-600",children:u.message??"Terjadi Kesalahan"})]}),F.length>0||M.length>0?e.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[e.jsx(se,{className:"text-green-500"}),"Ekstrakurikuler Aktif"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[F.map(s=>e.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),e.jsxs("p",{className:"text-gray-600",children:["Status: ",m(s.status)]})]}),e.jsx("button",{onClick:t=>{p("excul",s.id),t.preventDefault(),$(s.id,"unsubscribe")},disabled:C===s.id,className:"text-sm font-medium text-red-600 hover:text-red-800 disabled:opacity-50",children:C===s.id?e.jsx(E,{className:"animate-spin"}):"Keluar"})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),e.jsxs("span",{className:"text-gray-500",children:[s.day,", ",s.time]}),e.jsx("span",{className:"rounded bg-blue-100 px-2 py-1 text-xs text-blue-800",children:"Lihat Jadwal"})]})]},s.id)),M.map(s=>e.jsxs("div",{className:"rounded-lg bg-yellow-50 border-2 border-yellow-500 p-4 transition-shadow hover:shadow-md",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),e.jsxs("p",{className:"text-gray-600",children:["Status: ",m(s.status)]})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),e.jsxs("span",{className:"text-gray-500",children:[s.day,", ",s.time]}),_(s.id)]})]},s.id))]})]}):e.jsxs("div",{className:"py-8 text-center text-gray-500",children:[e.jsx("p",{children:"Anda belum terdaftar dalam ekstrakurikuler apapun"}),e.jsx("a",{href:"#list_excul",className:"mt-4 font-medium text-indigo-600 hover:text-indigo-800",children:"Daftar Sekarang"})]}),e.jsxs("div",{id:"list_excul",className:"rounded-lg bg-white p-6 shadow",children:[e.jsxs("h4",{className:"mb-4 flex items-center gap-2 border-b pb-2 text-lg font-semibold text-gray-800",children:[e.jsx(te,{className:"text-indigo-500"}),"Daftar Ekstrakurikuler Tersedia"]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(s=>{const t=s.registered===s.quota,r=M.some(d=>d.id===s.id),g=U.some(d=>d.id===s.id),y=V.some(d=>d.id===s.id),v=F.some(d=>d.id===s.id),f=C===s.id;return e.jsxs("div",{className:"rounded-lg border p-4 transition-shadow hover:shadow-lg",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-3",children:[e.jsx("h5",{className:"text-lg font-bold",children:s.name}),g&&m("rejected"),y&&m("exited")]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(ae,{className:"text-gray-400"}),s.day,", ",s.time]}),e.jsxs("p",{className:"text-gray-600",children:["Pelatih: ",s.coach]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-gray-500",children:["Kuota: ",s.registered,"/",s.quota]}),e.jsx("div",{className:"mt-1 h-1.5 w-full rounded-full bg-gray-200",children:e.jsx("div",{className:"h-1.5 rounded-full bg-green-500",style:{width:`${Math.min(100,s.registered/s.quota*100)}%`}})})]}),t?e.jsx("span",{className:"rounded bg-yellow-100 px-2 py-1 text-xs text-yellow-800",children:"Kuota Penuh"}):r?m("waiting"):e.jsx("div",{className:"flex items-center gap-4 justify-between pt-2",children:v?m("registered"):e.jsxs("button",{onClick:d=>{d.preventDefault(),$(s.id,"subscribe")},className:ee("flex items-center justify-center space-x-2 rounded bg-indigo-600 px-3 py-1 text-xs text-white hover:bg-indigo-700",f&&"bg-indigo-400 hover:bg-indigo-500"),disabled:f,children:[f&&e.jsx(E,{className:"animate-spin"}),e.jsx("span",{children:g||y?"Daftar Ulang":"Daftar"})]})})]})]})]},s.id)})})]}),e.jsx("div",{className:"rounded border-l-4 border-blue-400 bg-blue-50 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(re,{className:"mt-1 flex-shrink-0 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800",children:"Informasi Penting"}),e.jsxs("ul",{className:"mt-1 list-disc space-y-1 pl-5 text-sm text-blue-700",children:[e.jsx("li",{children:"Setiap siswa boleh mengikuti maksimal 2 ekstrakurikuler"}),e.jsx("li",{children:"Pendaftaran ditutup ketika kuota terpenuhi"}),e.jsx("li",{children:"Kehadiran minimal 80% untuk mendapatkan sertifikat"}),e.jsx("li",{children:"Status pendaftaran akan diperiksa oleh admin"})]})]})]})})]})};export{je as default};
