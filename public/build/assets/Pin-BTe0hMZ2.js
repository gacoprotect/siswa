import{r as d,j as e,K as T,m as M,R as K,a as H,L as J,S as Q}from"./app-DBFX6DRv.js";import{D as O,O as W}from"./OtpStep-TYVvl1J4.js";import{C as X}from"./circle-alert-Bg6sd1cH.js";import{M as Y}from"./Modal-BI251JNT.js";import{j as R}from"./index-CgWxBaoJ.js";const Z=({pin:i,errors:l,inputType:P,processing:b,onPinChange:w,onKeyDown:j,onPaste:x,onToggleInputType:c,onSubmit:S,inputRefs:v})=>{const[m,N]=d.useState(Object.keys(l).length>0),y=(h,o)=>{var k;N(!1);const u=h.target.value.replace(/\D/g,"");w(h,o),u&&o<5&&v.current[o+1]&&((k=v.current[o+1])==null||k.focus())};return d.useEffect(()=>{l&&N(Object.keys(l).length>0)},[l]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsx("div",{children:e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:S,children:[e.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((h,o)=>e.jsx(O,{ref:u=>{v.current[o]=u},type:P,value:i[o]||"",onChange:u=>y(u,o),onKeyDown:u=>j(u,o),onPaste:x,autoFocus:o===0,error:m},o))}),m&&(l.pin||l.message?e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:l.pin??l.message}),parseInt(l.remaining)<3&&e.jsx("span",{children:l.remaining?`sisa percobaan ${l.remaining}`:""})]}):e.jsx("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:e.jsxs("span",{children:[e.jsx(X,{className:"text-red-500 w-5 h-5"})," Terjadi Kesalahan"]})})),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:c,children:P==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:b||i.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${i.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:b?"Memverifikasi...":"Masuk"})})]})]})})},ee=({errors:i,inputType:l,onToggleInputType:P,onSukses:b})=>{const{data:w}=T().props,[j,x]=d.useState(Object.keys(i).length>0),{data:c,setData:S,post:v,processing:m,reset:N}=M({pin:"",pin_confirmation:""}),y=K.useRef(Array(6).fill(null)),h=K.useRef(Array(6).fill(null)),o=p=>{p.preventDefault(),v(route("siswa.process-setup-pin",w.nouid),{onSuccess:()=>{b==null||b(),N()}})},u=(p,t,n)=>{var g;const r=c[n].split("");r[t]=p.charAt(p.length-1)||"",S(n,r.join("")),p&&t<5&&((g=(n==="pin"?y:h).current[t+1])==null||g.focus())},k=(p,t,n)=>{var r;p.key==="Backspace"&&!c[n][t]&&t>0&&((r=(n==="pin"?y:h).current[t-1])==null||r.focus())},D=(p,t)=>{var r;p.preventDefault();const n=p.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(n.length>0){S(t,n);const g=Math.min(n.length-1,5);(r=(t==="pin"?y:h).current[g])==null||r.focus()}};return d.useEffect(()=>{x(Object.keys(i).length>0)},[i]),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Buat PIN 6 Digit Baru"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Untuk keamanan akun Anda"})]}),(i.pin||i.pin_confirmation)&&e.jsx("div",{className:"text-center text-sm text-red-500",children:i.pin||i.pin_confirmation}),e.jsxs("form",{className:"mt-8 space-y-6",onSubmit:o,children:[e.jsxs("div",{className:"flex flex-col gap-2 justify-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Masukkan PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((p,t)=>e.jsx(O,{ref:n=>{y.current[t]=n},type:l,value:c.pin[t]||"",onChange:n=>{const r=n.target.value.replace(/\D/g,"");u(r,t,"pin")},onKeyDown:n=>k(n,t,"pin"),onPaste:n=>D(n,"pin"),autoFocus:t===0&&c.pin.length===0,error:j},`pin-${t}`))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pin_confirmation",className:"mb-2 block text-center text-sm font-medium text-gray-700",children:"Konfirmasi PIN Baru"}),e.jsx("div",{className:"flex space-x-2",children:Array.from({length:6}).map((p,t)=>e.jsx(O,{ref:n=>{h.current[t]=n},type:l,value:c.pin_confirmation[t]||"",onChange:n=>{const r=n.target.value.replace(/\D/g,"");u(r,t,"pin_confirmation")},onKeyDown:n=>k(n,t,"pin_confirmation"),onPaste:n=>D(n,"pin_confirmation"),autoFocus:t===0&&c.pin.length===6&&c.pin_confirmation.length===0,error:j},`pin-confirm-${t}`))})]})]}),j&&(i.pin||i.message)&&e.jsxs("div",{className:"mb-4 flex flex-col text-center text-sm text-red-500",children:[e.jsx("span",{children:i.pin??i.message}),i.remaining&&parseInt(i.remaining)<3&&e.jsx("span",{children:`Sisa percobaan ${i.remaining}`})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:P,children:l==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsx("button",{type:"submit",disabled:m||c.pin.length!==6||c.pin_confirmation.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${c.pin.length===6&&c.pin_confirmation.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:m?"Memproses...":"Simpan PIN"})})]})]})})},te=({setOpenSetupPin:i,handle:l,setPage:P,hasPin:b,open:w,onClose:j})=>{var C,E;const{errors:x,data:c}=T().props,{error:S,log:v}=H(),{data:m,setData:N,post:y,processing:h,reset:o}=M({pin:"",nouid:c.nouid??"",otp:""}),[u,k]=d.useState("password"),[D,p]=d.useState(0),[t,n]=d.useState("pin"),r=d.useRef(Array(6).fill(null)),g=d.useRef(Array(6).fill(null));d.useEffect(()=>{if(D<=0)return;const s=setTimeout(()=>p(D-1),1e3);return()=>clearTimeout(s)},[D]),d.useEffect(()=>{var s,a;w&&r.current[0]&&((s=r.current[0])==null||s.focus()),w&&g.current[0]&&((a=g.current[0])==null||a.focus())},[w]);const A=s=>{s.preventDefault(),/^\d{6}$/.test(m.pin)&&y(route("siswa.verify-pin",{nouid:c.nouid,p:l??"auth"}),{preserveState:!0,onSuccess:()=>{P("index"),o(),j(!1)},onError:()=>{var a;N("pin",""),r.current[0]&&((a=r.current[0])==null||a.focus()),S(x)},onFinish:()=>{}})},F=(s,a)=>{const f=m.pin.split("");f[a]=s.charAt(s.length-1)||"",N("pin",f.join(""))},$=()=>{Q.get(route("register",m.nouid))},L=(s,a)=>{var f;s.key==="Backspace"&&!m.pin[a]&&a>0&&r.current[a-1]&&((f=r.current[a-1])==null||f.focus())},U=(s,a)=>{var I;s.preventDefault();const f=s.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(f.length>0){N(a,f);const B=Math.min(f.length-1,5),_=r;_!=null&&_.current[B]&&((I=_.current[B])==null||I.focus())}},V=s=>{s.preventDefault(),y(route("otp.verif",c.nouid),{onSuccess:()=>{v("OTP SUKSES"),n("setup")},onError:()=>{v("OTP GAGAL")}})},G=()=>{y(route("otp.send",c.nouid),{onSuccess:()=>{p(60)}})},z=(s,a,f)=>{const I=m[a].split("");I[f]=s.charAt(s.length-1)||"",N(a,I.join(""))},q=(s,a)=>{var f;s.key==="Backspace"&&!m.otp[a]&&a>0&&g.current[a-1]&&((f=g.current[a-1])==null||f.focus())};return d.useEffect(()=>{v("STEP : ",t),x.pin&&parseInt(x.remaining)===0&&n("otp")},[x.pin]),e.jsx(Y,{title:b?"":"Anda Belum Terverifikasi",isOpen:w,onClose:()=>{j(!1),o()},header:!1,children:b?e.jsxs("div",{className:"flex items-center justify-center p-2",children:[e.jsx(J,{title:"Masukkan PIN"}),e.jsxs("div",{className:"w-full max-w-md space-y-8",children:[t==="pin"&&e.jsx(Z,{pin:m.pin,errors:x,inputType:u,processing:h,onPinChange:(s,a)=>F(s.target.value,a),onKeyDown:L,onPaste:s=>U(s,"pin"),onToggleInputType:()=>k(u==="password"?"text":"password"),onSubmit:A,setInputRef:(s,a)=>{r.current[a]=s},inputRefs:r}),t==="otp"&&e.jsx(W,{otp:m.otp,errors:x,processing:h,countdown:D,onOtpChange:(s,a)=>z(s,"otp",a),onKeyDown:q,onBack:()=>j(!1),onResendOtp:G,onSubmit:V,inputRefs:g}),t==="setup"&&e.jsx(ee,{errors:x,inputType:u,onToggleInputType:()=>k(u==="password"?"text":"password"),onSukses:()=>j(!1)})]})]}):((C=c.summary)==null?void 0:C.reg)===1&&((E=c.summary)==null?void 0:E.pin)===!1?e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"max-w-md text-sm",children:"Untuk melanjutkan silahkan buat PIN Anda terlebih dahulu"}),e.jsxs("button",{onClick:i,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[e.jsx(R,{className:"text-lg"}),e.jsx("span",{children:"Buat Sekarang"})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"max-w-md text-sm",children:"Untuk melanjutkan silahkan verifikasi identitas diri Anda terlebih dahulu"}),e.jsxs("button",{onClick:$,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[e.jsx(R,{className:"text-lg"}),e.jsx("span",{children:"Verifikasi Sekarang"})]})]})})},ce=Object.freeze(Object.defineProperty({__proto__:null,default:te},Symbol.toStringTag,{value:"Module"}));export{Z as P,te as a,ce as b};
