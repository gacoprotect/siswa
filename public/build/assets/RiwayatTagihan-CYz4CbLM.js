import{r,j as e}from"./app-CcX2rsEW.js";import{b as D,L as M,M as C}from"./index-BJ41VFgO.js";import{d as l}from"./dayjs.min-CKb7cbJA.js";/* empty css            */import"./iconBase-C6iMlCGc.js";const R=({nouid:y})=>{const[n,x]=r.useState(!0),[h,N]=r.useState(l().format("YYYY")),[f,w]=r.useState(l().month()+1),[c,g]=r.useState(!0),[b,v]=r.useState({}),[i,k]=r.useState(null),[d,p]=r.useState(null),m=async(s={})=>{x(!0),p(null);try{const a=new URLSearchParams;s.t&&a.append("t",s.t),s.m&&a.append("m",s.m.toString());const t=await fetch(`${route("tagihan.history",y)}?${a.toString()}`);if(!t.ok)throw t.status===404?new Error("Data siswa tidak ditemukan"):new Error(`Terjadi kesalahan (${t.status})`);const o=await t.json();if(!o.success){if(o.errors){const _=Object.values(o.errors).flat().join(", ");throw new Error(`Validasi gagal: ${_}`)}throw new Error(o.message||"Gagal memuat data")}k(o.data)}catch(a){console.error("Fetch error:",a),p({message:a instanceof Error?a.message:"Gagal memuat data. Silakan coba lagi.",error_code:a==null?void 0:a.error_code})}finally{x(!1)}};r.useEffect(()=>{m()},[]);const u=(s=!0)=>{m(s?{}:{t:h,m:f})},S=s=>l(s).format("DD MMMM YYYY HH:mm"),j=s=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s);return n&&!i?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:[e.jsx(D,{className:"animate-spin text-2xl mb-2"}),e.jsx("span",{children:"Memuat data tagihan..."})]}):d?e.jsxs("div",{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-red-500 mb-2",children:[d.message,d.error_code&&e.jsxs("span",{className:"text-gray-500 text-sm block mt-1",children:["Kode: ",d.error_code]})]}),e.jsx("button",{onClick:()=>m(),className:"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Coba Lagi"})]}):i?e.jsxs("div",{className:"p-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-8",children:[e.jsxs("div",{className:"flex gap-2 sm:self-end",children:[c?e.jsx("button",{onClick:()=>{g(!1),u(!1)},className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-xl shadow-sm hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-1 disabled:opacity-50",disabled:n,children:"Filter"}):e.jsx("button",{onClick:()=>{g(!0),u(!0)},className:"px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-xl shadow-sm hover:bg-blue-700 transition focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-offset-1 disabled:opacity-50",disabled:n,children:"Tampilkan Semua"}),!c&&e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-sm font-medium bg-green-600 text-white rounded-xl shadow-sm hover:bg-green-700 transition focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-1 disabled:opacity-50",disabled:n,children:"Terapkan Filter"})]}),!c&&e.jsxs("div",{className:"flex flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tahun"}),e.jsx("select",{value:h,onChange:s=>N(s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",disabled:n,children:Array.from({length:5},(s,a)=>{const t=l().year()-a;return e.jsx("option",{value:t,children:t},t)})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bulan"}),e.jsx("select",{value:f,onChange:s=>w(Number(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50",disabled:n,children:Array.from({length:12},(s,a)=>{const t=a+1;return e.jsxs("option",{value:t,children:[l().month(a).format("MMMM")," "]},t)})})]})]})]}),e.jsx("div",{className:"space-y-4",children:i.trx.length===0?e.jsx("div",{className:"text-center py-8 bg-white rounded-lg shadow",children:e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tagihan untuk ditampilkan"})}):i.trx.map(s=>e.jsxs("div",{className:"bg-gray-100 rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 cursor-pointer bg-gray-200 hover:bg-gray-50 transition-colors",onClick:()=>v(a=>({...a,[s.order_id]:!a[s.order_id]})),children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm text-gray-800",children:["ID: ",s.order_id]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:S(s.paid_at)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-bold text-gray-800 mr-3",children:j(s.amount)}),b[s.order_id]?e.jsx(M,{className:"text-gray-500"}):e.jsx(C,{className:"text-gray-500"})]})]}),b[s.order_id]&&e.jsxs("div",{className:"p-4 border-t",children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-3",children:"Detail Tagihan"}),e.jsx("div",{className:"space-y-3",children:s.bills.map(a=>e.jsxs("div",{className:"flex justify-between items-center py-2 border-b last:border-b-0",children:[e.jsx("div",{children:e.jsxs("p",{className:"font-medium text-gray-800",children:[a.nmr,". ",a.ket]})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-medium text-gray-800",children:j(parseInt(a.jum))})})]},a.id))})]})]},s.order_id))})]}):null};export{R as default};
