import{j as e,S as I,r as o}from"./app-BGcLKc-6.js";import{B as j,b as S,d as E,E as B,H as k,I as L,J as M}from"./index-BOwtk-i8.js";import{X as $}from"./x-CPuglKmT.js";const F=({monthData:r,nouid:i,month:x})=>{const c=({tagihan:a,spr:h,tah:f})=>{I.get(route("tagihan.show",{nouid:i,bul:x}),{tah:f,spr:h,tagihan:a,nouid:i})},p=r.transactions.filter(a=>a.sta===0).reduce((a,h)=>a+h.jumlah,0),d=r.transactions.find(a=>a.jen===0);return e.jsx(e.Fragment,{children:r.transactions.some(a=>a.sta===0)&&e.jsxs("button",{onClick:()=>c({tah:(d==null?void 0:d.tah)??"",tagihan:p,spr:(d==null?void 0:d.spr)??0}),className:"flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700",children:[e.jsx(j,{className:"text-lg"}),"Bayar Sekarang"]})})},y=768;function R(){const[r,i]=o.useState();return o.useEffect(()=>{const x=window.matchMedia(`(max-width: ${y-1}px)`),c=()=>{i(window.innerWidth<y)};return x.addEventListener("change",c),i(window.innerWidth<y),()=>x.removeEventListener("change",c)},[]),!!r}const v=({title:r,value:i,icon:x,bgColor:c})=>e.jsx("div",{className:`${c} rounded-lg p-4 shadow-sm`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:r}),e.jsx("p",{className:"mt-1 text-2xl font-semibold text-gray-900",children:i})]}),e.jsx("div",{className:"rounded-full bg-white p-3",children:x})]})}),J=({nouid:r})=>{const i=R();console.log(i);const[x,c]=o.useState(!0),[p,d]=o.useState({}),[a,h]=o.useState(null),[f,w]=o.useState({}),[b,T]=o.useState(null);o.useEffect(()=>{(async()=>{try{c(!0),h(null);const l=await fetch(route("tagihan.index",r));if(!l.ok)throw new Error("Gagal memuat data tagihan");const u=await l.json();if(u.status!=="success")throw new Error("Terjadi kesalahan server");d(u.data),T(u.summary);const t=Object.keys(u.data).reduce((s,N)=>(s[N]=!1,s),{});w(t)}catch(l){h(l instanceof Error?l.message:"Terjadi kesalahan jaringan")}finally{c(!1)}})()},[r]);const C=n=>{w(l=>({...l,[n]:!l[n]}))},g=n=>{switch(n){case 2:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(E,{className:"mr-1"})," Lunas"]});case 1:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800",children:[e.jsx(S,{className:"mr-1 animate-spin"})," Proses"]});default:return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-800",children:[e.jsx(B,{className:"mr-1"})," Belum Bayar"]})}};return x?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4",children:[e.jsx(S,{className:"animate-spin"}),e.jsx("span",{children:"Memuat data..."})]}):a?e.jsxs("div",{className:"flex items-center justify-center space-x-3 p-4 text-red-600",children:[e.jsx($,{className:"animate-pulse"}),e.jsx("span",{children:a})]}):Object.keys(p).length===0?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Tidak ada data tagihan"}):e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between space-y-3",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:"Tagihan"}),e.jsxs("button",{className:"flex items-center gap-2 rounded-lg bg-green-600 px-4 py-2 text-white transition-colors hover:bg-green-700",children:[e.jsx(j,{className:"text-lg"}),"Buat Tagihan"]})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(v,{title:"Total Tagihan",value:`Rp ${b.total_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(j,{className:"text-blue-500"}),bgColor:"bg-blue-50"}),e.jsx(v,{title:"Total Pembayaran",value:`Rp ${b.total_pembayaran.toLocaleString("id-ID")}`,icon:e.jsx(E,{className:"text-green-500"}),bgColor:"bg-green-50"}),e.jsx(v,{title:"Sisa Tagihan",value:`Rp ${b.sisa_tagihan.toLocaleString("id-ID")}`,icon:e.jsx(B,{className:"text-amber-500"}),bgColor:"bg-amber-50"})]}),Object.entries(p).map(([n,l])=>{const u=Object.values(l).filter(m=>m.transactions.some(t=>t.sta===0&&t.jen===0)).length;return e.jsxs("div",{className:"rounded-lg border border-gray-200",children:[e.jsxs("button",{onClick:()=>C(n),className:"flex w-full items-center justify-between p-4 hover:bg-gray-50",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-800",children:["Tahun ",n]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[u>0&&e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[u," Belum Bayar"]}),f[n]?e.jsx(k,{className:"text-gray-500"}):e.jsx(L,{className:"text-gray-500"})]})]}),f[n]&&e.jsx("div",{className:"border-t border-gray-200",children:Object.entries(l).map(([m,t])=>e.jsxs("div",{className:"p-4",children:[i?e.jsxs("div",{className:"mb-3 flex-col items-center justify-between",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:m}),e.jsx("div",{className:"flex items-center space-x-2",children:t.transactions.some(s=>s.sta===1)?g(1):t.transactions.every(s=>s.sta===2||s.jen===1)?g(2):g(0)})]}),e.jsxs("div",{className:`mb-3 flex items-center ${t.transactions.some(s=>s.sta===0)?"justify-between":"justify-end"} `,children:[t.transactions.some(s=>s.sta===0)&&e.jsx(F,{monthData:t,nouid:r,month:m}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]})]}):e.jsxs("div",{className:"flex-col",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:m}),t.transactions.some(s=>s.sta===1)?g(1):t.transactions.every(s=>s.sta===2||s.jen===1)?g(2):g(0)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Tagihan:"}),e.jsxs("span",{className:`text-lg font-bold ${t.tagihan>0?"text-red-600":"text-green-600"}`,children:["Rp ",Math.abs(t.tagihan).toLocaleString("id-ID")]})]})]}),t.transactions.some(s=>s.sta===0)&&e.jsxs("button",{className:"mb-3 flex items-center gap-2 rounded-lg bg-green-600 p-2 text-sm text-white transition-colors hover:bg-green-700",children:[e.jsx(j,{className:"text-lg"}),"Bayar Sekarang"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jenis"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Keterangan"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:t.transactions.map((s,N)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===0?e.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[e.jsx(j,{className:"mr-1"}),"Tagihan"]}):e.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[e.jsx(M,{className:"mr-1"}),"Bantuan"]})}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap text-gray-500",children:s.ket}),e.jsxs("td",{className:`px-4 py-3 text-sm whitespace-nowrap ${s.jen===1?"text-green-600":"text-gray-700"}`,children:[s.jen===1?"+":"","Rp"," ",Math.abs(s.jumlah).toLocaleString("id-ID")]}),e.jsx("td",{className:"px-4 py-3 text-sm whitespace-nowrap",children:s.jen===1?"-":g(s.sta)})]},`${n}-${m}-${N}`))})]})})]},m))})]},n)})]})};export{J as default};
