import{R as ue,j as r,r as v,K as G,m as de,L as pe,S as se}from"./app-DC-RzZH0.js";import{M as fe}from"./Modal-ccAL_kOx.js";import{m as me,f as he}from"./utils-CXz1v5ar.js";import{A as xe,S as ge}from"./SetupPin-CfBHyUzj.js";import{D as be,C as X}from"./DataSiswaContent-BXa05wra.js";import{u as ye}from"./use-toast-RgAvCYVH.js";import{A as Q}from"./AppLayout-IV-TcOBs.js";import{G as je,e as ve,f as we,g as Ne,h as ke,i as Oe,j as Se,k as Pe,l as Ce,m as $e,n as Ae,o as De,p as Te,q as Ie,r as Fe}from"./index-COKR4JWv.js";import Ee from"./Topup-IS9A3XNG.js";import Re from"./Tagihan-N35l5ckS.js";import Ke from"./Excul-DQ8xVheE.js";import Me from"./Pin-CIx2RmZd.js";import Be from"./TagihanContent-BOPyW1OF.js";import"./x-9DmKd2c4.js";import"./clsx-B-dksMZM.js";import"./index-D1jxCrlk.js";import"./InputGroup-4ROFSzS5.js";import"./copy-CDHwknyp.js";import"./TambahTagihan-CCgS_kJz.js";const Y=ue.forwardRef(({value:a,onChange:t,onKeyDown:e,onPaste:n,type:l="text",error:i=!1,autoFocus:s=!1},c)=>r.jsx("input",{ref:c,type:l,inputMode:"numeric",pattern:"[0-9]*",maxLength:1,required:!0,autoComplete:"off",className:`h-12 w-12 rounded-md border text-center text-2xl focus:ring-1 focus:outline-none ${i?"border-red-500 focus:ring-red-500":"border-gray-300 focus:border-blue-500 focus:ring-blue-500"}`,value:a,onChange:t,onKeyDown:e,onPaste:n,autoFocus:s,onFocus:u=>u.target.select()}));Y.displayName="DigitInput";const He=({otp:a,phone:t,errors:e,processing:n,countdown:l,onOtpChange:i,onKeyDown:s,onBack:c,onResendOtp:u,onSubmit:b,inputRefs:m})=>{const d=(p,o)=>{var j;const f=p.target.value.replace(/\D/g,"");i(f,o),f&&o<5&&m.current[o+1]&&((j=m.current[o+1])==null||j.focus())};return r.jsxs("div",{className:"space-y-6",children:[r.jsxs("button",{onClick:c,className:"flex items-center text-sm text-gray-600 hover:text-gray-800",type:"button",children:[r.jsx(xe,{className:"mr-1 h-4 w-4"}),"Kembali"]}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Verifikasi OTP"}),r.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Masukkan 6 digit kode OTP yang dikirim ke +62",t]})]}),e.otp&&r.jsx("div",{className:"text-center text-sm text-red-500",children:e.otp}),r.jsxs("form",{onSubmit:b,className:"space-y-6",children:[r.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((p,o)=>r.jsx(Y,{ref:f=>{m.current[o]=f},value:a[o]||"",onChange:f=>d(f,o),onKeyDown:f=>s(f,o),error:!!e.otp,autoFocus:o===0},o))}),r.jsx("div",{className:"text-center",children:l>0?r.jsxs("p",{className:"text-sm text-gray-500",children:["Kirim ulang OTP dalam ",l," detik"]}):r.jsx("button",{type:"button",onClick:u,className:"text-sm text-blue-600 hover:text-blue-800",children:"Kirim Ulang OTP"})}),r.jsx("div",{children:r.jsx("button",{type:"submit",disabled:n||a.length!==6,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${a.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:n?"Memverifikasi...":"Verifikasi"})})]})]})},Ue=({phone:a,errors:t,processing:e,registeredPhone:n,onPhoneChange:l,onSubmit:i})=>r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-center text-2xl font-bold text-gray-900",children:"Masukkan Nomor HP Anda yang terdaftar"}),r.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Kami akan mengirimkan kode OTP ke nomor ini ",r.jsx("br",{}),n]})]}),t.phone&&r.jsx("div",{className:"text-center text-sm text-red-500",children:t.phone}),r.jsxs("form",{onSubmit:i,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700",children:"Nomor Handphone"}),r.jsxs("div",{className:"relative mt-1 rounded-md shadow-sm",children:[r.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:r.jsx("span",{className:"text-gray-500 sm:text-sm",children:"+62"})}),r.jsx("input",{type:"tel",id:"phone",name:"phone",autoComplete:"tel",className:`block w-full rounded-md border-2 ${t.phone?"border-red-500":"border-gray-300"} py-2 pl-12 focus:border-blue-500 focus:ring-blue-500`,placeholder:"8123456789",value:a,onChange:s=>l(s.target.value.replace(/\D/g,"")),required:!0})]})]}),r.jsx("div",{children:r.jsx("button",{type:"submit",disabled:e||a.length<10,className:`flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white shadow-sm ${a.length>=10?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"cursor-not-allowed bg-gray-400"} focus:ring-2 focus:ring-offset-2 focus:outline-none`,children:e?"Mengirim OTP...":"Kirim Kode OTP"})})]})]}),Ve=({pin:a,errors:t,inputType:e,processing:n,onPinChange:l,onKeyDown:i,onPaste:s,onToggleInputType:c,onSubmit:u,setInputRef:b,inputRefs:m})=>{const d=(p,o)=>{var j;const f=p.target.value.replace(/\D/g,"");l(p,o),f&&o<5&&m.current[o+1]&&((j=m.current[o+1])==null||j.focus())};return r.jsx("div",{className:"flex items-center justify-center",children:r.jsxs("div",{className:"w-full max-w-md space-y-8",children:[r.jsx("div",{children:r.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Masukkan PIN"})}),t.pin&&r.jsx("div",{className:"mb-4 text-center text-sm text-red-500",children:t.pin}),r.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[r.jsx("div",{className:"flex justify-center space-x-2",children:Array.from({length:6}).map((p,o)=>r.jsx(Y,{ref:f=>{m.current[o]=f},type:e,value:a[o]||"",onChange:f=>d(f,o),onKeyDown:f=>i(f,o),onPaste:s,autoFocus:o===0},o))}),r.jsx("div",{className:"flex justify-center",children:r.jsx("button",{type:"button",className:"text-sm text-gray-600 hover:text-gray-800",onClick:c,children:e==="password"?"Tampilkan PIN":"Sembunyikan PIN"})}),r.jsx("div",{className:"flex flex-col space-y-2",children:r.jsx("button",{type:"submit",disabled:n||a.length!==6,className:`group relative flex w-full justify-center rounded-md border border-transparent px-4 py-2 text-sm font-medium text-white ${a.length===6?"bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:outline-none":"cursor-not-allowed bg-gray-400"}`,children:n?"Memverifikasi...":"Masuk"})})]})]})})},qe=({open:a,onClose:t,setLoading:e})=>{const[n,l]=v.useState("pin"),{errors:i,data:s}=G().props,[c,u]=v.useState(0),[b,m]=v.useState("password"),{data:d,setData:p,post:o,processing:f,reset:j}=de({phone:"",otp:"",pin:"",nouid:s.nouid??""}),h=v.useRef(Array(6).fill(null)),x=v.useRef(Array(6).fill(null));v.useEffect(()=>{if(c<=0)return;const g=setTimeout(()=>u(c-1),1e3);return()=>clearTimeout(g)},[c]),v.useEffect(()=>{const y=window.location.pathname.split("/")[1];p("nouid",y)},[p]),v.useEffect(()=>{var g,y;a&&n==="pin"&&x.current[0]&&((g=x.current[0])==null||g.focus()),a&&n==="otp"&&h.current[0]&&((y=h.current[0])==null||y.focus())},[a,n]);const N=(g,y)=>{const O=d.pin.split("");O[y]=g.charAt(g.length-1)||"",p("pin",O.join(""))},S=g=>{g.preventDefault();const y=route("otp.send",s.nouid);o(y,{onSuccess:()=>{l("otp"),u(60)}})},P=()=>{se.post(route("siswa.blocked",s.nouid),{},{onFinish:()=>{t(),setTimeout(()=>{e==null||e(!1)},5e3)}})},$=g=>{g.preventDefault(),o(route("otp.verif",s.nouid),{onSuccess:()=>{e==null||e(!0),console.log("KARTU DIBLOKIR"),P()}})},T=g=>{g.preventDefault(),/^\d{6}$/.test(d.pin)&&o(route("siswa.verify-pin",{nouid:s.nouid,p:"auth"}),{preserveState:!0,onSuccess:()=>{l("phone"),j()},onError:()=>{var y;p("pin",""),x.current[0]&&((y=x.current[0])==null||y.focus())}})},B=()=>{o(route("otp.send",s.nouid),{onSuccess:()=>{u(60)}})},F=(g,y,O)=>{const R=d[y].split("");R[O]=g.charAt(g.length-1)||"",p(y,R.join(""))},C=(g,y)=>{var O;g.key==="Backspace"&&!d.otp[y]&&y>0&&h.current[y-1]&&((O=h.current[y-1])==null||O.focus())},H=(g,y)=>{var O;g.key==="Backspace"&&!d.pin[y]&&y>0&&x.current[y-1]&&((O=x.current[y-1])==null||O.focus())},U=(g,y)=>{var R;g.preventDefault();const O=g.clipboardData.getData("text/plain").replace(/\D/g,"").slice(0,6);if(O.length>0){p(y,O);const q=Math.min(O.length-1,5),L=x;L.current[q]&&((R=L.current[q])==null||R.focus())}};return r.jsx(fe,{title:"Verifikasi PIN",isOpen:a,onClose:t,children:r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx(pe,{title:n==="pin"?"Verifikasi PIN":n==="otp"?"Verifikasi OTP":"Verifikasi Nomor Telepon"}),r.jsxs("div",{className:"w-full max-w-md rounded-lg",children:[n==="pin"&&r.jsx(Ve,{pin:d.pin,errors:i,inputType:b,processing:f,onPinChange:(g,y)=>N(g.target.value,y),onKeyDown:H,onPaste:g=>U(g,"pin"),onToggleInputType:()=>m(b==="password"?"text":"password"),onSubmit:T,setInputRef:(g,y)=>{x.current[y]=g},inputRefs:x}),n==="phone"&&r.jsx(Ue,{phone:d.phone,errors:i,processing:f,registeredPhone:me(s.siswa.tel??""),onPhoneChange:g=>p("phone",g),onSubmit:S}),n==="otp"&&r.jsx(He,{otp:d.otp,phone:d.phone,errors:i,processing:f,countdown:c,onOtpChange:(g,y)=>F(g,"otp",y),onKeyDown:C,onBack:()=>l("phone"),onResendOtp:B,onSubmit:$,inputRefs:h})]})]})})};function Le(a){return je({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"},child:[]},{tag:"polyline",attr:{points:"16 17 21 12 16 7"},child:[]},{tag:"line",attr:{x1:"21",y1:"12",x2:"9",y2:"12"},child:[]}]})(a)}function A(){return A=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)({}).hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},A.apply(null,arguments)}var _e=String.prototype.replace,Qe=/%20/g,ze="RFC3986",V={default:ze,formatters:{RFC1738:function(a){return _e.call(a,Qe,"+")},RFC3986:function(a){return String(a)}},RFC1738:"RFC1738"},z=Object.prototype.hasOwnProperty,K=Array.isArray,D=function(){for(var a=[],t=0;t<256;++t)a.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return a}(),ee=function(a,t){for(var e=t&&t.plainObjects?Object.create(null):{},n=0;n<a.length;++n)a[n]!==void 0&&(e[n]=a[n]);return e},E={arrayToObject:ee,assign:function(a,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},a)},combine:function(a,t){return[].concat(a,t)},compact:function(a){for(var t=[{obj:{o:a},prop:"o"}],e=[],n=0;n<t.length;++n)for(var l=t[n],i=l.obj[l.prop],s=Object.keys(i),c=0;c<s.length;++c){var u=s[c],b=i[u];typeof b=="object"&&b!==null&&e.indexOf(b)===-1&&(t.push({obj:i,prop:u}),e.push(b))}return function(m){for(;m.length>1;){var d=m.pop(),p=d.obj[d.prop];if(K(p)){for(var o=[],f=0;f<p.length;++f)p[f]!==void 0&&o.push(p[f]);d.obj[d.prop]=o}}}(t),a},decode:function(a,t,e){var n=a.replace(/\+/g," ");if(e==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},encode:function(a,t,e,n,l){if(a.length===0)return a;var i=a;if(typeof a=="symbol"?i=Symbol.prototype.toString.call(a):typeof a!="string"&&(i=String(a)),e==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(b){return"%26%23"+parseInt(b.slice(2),16)+"%3B"});for(var s="",c=0;c<i.length;++c){var u=i.charCodeAt(c);u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||l===V.RFC1738&&(u===40||u===41)?s+=i.charAt(c):u<128?s+=D[u]:u<2048?s+=D[192|u>>6]+D[128|63&u]:u<55296||u>=57344?s+=D[224|u>>12]+D[128|u>>6&63]+D[128|63&u]:(u=65536+((1023&u)<<10|1023&i.charCodeAt(c+=1)),s+=D[240|u>>18]+D[128|u>>12&63]+D[128|u>>6&63]+D[128|63&u])}return s},isBuffer:function(a){return!(!a||typeof a!="object"||!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a)))},isRegExp:function(a){return Object.prototype.toString.call(a)==="[object RegExp]"},maybeMap:function(a,t){if(K(a)){for(var e=[],n=0;n<a.length;n+=1)e.push(t(a[n]));return e}return t(a)},merge:function a(t,e,n){if(!e)return t;if(typeof e!="object"){if(K(t))t.push(e);else{if(!t||typeof t!="object")return[t,e];(n&&(n.plainObjects||n.allowPrototypes)||!z.call(Object.prototype,e))&&(t[e]=!0)}return t}if(!t||typeof t!="object")return[t].concat(e);var l=t;return K(t)&&!K(e)&&(l=ee(t,n)),K(t)&&K(e)?(e.forEach(function(i,s){if(z.call(t,s)){var c=t[s];c&&typeof c=="object"&&i&&typeof i=="object"?t[s]=a(c,i,n):t.push(i)}else t[s]=i}),t):Object.keys(e).reduce(function(i,s){var c=e[s];return i[s]=z.call(i,s)?a(i[s],c,n):c,i},l)}},Ze=Object.prototype.hasOwnProperty,te={brackets:function(a){return a+"[]"},comma:"comma",indices:function(a,t){return a+"["+t+"]"},repeat:function(a){return a}},M=Array.isArray,Ge=String.prototype.split,We=Array.prototype.push,ae=function(a,t){We.apply(a,M(t)?t:[t])},Ye=Date.prototype.toISOString,re=V.default,k={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:E.encode,encodeValuesOnly:!1,format:re,formatter:V.formatters[re],indices:!1,serializeDate:function(a){return Ye.call(a)},skipNulls:!1,strictNullHandling:!1},Je=function a(t,e,n,l,i,s,c,u,b,m,d,p,o,f){var j,h=t;if(typeof c=="function"?h=c(e,h):h instanceof Date?h=m(h):n==="comma"&&M(h)&&(h=E.maybeMap(h,function(g){return g instanceof Date?m(g):g})),h===null){if(l)return s&&!o?s(e,k.encoder,f,"key",d):e;h=""}if(typeof(j=h)=="string"||typeof j=="number"||typeof j=="boolean"||typeof j=="symbol"||typeof j=="bigint"||E.isBuffer(h)){if(s){var x=o?e:s(e,k.encoder,f,"key",d);if(n==="comma"&&o){for(var N=Ge.call(String(h),","),S="",P=0;P<N.length;++P)S+=(P===0?"":",")+p(s(N[P],k.encoder,f,"value",d));return[p(x)+"="+S]}return[p(x)+"="+p(s(h,k.encoder,f,"value",d))]}return[p(e)+"="+p(String(h))]}var $,T=[];if(h===void 0)return T;if(n==="comma"&&M(h))$=[{value:h.length>0?h.join(",")||null:void 0}];else if(M(c))$=c;else{var B=Object.keys(h);$=u?B.sort(u):B}for(var F=0;F<$.length;++F){var C=$[F],H=typeof C=="object"&&C.value!==void 0?C.value:h[C];if(!i||H!==null){var U=M(h)?typeof n=="function"?n(e,C):e:e+(b?"."+C:"["+C+"]");ae(T,a(H,U,n,l,i,s,c,u,b,m,d,p,o,f))}}return T},W=Object.prototype.hasOwnProperty,Xe=Array.isArray,_={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:E.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},et=function(a){return a.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},oe=function(a,t){return a&&typeof a=="string"&&t.comma&&a.indexOf(",")>-1?a.split(","):a},tt=function(a,t,e,n){if(a){var l=e.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a,i=/(\[[^[\]]*])/g,s=e.depth>0&&/(\[[^[\]]*])/.exec(l),c=s?l.slice(0,s.index):l,u=[];if(c){if(!e.plainObjects&&W.call(Object.prototype,c)&&!e.allowPrototypes)return;u.push(c)}for(var b=0;e.depth>0&&(s=i.exec(l))!==null&&b<e.depth;){if(b+=1,!e.plainObjects&&W.call(Object.prototype,s[1].slice(1,-1))&&!e.allowPrototypes)return;u.push(s[1])}return s&&u.push("["+l.slice(s.index)+"]"),function(m,d,p,o){for(var f=o?d:oe(d,p),j=m.length-1;j>=0;--j){var h,x=m[j];if(x==="[]"&&p.parseArrays)h=[].concat(f);else{h=p.plainObjects?Object.create(null):{};var N=x.charAt(0)==="["&&x.charAt(x.length-1)==="]"?x.slice(1,-1):x,S=parseInt(N,10);p.parseArrays||N!==""?!isNaN(S)&&x!==N&&String(S)===N&&S>=0&&p.parseArrays&&S<=p.arrayLimit?(h=[])[S]=f:N!=="__proto__"&&(h[N]=f):h={0:f}}f=h}return f}(u,t,e,n)}},rt=function(a,t){var e=function(b){return _}();if(a===""||a==null)return e.plainObjects?Object.create(null):{};for(var n=typeof a=="string"?function(b,m){var d,p={},o=(m.ignoreQueryPrefix?b.replace(/^\?/,""):b).split(m.delimiter,m.parameterLimit===1/0?void 0:m.parameterLimit),f=-1,j=m.charset;if(m.charsetSentinel)for(d=0;d<o.length;++d)o[d].indexOf("utf8=")===0&&(o[d]==="utf8=%E2%9C%93"?j="utf-8":o[d]==="utf8=%26%2310003%3B"&&(j="iso-8859-1"),f=d,d=o.length);for(d=0;d<o.length;++d)if(d!==f){var h,x,N=o[d],S=N.indexOf("]="),P=S===-1?N.indexOf("="):S+1;P===-1?(h=m.decoder(N,_.decoder,j,"key"),x=m.strictNullHandling?null:""):(h=m.decoder(N.slice(0,P),_.decoder,j,"key"),x=E.maybeMap(oe(N.slice(P+1),m),function($){return m.decoder($,_.decoder,j,"value")})),x&&m.interpretNumericEntities&&j==="iso-8859-1"&&(x=et(x)),N.indexOf("[]=")>-1&&(x=Xe(x)?[x]:x),p[h]=W.call(p,h)?E.combine(p[h],x):x}return p}(a,e):a,l=e.plainObjects?Object.create(null):{},i=Object.keys(n),s=0;s<i.length;++s){var c=i[s],u=tt(c,n[c],e,typeof a=="string");l=E.merge(l,u,e)}return E.compact(l)};class Z{constructor(t,e,n){var l,i;this.name=t,this.definition=e,this.bindings=(l=e.bindings)!=null?l:{},this.wheres=(i=e.wheres)!=null?i:{},this.config=n}get template(){const t=`${this.origin}/${this.definition.uri}`.replace(/\/+$/,"");return t===""?"/":t}get origin(){return this.config.absolute?this.definition.domain?`${this.config.url.match(/^\w+:\/\//)[0]}${this.definition.domain}${this.config.port?`:${this.config.port}`:""}`:this.config.url:""}get parameterSegments(){var t,e;return(t=(e=this.template.match(/{[^}?]+\??}/g))==null?void 0:e.map(n=>({name:n.replace(/{|\??}/g,""),required:!/\?}$/.test(n)})))!=null?t:[]}matchesUrl(t){var e;if(!this.definition.methods.includes("GET"))return!1;const n=this.template.replace(/[.*+$()[\]]/g,"\\$&").replace(/(\/?){([^}?]*)(\??)}/g,(c,u,b,m)=>{var d;const p=`(?<${b}>${((d=this.wheres[b])==null?void 0:d.replace(/(^\^)|(\$$)/g,""))||"[^/?]+"})`;return m?`(${u}${p})?`:`${u}${p}`}).replace(/^\w+:\/\//,""),[l,i]=t.replace(/^\w+:\/\//,"").split("?"),s=(e=new RegExp(`^${n}/?$`).exec(l))!=null?e:new RegExp(`^${n}/?$`).exec(decodeURI(l));if(s){for(const c in s.groups)s.groups[c]=typeof s.groups[c]=="string"?decodeURIComponent(s.groups[c]):s.groups[c];return{params:s.groups,query:rt(i)}}return!1}compile(t){return this.parameterSegments.length?this.template.replace(/{([^}?]+)(\??)}/g,(e,n,l)=>{var i,s;if(!l&&[null,void 0].includes(t[n]))throw new Error(`Ziggy error: '${n}' parameter is required for route '${this.name}'.`);if(this.wheres[n]&&!new RegExp(`^${l?`(${this.wheres[n]})?`:this.wheres[n]}$`).test((s=t[n])!=null?s:""))throw new Error(`Ziggy error: '${n}' parameter '${t[n]}' does not match required format '${this.wheres[n]}' for route '${this.name}'.`);return encodeURI((i=t[n])!=null?i:"").replace(/%7C/g,"|").replace(/%25/g,"%").replace(/\$/g,"%24")}).replace(this.config.absolute?/(\.[^/]+?)(\/\/)/:/(^)(\/\/)/,"$1/").replace(/\/+$/,""):this.template}}class nt extends String{constructor(t,e,n=!0,l){if(super(),this.t=l??(typeof Ziggy<"u"?Ziggy:globalThis==null?void 0:globalThis.Ziggy),this.t=A({},this.t,{absolute:n}),t){if(!this.t.routes[t])throw new Error(`Ziggy error: route '${t}' is not in the route list.`);this.i=new Z(t,this.t.routes[t],this.t),this.u=this.l(e)}}toString(){const t=Object.keys(this.u).filter(e=>!this.i.parameterSegments.some(({name:n})=>n===e)).filter(e=>e!=="_query").reduce((e,n)=>A({},e,{[n]:this.u[n]}),{});return this.i.compile(this.u)+function(e,n){var l,i=e,s=function(o){if(!o)return k;if(o.encoder!=null&&typeof o.encoder!="function")throw new TypeError("Encoder has to be a function.");var f=o.charset||k.charset;if(o.charset!==void 0&&o.charset!=="utf-8"&&o.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var j=V.default;if(o.format!==void 0){if(!Ze.call(V.formatters,o.format))throw new TypeError("Unknown format option provided.");j=o.format}var h=V.formatters[j],x=k.filter;return(typeof o.filter=="function"||M(o.filter))&&(x=o.filter),{addQueryPrefix:typeof o.addQueryPrefix=="boolean"?o.addQueryPrefix:k.addQueryPrefix,allowDots:o.allowDots===void 0?k.allowDots:!!o.allowDots,charset:f,charsetSentinel:typeof o.charsetSentinel=="boolean"?o.charsetSentinel:k.charsetSentinel,delimiter:o.delimiter===void 0?k.delimiter:o.delimiter,encode:typeof o.encode=="boolean"?o.encode:k.encode,encoder:typeof o.encoder=="function"?o.encoder:k.encoder,encodeValuesOnly:typeof o.encodeValuesOnly=="boolean"?o.encodeValuesOnly:k.encodeValuesOnly,filter:x,format:j,formatter:h,serializeDate:typeof o.serializeDate=="function"?o.serializeDate:k.serializeDate,skipNulls:typeof o.skipNulls=="boolean"?o.skipNulls:k.skipNulls,sort:typeof o.sort=="function"?o.sort:null,strictNullHandling:typeof o.strictNullHandling=="boolean"?o.strictNullHandling:k.strictNullHandling}}(n);typeof s.filter=="function"?i=(0,s.filter)("",i):M(s.filter)&&(l=s.filter);var c=[];if(typeof i!="object"||i===null)return"";var u=te[n&&n.arrayFormat in te?n.arrayFormat:n&&"indices"in n?n.indices?"indices":"repeat":"indices"];l||(l=Object.keys(i)),s.sort&&l.sort(s.sort);for(var b=0;b<l.length;++b){var m=l[b];s.skipNulls&&i[m]===null||ae(c,Je(i[m],m,u,s.strictNullHandling,s.skipNulls,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset))}var d=c.join(s.delimiter),p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(p+=s.charset==="iso-8859-1"?"utf8=%26%2310003%3B&":"utf8=%E2%9C%93&"),d.length>0?p+d:""}(A({},t,this.u._query),{addQueryPrefix:!0,arrayFormat:"indices",encodeValuesOnly:!0,skipNulls:!0,encoder:(e,n)=>typeof e=="boolean"?Number(e):n(e)})}p(t){t?this.t.absolute&&t.startsWith("/")&&(t=this.h().host+t):t=this.v();let e={};const[n,l]=Object.entries(this.t.routes).find(([i,s])=>e=new Z(i,s,this.t).matchesUrl(t))||[void 0,void 0];return A({name:n},e,{route:l})}v(){const{host:t,pathname:e,search:n}=this.h();return(this.t.absolute?t+e:e.replace(this.t.url.replace(/^\w*:\/\/[^/]+/,""),"").replace(/^\/+/,"/"))+n}current(t,e){const{name:n,params:l,query:i,route:s}=this.p();if(!t)return n;const c=new RegExp(`^${t.replace(/\./g,"\\.").replace(/\*/g,".*")}$`).test(n);if([null,void 0].includes(e)||!c)return c;const u=new Z(n,s,this.t);e=this.l(e,u);const b=A({},l,i);if(Object.values(e).every(d=>!d)&&!Object.values(b).some(d=>d!==void 0))return!0;const m=(d,p)=>Object.entries(d).every(([o,f])=>Array.isArray(f)&&Array.isArray(p[o])?f.every(j=>p[o].includes(j)):typeof f=="object"&&typeof p[o]=="object"&&f!==null&&p[o]!==null?m(f,p[o]):p[o]==f);return m(e,b)}h(){var t,e,n,l,i,s;const{host:c="",pathname:u="",search:b=""}=typeof window<"u"?window.location:{};return{host:(t=(e=this.t.location)==null?void 0:e.host)!=null?t:c,pathname:(n=(l=this.t.location)==null?void 0:l.pathname)!=null?n:u,search:(i=(s=this.t.location)==null?void 0:s.search)!=null?i:b}}get params(){const{params:t,query:e}=this.p();return A({},t,e)}get routeParams(){return this.p().params}get queryParams(){return this.p().query}has(t){return this.t.routes.hasOwnProperty(t)}l(t={},e=this.i){t!=null||(t={}),t=["string","number"].includes(typeof t)?[t]:t;const n=e.parameterSegments.filter(({name:l})=>!this.t.defaults[l]);return Array.isArray(t)?t=t.reduce((l,i,s)=>A({},l,n[s]?{[n[s].name]:i}:typeof i=="object"?i:{[i]:""}),{}):n.length!==1||t[n[0].name]||!t.hasOwnProperty(Object.values(e.bindings)[0])&&!t.hasOwnProperty("id")||(t={[n[0].name]:t}),A({},this.m(e),this.j(t,e))}m(t){return t.parameterSegments.filter(({name:e})=>this.t.defaults[e]).reduce((e,{name:n},l)=>A({},e,{[n]:this.t.defaults[n]}),{})}j(t,{bindings:e,parameterSegments:n}){return Object.entries(t).reduce((l,[i,s])=>{if(!s||typeof s!="object"||Array.isArray(s)||!n.some(({name:c})=>c===i))return A({},l,{[i]:s});if(!s.hasOwnProperty(e[i])){if(!s.hasOwnProperty("id"))throw new Error(`Ziggy error: object passed as '${i}' parameter is missing route model binding key '${e[i]}'.`);e[i]="id"}return A({},l,{[i]:s[e[i]]})},{})}valueOf(){return this.toString()}}function ne(a,t,e,n){const l=new nt(a,t,e,n);return a?l.toString():l}function Nt(){const{auth:a,data:t}=G().props;console.log(t);const[e,n]=v.useState(t),[l,i]=v.useState(null),[s,c]=v.useState("index"),[u,b]=v.useState(!1),[m,d]=v.useState(!1),[p,o]=v.useState(!1),[f,j]=v.useState(t.siswa.has_pin),[h,x]=v.useState(null),[N,S]=v.useState({spr:[],tagihan:0});ye(G().props),v.useEffect(()=>{n(t)},[t]);const P=v.useCallback(async w=>{w==="riwayat"?(o(!0),x("pin")):c(w)},[]),$=v.useMemo(()=>[{title:"Tagihan",icon:r.jsx(ve,{className:"h-6 w-6 text-green-600"}),color:"border-green-700 bg-green-50 hover:bg-green-100",content:r.jsx(Be,{nouid:e.nouid,setTagihanParam:w=>{S(w),P("tagihan")}})},{title:"Data Siswa",icon:r.jsx(we,{className:"h-6 w-6 text-amber-600"}),color:"border-amber-700 bg-amber-50 hover:bg-amber-100",content:r.jsx(be,{nouid:e.nouid,siswa:e.siswa})},{title:"Ekstrakurikuler",icon:r.jsx(Ne,{className:"h-6 w-6 text-rose-600"}),color:"border-rose-700 bg-rose-50 hover:bg-rose-100",content:r.jsx(Ke,{nouid:t.nouid})}],[e,P,t]),T=v.useCallback(async()=>{try{d(!0);const w=await fetch(ne("api.siswa",e.nouid)+`?nouid=${encodeURIComponent(e.nouid)}`);w.ok||console.error("Terjadi kesalahan saat mengambil data siswa");const I=await w.json();I.success!==!0&&console.error(I.message||"Terjadi kesalahan pada server"),n(I.data)}catch(w){d(!1),console.error(w instanceof Error?w.message:"Terjadi kesalahan jaringan")}finally{d(!1)}},[e]),B=v.useCallback(async()=>{m||x("pin")},[m]),F=v.useCallback(async()=>{m||x("setupPin")},[m]),C=v.useCallback(async(w=!1)=>{x(null),w||(o(!1),c("index"))},[]),[H,U]=v.useState(!1),g=v.useCallback(()=>{se.post(ne("siswa.logout",e.nouid),{},{onStart:()=>d(!0),onSuccess:()=>d(!1),onError:()=>d(!1)})},[e.nouid]),y=v.useMemo(()=>he((e==null?void 0:e.siswa.balance)||0),[e==null?void 0:e.siswa.balance]),O=v.useMemo(()=>{if(l===null)return null;const w=$[l];return w!=null&&w.content?r.jsxs("div",{className:"relative rounded-xl border border-t-4 border-gray-800 bg-blue-50 p-2 pt-8 shadow-lg",children:[r.jsx("button",{onClick:()=>i(null),className:"absolute top-3 right-3 text-gray-500 transition hover:text-red-500","aria-label":"Tutup",children:r.jsx(ke,{className:"h-5 w-5"})}),w.content]}):r.jsx("div",{children:"Konten tidak tersedia"})},[l,$]),R=()=>{const[w,I]=v.useState(!1),[le,J]=v.useState(!1);return r.jsxs("div",{className:"relative flex w-full flex-col items-start rounded-t-lg bg-white p-4 px-6",children:[r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Se,{className:"flex-shrink-0 text-xl text-primary"}),r.jsx("h2",{className:"truncate text-3xl font-semibold text-primary",children:(e==null?void 0:e.siswa.namlen)||"******"})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Pe,{className:"flex-shrink-0 text-lg text-primary"}),r.jsxs("p",{className:"text-primary md:text-lg",children:["NIS: ",(e==null?void 0:e.siswa.nis)||"*****"]})]}),r.jsxs("div",{className:"flex items-center space-x-3",children:[r.jsx(Ce,{className:"flex-shrink-0 text-lg text-primary"}),r.jsxs("p",{className:"text-primary md:text-lg",children:["Kelas: ",(e==null?void 0:e.siswa.kel)||"******"]})]}),r.jsx("div",{className:"absolute right-4 bottom-2",children:r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"cursor-pointer p-2",onClick:()=>I(ce=>!ce),children:r.jsx($e,{className:"text-xl text-blue-500"})}),w&&r.jsx("div",{className:"absolute right-0 z-10 mt-1 w-40 rounded-md border bg-white shadow-md",children:r.jsx("button",{onClick:()=>{I(!1),J(!0)},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50",children:"🔒 Blokir Kartu"})})]})}),r.jsx(X,{open:le,onOpenChange:J,title:"Konfirmasi Blokir",description:"Apakah kamu yakin ingin memblokir kartu siswa ini?",confirmText:"Ya, Blokir",onConfirm:()=>{x("blokir"),b(!0)}})]})},q=()=>r.jsxs("div",{className:"grid w-full grid-cols-2 items-center gap-4 border-b-2 p-2 px-6",children:[a.user?r.jsxs(r.Fragment,{children:[r.jsxs("button",{onClick:()=>U(!0),className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-red-800 px-4 py-3 text-white shadow-sm transition-colors hover:bg-red-700",children:[r.jsx(Le,{className:"text-lg"}),r.jsx("span",{children:"Keluar"})]}),r.jsx(X,{open:H,onOpenChange:U,title:"Konfirmasi Logout",description:"Anda yakin ingin keluar?",confirmText:"Ya, Keluar",onConfirm:g})]}):r.jsxs("button",{onClick:B,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[r.jsx(Ae,{className:"text-lg"}),r.jsx("span",{children:"Masukan PIN"})]}),r.jsxs("button",{onClick:F,className:"flex items-center justify-center space-x-2 rounded-xl border border-indigo-100 bg-white px-4 py-3 text-indigo-600 shadow-sm transition-colors hover:bg-indigo-50",children:[r.jsx(De,{className:"text-lg"}),r.jsx("span",{children:f?"Ubah PIN":"Buat Pin"})]})]}),L=()=>r.jsx("div",{className:"mb-4 w-full shadow-[0px_10px_10px_-4px_rgba(0,0,0,0.1)] shadow-black",children:r.jsxs("div",{className:"flex w-full flex-row items-center justify-between gap-4 p-4 sm:px-6",children:[r.jsxs("div",{className:"flex flex-col space-y-4",children:[r.jsx("h1",{className:"text-lg font-semibold text-primary-foreground",children:"Saldo Tabungan"}),r.jsxs("div",{className:"flex items-center gap-2 text-primary-foreground",children:[r.jsx(Te,{className:"text-xl"}),r.jsx("span",{className:"text-xl font-bold",children:y})]})]}),r.jsxs("div",{className:"flex flex-col items-end justify-end space-y-4",children:[r.jsxs("button",{onClick:()=>P("topup"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[r.jsx(Ie,{}),r.jsx("span",{children:"Topup"})]}),r.jsxs("button",{onClick:()=>P("riwayat"),className:"flex items-center gap-2 rounded-md bg-primary-foreground px-4 py-2 text-primary hover:bg-accent",children:[r.jsx(Fe,{}),r.jsx("span",{children:"Riwayat"})]})]})]})}),ie=()=>r.jsx("div",{className:"mb-6 grid grid-cols-3 gap-4 px-4 sm:grid-cols-5",children:$.map((w,I)=>r.jsxs("button",{className:`flex flex-col items-center justify-center rounded-xl border border-t-5 p-2 transition duration-200 ${w.color}`,onClick:()=>i(I),children:[w.icon,r.jsx("span",{className:"mt-2 text-center text-sm font-semibold text-gray-800",children:w.title})]},I))});return m?r.jsx(Q,{title:"Loading...",children:r.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center space-y-6 bg-blue-100",children:[r.jsx(Oe,{className:"animate-spin-slow text-5xl text-blue-400"}),r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-2xl font-bold tracking-wider text-transparent",children:"Memuat Data"}),r.jsx("div",{className:"animate-loading-line absolute bottom-0 left-0 h-0.5 bg-gradient-to-r from-blue-400 to-purple-600"})]})]})}):r.jsxs(r.Fragment,{children:[t.active?r.jsx(r.Fragment,{children:s==="index"?r.jsxs(Q,{title:(e==null?void 0:e.siswa.namlen)||"Login",children:[r.jsx(R,{}),r.jsx(q,{}),a.user&&r.jsxs(r.Fragment,{children:[r.jsx(L,{}),r.jsx(ie,{}),O]})]}):s==="topup"?r.jsx(Ee,{siswa:e.siswa,nouid:e.nouid,onClose:()=>{c("index"),C(),T()}}):s==="tagihan"?r.jsx(Re,{siswa:e.siswa,tagihanParam:{...N,nouid:e.nouid},onClose:()=>{c("index"),C(),T()}}):null}):r.jsx(Q,{title:"Kartu Siswa",children:r.jsx("div",{className:"flex min-h-screen items-center bg-white",children:r.jsxs("div",{className:"mx-2 flex w-full flex-col items-center justify-center rounded-lg border-2 border-red-400 bg-red-50 p-6 text-center shadow-sm",children:[r.jsx("h3",{className:"mb-2 text-lg font-semibold text-red-600",children:"🔒 Kartu Diblokir"}),r.jsx("p",{className:"mb-4 text-sm text-red-700",children:"Kartu ini telah diblokir dan tidak dapat digunakan. Silakan aktifkan kembali untuk melanjutkan."}),r.jsx("button",{onClick:()=>x("setupPin"),className:"inline-flex items-center gap-2 rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white transition hover:bg-red-700",children:"🔓 Aktifkan Kembali"})]})})}),r.jsx(qe,{open:h==="blokir",onClose:()=>C(),setLoading:w=>d(w)}),r.jsx(Me,{open:h==="pin",hasPin:f,handle:a.user?p?"riwayat":"auth":"index",setPage:c,setOpenSetupPin:F,onClose:w=>{C(w),w||o(!1)}}),r.jsx(ge,{open:h==="setupPin",hasPin:f,setHasPined:()=>j(!0),onClose:()=>{C(),T()}})]})}export{Nt as default};
