import{r as l,j as e,K as ee,a as ae,u as te,m as se,S as le}from"./app-CKQm0Nsx.js";import{B as N}from"./button-OyDdaR9A.js";import{I as A}from"./InputGroup-ZyYCV7Vw.js";import{c as P,C as ne}from"./circle-alert-CfkC42On.js";import{C as ie}from"./ConfirmDialog -8TuCcaKy.js";import{S as re}from"./SelectInput-BlFVn7bM.js";import{d as k}from"./dayjs.min-C-lxxHWg.js";import{u as oe}from"./use-mobile-ZAdXAY5M.js";import{c as O}from"./utils-Dus-J79J.js";import{C as de,S as ce}from"./status-badge-BFHPBO7h.js";import{F as me}from"./file-text-BLlxh4ml.js";/* empty css            */import"./index-C0_RRpE9.js";import"./iconBase-DzkbRCMi.js";import"./check-06TQO_vg.js";import"./clock-9Nxx8Gp2.js";import"./circle-check-big-Hq-iImqw.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ge=P("Plus",ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],he=P("Send",xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],fe=P("Trash2",pe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ke=P("Upload",je),V=l.forwardRef(({name:o,label:M,preview:w,showError:m=!1,errorMessage:b="",processing:i=!1,required:C=!1,handleRemoveImage:h,handleFileChange:T,className:u=""},n)=>{const y=()=>{!i&&typeof n!="function"&&(n!=null&&n.current)&&n.current.click()},g=I=>{T(I,o)},F=()=>{h(o),typeof n!="function"&&(n!=null&&n.current)&&(n.current.value="")};return e.jsxs("div",{className:`space-y-2 ${u}`,children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[M," ",C&&"*"]}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[w?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:w,alt:`Preview ${M}`,className:"max-w-full h-auto max-h-64 rounded border border-gray-200"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx("button",{type:"button",className:"bg-red-500 text-white rounded-full p-2 hover:bg-red-600 transition-colors",onClick:F,disabled:i,children:e.jsx(fe,{className:"h-5 w-5"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{onClick:y,className:`flex flex-col items-center justify-center px-4 py-8 bg-white rounded-md border-2 border-dashed ${m?"border-red-300":"border-gray-300"} cursor-pointer hover:bg-gray-50 transition-colors`,"aria-invalid":m,children:[e.jsx(ke,{className:"h-12 w-12 text-gray-400"}),e.jsxs("span",{className:"mt-2 text-sm font-medium text-gray-700",children:["Upload ",M]}),e.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Format: JPG/PNG, maksimal 2MB"})]}),e.jsx("input",{ref:n,id:o,name:o,type:"file",accept:"image/jpeg, image/png, image/jpg",className:"hidden",onChange:g,disabled:i})]}),m&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-2",children:[e.jsx(ne,{className:"text-red-500 w-5 h-5"}),e.jsx("span",{children:b})]})]})]})});V.displayName="InputFile";const Ae=({nouid:o})=>{const{auth:M,data:w,jenis:m=[]}=ee().props,b=oe(),{log:i,error:C}=ae(),{APP_DEBUG:h}=te(),[T,u]=l.useState(!1),[n,y]=l.useState(!1),[g,F]=l.useState(null),[I,E]=l.useState(w.izin||[]),[p,S]=l.useState(null),[d,c]=l.useState({}),_=l.useRef(null),{data:s,setData:f,reset:z,post:G,processing:D}=se({jen:h?2:0,tgl_mulai:h?k().format("YYYY-MM-DD"):"",tgl_akhir:h?k().format("YYYY-MM-DD"):"",ket:h?"TEST AJA DULU YA GAES":"",dok:null}),U=l.useMemo(()=>m.map(a=>({value:a.id.toString(),label:a.title})),[m]),R=l.useCallback(()=>{const a={};let t=!0;return s.jen||(a.jen="Jenis izin harus dipilih",t=!1),s.tgl_mulai||(a.tgl_mulai="Tanggal mulai harus diisi",t=!1),s.tgl_akhir?k(s.tgl_akhir).isBefore(k(s.tgl_mulai))&&(a.tgl_akhir="Tanggal selesai tidak boleh sebelum tanggal mulai",t=!1):(a.tgl_akhir="Tanggal selesai harus diisi",t=!1),s.ket?s.ket.length<10&&(a.ket="Keterangan minimal 10 karakter",t=!1):(a.ket="Keterangan harus diisi",t=!1),!s.dok&&!p&&(a.dok="Dokumen pendukung diperlukan",t=!1,setTimeout(()=>{var r;(r=_.current)==null||r.focus()},0)),c(a),t||C("Validation errors",a),t},[s,p,C]),J=l.useCallback(a=>{var H;const t=(H=a.target.files)==null?void 0:H[0];if(!t)return;const r=["image/jpeg","image/png"],B=2*1024*1024;if(!r.includes(t.type)){c(x=>({...x,dok:"Format file harus JPG atau PNG"}));return}if(t.size>B){c(x=>({...x,dok:"Ukuran file maksimal 2MB"}));return}c(x=>({...x,dok:void 0}));const j=new FileReader;j.onload=x=>{var L;S((L=x.target)==null?void 0:L.result),f("dok",t)},j.readAsDataURL(t)},[f]),$=l.useCallback(()=>{S(null),f("dok",null),c(a=>({...a,dok:void 0})),_.current&&(_.current.value="")},[f]),v=l.useCallback((a,t)=>{f(r=>({...r,[a]:t})),d[a]&&c(r=>({...r,[a]:void 0}))},[f,d]),K=l.useCallback(async a=>{if(a.preventDefault(),!!R()){u(!0);try{await G(route("izin.store",o),{onSuccess:()=>{const t=m.find(j=>j.id===s.jen),r=(t==null?void 0:t.title)||"Unknown",B={id:Math.random().toString(36).substring(2,9),...s,dok:p||null,sta:"menunggu",created_at:new Date,title:r};E(j=>[...j,B]),z(),S(null),c({}),i("Pengajuan izin berhasil",B)},onError:t=>{c(t),i("Gagal mengajukan izin",{errors:t,data:s})},onFinish:()=>{u(!1)}})}catch(t){console.error("Submission error:",t),u(!1),i("Error sistem saat mengajukan izin",{error:t})}}},[s,p,R,o,z,i,G,m]),q=l.useCallback(a=>{F(a),y(!0)},[]),Q=l.useCallback(()=>{g&&le.post(route("izin.cancel",o),{id:g},{onSuccess:()=>{E(a=>a.map(t=>t.id===g?{...t,sta:"dibatalkan"}:t)),y(!1),i("Izin dibatalkan",{idIzin:g})}})},[g,i,o]),Y=l.useCallback((a,t=!1)=>k(a).format(t?"DD MMMM YYYY HH:mm":"DD MMMM YYYY"),[]),W=l.useMemo(()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 bg-gray-50 rounded-lg",children:[e.jsx(me,{className:"w-10 h-10 text-gray-400 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-500 mb-1",children:"Belum ada pengajuan izin"}),e.jsx("p",{className:"text-gray-400 text-center max-w-md px-4",children:'Anda belum membuat permohonan izin. Klik tombol "Ajukan Izin Baru" untuk membuat pengajuan.'})]}),[]),X=l.useCallback(a=>e.jsxs("div",{className:"border rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow bg-white space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("h3",{className:"font-semibold text-lg text-gray-800 capitalize",children:a.title||"Izin Tidak Diketahui"})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.jsx(de,{className:"inline mr-1 w-4 h-4"}),Y(a.tgl_mulai)," - ",Y(a.tgl_akhir)]})]}),e.jsx(ce,{status:a.sta})]}),e.jsxs("div",{className:O("mt-4 flex justify-between gap-2 items-end",b&&"flex-col-reverse items-start"),children:[e.jsxs("span",{className:"text-xs text-start text-gray-400",children:["Diajukan pada: ",Y(a.created_at,!0)]}),e.jsxs("div",{className:O("flex-1 flex w-full gap-2 justify-end",b&&"w-full"),children:[a.sta==="menunggu"&&e.jsx(N,{variant:"destructive",size:"sm",onClick:()=>q(a.id),className:"hover:bg-red-600 transition-colors",children:"Batalkan"}),e.jsx(N,{size:"sm",onClick:()=>{},children:"Detail"})]})]})]},a.id),[Y,q,b]),Z=l.useMemo(()=>e.jsxs("form",{onSubmit:K,className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("h2",{className:"text-xl font-bold text-blue-800",children:"Formulir Pengajuan Izin"})}),e.jsxs("div",{className:"space-y-5",children:[e.jsx(re,{name:"jen",label:"Jenis Izin",value:s.jen.toString(),onChange:a=>v("jen",parseInt(a)),options:U,placeholder:"Pilih jenis izin",errors:d,required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(A,{label:"Tanggal Mulai",type:s.jen===3?"datetime-local":"date",name:"tgl_mulai",value:s.tgl_mulai,min:k().format("YYYY-MM-DD"),onChange:a=>v("tgl_mulai",a),errors:d,required:!0}),e.jsx(A,{label:"Tanggal Selesai",type:s.jen===3?"datetime-local":"date",name:"tgl_akhir",value:s.tgl_akhir,onChange:a=>v("tgl_akhir",a),min:s.tgl_mulai,errors:d,required:!0})]}),e.jsx(A,{label:"Keterangan",type:"textarea",name:"ket",value:s.ket,onChange:a=>v("ket",a),placeholder:"Berikan penjelasan detail alasan izin...",rows:4,errors:d,required:!0}),e.jsx(V,{ref:_,name:"dok",label:"Dokumen Pendukung",preview:p??void 0,showError:!!d.dok,errorMessage:d.dok,handleRemoveImage:$,handleFileChange:J}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Format: JPG, PNG (Maks. 2MB)"}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100",children:[e.jsx(N,{variant:"destructive",type:"button",onClick:()=>{z(),c({}),S(null),u(!1)},disabled:D,children:"Batal"}),e.jsxs(N,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:D,children:[e.jsx(he,{className:"mr-2 w-4 h-4"}),D?"Mengajukan...":"Ajukan Izin"]})]})]})]}),[s,d,J,v,$,K,p,z,U,D]);return e.jsxs("div",{className:"max-w-4xl mx-auto p-2",children:[T?Z:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs(N,{onClick:()=>u(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ge,{className:"mr-2",size:16})," Ajukan Izin Baru"]})}),I.length===0?W:e.jsx("div",{className:"space-y-4",children:I.map(X)})]}),e.jsx(ie,{open:n,onOpenChange:y,title:"Batalkan Izin",description:"Apakah anda yakin ingin membatalkan izin ini?",confirmText:"Ya",cancelText:"Tidak",onConfirm:Q})]})};export{Ae as default};
